<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GURPS –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #333; padding: 20px; min-height: 100vh; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); overflow: hidden; }
        
        /* –í–∫–ª–∞–¥–∫–∏ */
        .tabs { display: flex; background: #2c3e50; border-bottom: 2px solid #34495e; }
        .tab-btn { flex: 1; padding: 15px; border: none; background: transparent; color: white; font-size: 16px; cursor: pointer; transition: background 0.3s; }
        .tab-btn.active { background: #3498db; font-weight: bold; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .header { background: linear-gradient(135deg, #2c3e50, #34495e); color: white; padding: 20px; text-align: center; }
        .character-info { display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; justify-content: center; }
        .input-group { flex: 1; min-width: 200px; }
        .input-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #ecf0f1; }
        .input-group input, .input-group select { width: 100%; padding: 10px; border: none; border-radius: 8px; font-size: 16px; background: rgba(255,255,255,0.9); }
        .input-row { display: flex; gap: 10px; align-items: center; }
        .input-row input { flex: 1; }
        
        .level-system { background: #f8f9fa; padding: 15px; border-bottom: 2px solid #dee2e6; }
        .level-display { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .level-info { font-size: 1.2em; font-weight: bold; color: #2c3e50; display: flex; align-items: center; gap: 10px; }
        .exp-display { display: flex; align-items: center; gap: 10px; }
        .exp-input { width: 120px; padding: 8px; border: 2px solid #3498db; border-radius: 6px; font-size: 16px; text-align: center; }
        
        .stats-panel { padding: 15px; background: #fff; border-bottom: 2px solid #ecf0f1; }
        .stat-row { display: flex; align-items: center; padding: 8px 0; gap: 10px; }
        .stat-label { flex: 1; font-weight: bold; display: flex; align-items: center; gap: 8px; }
        .stat-input { width: 100px; padding: 8px; border: 2px solid #3498db; border-radius: 6px; text-align: center; font-size: 16px; }
        
        .points-panel { padding: 15px; background: #e8f4f8; border-bottom: 2px solid #3498db; }
        .points-display { display: flex; align-items: center; justify-content: center; gap: 10px; }
        
        .skills-section { padding: 20px; border-bottom: 2px solid #ecf0f1; }
        .section-title { font-size: 1.4em; color: #2c3e50; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #3498db; display: flex; align-items: center; gap: 10px; }
        .skill-row { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid #ecf0f1; }
        .skill-name { flex: 2; font-weight: 500; display: flex; align-items: center; gap: 8px; }
        .skill-controls { flex: 1; display: flex; align-items: center; justify-content: flex-end; gap: 10px; }
        .skill-value { font-size: 1.2em; font-weight: bold; color: #2c3e50; min-width: 30px; text-align: center; }
        
        /* –°—Ç–∏–ª–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è */
        .inventory-container { padding: 20px; }
        .category-section { margin-bottom: 25px; border: 2px solid #ecf0f1; border-radius: 10px; padding: 15px; }
        .category-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #bdc3c7; }
        .category-header h3 { margin: 0; color: #2c3e50; }
        .category-items { min-height: 50px; }
        .item-row { display: flex; justify-content: space-between; align-items: center; padding: 8px; margin: 5px 0; background: #f8f9fa; border-radius: 5px; border-left: 4px solid #3498db; }
        .item-info { flex: 1; }
        .item-name { font-weight: bold; color: #2c3e50; }
        .item-details { font-size: 0.9em; color: #7f8c8d; }
        .item-actions { display: flex; gap: 5px; }
        
        .btn { padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: bold; transition: all 0.3s; }
        .btn-plus { background: #27ae60; color: white; }
        .btn-minus { background: #e74c3c; color: white; }
        .btn-roll { background: #3498db; color: white; padding: 8px 15px; }
        .btn-convert { background: #9b59b6; color: white; }
        .btn-levels { background: #f39c12; color: white; }
        .btn-edit { background: #95a5a6; color: white; }
        .btn-undo { background: #e67e22; color: white; }
        .btn-redo { background: #d35400; color: white; }
        .btn-small { padding: 4px 8px; font-size: 12px; }
        .btn:disabled { background: #bdc3c7; cursor: not-allowed; }
        
        .result-popup, .levels-popup, .inventory-popup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .result-content, .levels-content, .inventory-content { background: white; padding: 30px; border-radius: 15px; text-align: center; max-width: 90%; width: 500px; max-height: 80vh; overflow-y: auto; }
        .dice-rolls { display: flex; justify-content: center; gap: 15px; margin: 15px 0; }
        .dice { width: 50px; height: 50px; background: #3498db; border-radius: 8px; display: flex; justify-content: center; align-items: center; font-size: 1.5em; font-weight: bold; color: white; }
        
        .success { color: #27ae60; font-weight: bold; }
        .failure { color: #e74c3c; font-weight: bold; }
        .critical-success { color: #f39c12; font-weight: bold; }
        .critical-failure { color: #c0392b; font-weight: bold; }
        
        .free-points-warning { color: #e74c3c; font-weight: bold; text-align: center; margin: 10px; padding: 10px; background: #ffeaa7; border-radius: 5px; }
        
        .levels-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        .levels-table th, .levels-table td { padding: 8px; text-align: center; border: 1px solid #ddd; }
        .levels-table th { background: #34495e; color: white; }
        .current-level { background: #ffeaa7 !important; font-weight: bold; }
        
        @media (max-width: 600px) {
            .character-info, .stat-row, .skill-row { flex-direction: column; align-items: flex-start; gap: 10px; }
            .skill-controls { width: 100%; justify-content: space-between; }
            .exp-display, .level-display { flex-direction: column; gap: 10px; }
            .points-display { flex-direction: column; }
            .tabs { flex-direction: column; }
            .item-row { flex-direction: column; align-items: flex-start; gap: 10px; }
            .item-actions { width: 100%; justify-content: flex-end; }
            .input-row { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('character')">üë§ –ü–µ—Ä—Å–æ–Ω–∞–∂</button>
            <button class="tab-btn" onclick="openTab('inventory')">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
            <button class="tab-btn" onclick="openTab('spells')">üìö –ó–∞–∫–ª–∏–Ω–∞–Ω–∏—è</button>
            <button class="tab-btn" onclick="openTab('notes')">üìù –ó–∞–º–µ—Ç–∫–∏</button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ü–µ—Ä—Å–æ–Ω–∞–∂ -->
        <div id="character-tab" class="tab-content active">
            <div class="header">
                <h1>üé≤ GURPS –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h1>
                <div class="character-info">
                    <div class="input-group">
                        <label for="characterName">–ò–º—è:</label>
                        <input type="text" id="characterName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
                    </div>
                    <div class="input-group">
                        <label for="characterSurname">–§–∞–º–∏–ª–∏—è:</label>
                        <input type="text" id="characterSurname" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é">
                    </div>
                    <div class="input-group">
                        <label for="characterTitle">–¢–∏—Ç—É–ª:</label>
                        <input type="text" id="characterTitle" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–∏—Ç—É–ª">
                    </div>
                </div>

                <div class="character-info">
                    <div class="input-group">
                        <label for="characterRace">–†–∞—Å–∞:</label>
                        <select id="characterRace" onchange="onRaceChange()">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å—É</option>
                            <option value="human">üèπ –ß–µ–ª–æ–≤–µ–∫</option>
                            <option value="atski">üî• –ê—Ü–∫–∏ (–ü–µ—Ä—Å—ã)</option>
                            <option value="knofi">üí¨ –ö–Ω–æ—Ñ—ã (–†–∏–º–ª—è–Ω–µ)</option>
                            <option value="vorki">‚ùÑÔ∏è –í–æ—Ä–∫–∏ (–í–∏–∫–∏–Ω–≥–∏)</option>
                            <option value="minci">üéØ –ú–∏–Ω—Ü—ã (–ê–∑–∏–∞—Ç—ã)</option>
                            <option value="kaei">‚öôÔ∏è –ö–∞—ç–π—Ü—ã</option>
                            <option value="forest_elf">üåø –õ–µ—Å–Ω—ã–µ —ç–ª—å—Ñ—ã</option>
                            <option value="high_elf">‚ú® –í—ã—Å—à–∏–µ —ç–ª—å—Ñ—ã</option>
                            <option value="dark_elf">üåë –¢–µ–º–Ω—ã–µ —ç–ª—å—Ñ—ã</option>
                            <option value="dwarf">‚õèÔ∏è –î–≤–∞—Ä—Ñ—ã</option>
                            <option value="gnome">üîß –ì–Ω–æ–º—ã</option>
                            <option value="orc">üí™ –û—Ä–∫–∏</option>
                            <option value="goblin">üé≠ –ì–æ–±–ª–∏–Ω—ã</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="characterHeritage">–ù–∞—Å–ª–µ–¥–∏–µ:</label>
                        <input type="text" id="characterHeritage" placeholder="–û—Å–æ–±–æ–µ –Ω–∞—Å–ª–µ–¥–∏–µ">
                    </div>
                </div>

                <div class="character-info">
                    <div class="input-group">
                        <label for="characterHeight">–†–æ—Å—Ç (—Å–º):</label>
                        <div class="input-row">
                            <input type="number" id="characterHeight" readonly>
                            <button class="btn" id="generateHeightBtn" onclick="generateHeightForSelectedRace()" style="background: #3498db;">üé≤ –ê–≤—Ç–æ</button>
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="characterWeight">–í–µ—Å (–∫–≥):</label>
                        <input type="number" id="characterWeight" placeholder="–í–µ—Å">
                    </div>
                    <div class="input-group">
                        <label for="characterAge">–í–æ–∑—Ä–∞—Å—Ç (–ª–µ—Ç):</label>
                        <input type="number" id="characterAge" placeholder="–í–æ–∑—Ä–∞—Å—Ç">
                    </div>
                </div>
            </div>

            <div class="level-system">
                <div class="level-display">
                    <div class="level-info">
                        –£—Ä–æ–≤–µ–Ω—å: <span id="currentLevel">0</span>
                        <button class="btn btn-edit" onclick="editLevel()">‚úèÔ∏è</button>
                        <button class="btn btn-levels" onclick="showLevelsTable()">üìä</button>
                        <button class="btn btn-undo" onclick="undo()" id="undoBtn" disabled>‚Ü∂</button>
                        <button class="btn btn-redo" onclick="redo()" id="redoBtn" disabled>‚Ü∑</button>
                    </div>
                    <div class="exp-display">
                        <input type="number" id="currentExp" class="exp-input" value="0" min="0">
                        <span>/ <span id="requiredExp">1000</span></span>
                        <button class="btn btn-plus" onclick="addExperience()">‚ûï –û–ø—ã—Ç</button>
                        <button class="btn btn-convert" id="convertBtn" onclick="convertExpToPoints()" style="display: none;">üíé –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                </div>
                <div id="convertInfo" style="display: none; text-align: center; margin-top: 10px; font-size: 0.9em; color: #9b59b6;">
                    üíé 1000 –æ–ø—ã—Ç–∞ = 1 –æ—á–∫–æ –Ω–∞–≤—ã–∫–æ–≤
                </div>
            </div>

            <div class="stats-panel">
                <div class="stat-row">
                    <div class="stat-label">‚ù§Ô∏è –ó–î–û–†–û–í–¨–ï:</div>
                    <input type="number" class="stat-input" id="health" value="100">
                    <button class="btn btn-minus" onclick="changeStat('health', -5)">-5</button>
                    <button class="btn btn-plus" onclick="changeStat('health', 5)">+5</button>
                </div>
                <div class="stat-row">
                    <div class="stat-label">üíß –ú–ê–ù–ê:</div>
                    <input type="number" class="stat-input" id="mana" value="100">
                    <button class="btn btn-minus" onclick="changeStat('mana', -5)">-5</button>
                    <button class="btn btn-plus" onclick="changeStat('mana', 5)">+5</button>
                </div>
                <div class="stat-row">
                    <div class="stat-label">‚ö° –°–¢–ê–ú–ò–ù–ê:</div>
                    <input type="number" class="stat-input" id="stamina" value="100">
                    <button class="btn btn-minus" onclick="changeStat('stamina', -5)">-5</button>
                    <button class="btn btn-plus" onclick="changeStat('stamina', 5)">+5</button>
                </div>
            </div>

            <div class="points-panel">
                <div class="points-display">
                    <span style="font-size: 1.2em; font-weight: bold; color: #2c3e50;">–°–≤–æ–±–æ–¥–Ω—ã–µ –æ—á–∫–∏:</span>
                    <input type="number" id="freePoints" class="stat-input" value="0">
                    <button class="btn btn-edit" onclick="editFreePoints()">‚úèÔ∏è</button>
                </div>
            </div>

            <div id="skillsContainer"></div>
            
            <div class="free-points-warning" id="pointsWarning" style="display: none;">
                ‚ö†Ô∏è –°–≤–æ–±–æ–¥–Ω—ã–µ –æ—á–∫–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å!
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
        <div id="inventory-tab" class="tab-content">
            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ JavaScript -->
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ó–∞–∫–ª–∏–Ω–∞–Ω–∏—è -->
        <div id="spells-tab" class="tab-content">
            <div style="padding: 20px; text-align: center;">
                <h2>üìö –ó–∞–∫–ª–∏–Ω–∞–Ω–∏—è</h2>
                <p style="color: #7f8c8d; margin-top: 20px;">–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ó–∞–º–µ—Ç–∫–∏ -->
        <div id="notes-tab" class="tab-content">
            <div style="padding: 20px; text-align: center;">
                <h2>üìù –ó–∞–º–µ—Ç–∫–∏</h2>
                <p style="color: #7f8c8d; margin-top: 20px;">–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>
            </div>
        </div>
    </div>

    <script>
        // –¢–∞–±–ª–∏—Ü–∞ —É—Ä–æ–≤–Ω–µ–π (–Ω–∞—á–∏–Ω–∞–µ–º —Å 0 —É—Ä–æ–≤–Ω—è)
        const levelTable = {
            0: { expRequired: 1000, hp: 100, mana: 100, stamina: 100, points: 20 },
            1: { expRequired: 3000, hp: 200, mana: 200, stamina: 200, points: 30 },
            2: { expRequired: 5000, hp: 300, mana: 300, stamina: 300, points: 40 },
            3: { expRequired: 8000, hp: 400, mana: 400, stamina: 400, points: 50 },
            4: { expRequired: 12000, hp: 500, mana: 500, stamina: 500, points: 60 },
            5: { expRequired: 16000, hp: 600, mana: 600, stamina: 600, points: 70 },
            6: { expRequired: 20000, hp: 700, mana: 700, stamina: 700, points: 80 },
            7: { expRequired: 25000, hp: 800, mana: 800, stamina: 800, points: 90 },
            8: { expRequired: 30000, hp: 900, mana: 900, stamina: 900, points: 100 },
            9: { expRequired: 100000, hp: 1000, mana: 1000, stamina: 1000, points: 200 }
        };

        // –°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å
        const races = {
            human: {
                name: "üèπ –ß–µ–ª–æ–≤–µ–∫",
                description: "–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ä–∞—Å–∞ –±–µ–∑ –æ—Å–æ–±—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π",
                lifespan: "80-100 –ª–µ—Ç",
                bonuses: {},
                limitations: {}
            },
            atski: {
                name: "üî• –ê—Ü–∫–∏ (–ü–µ—Ä—Å—ã)",
                description: "50% –∑–∞—â–∏—Ç–∞ –æ—Ç –æ–≥–Ω—è, 100% –Ω–∞ –∞—Ç–∞–∫—É –æ–≥–Ω–µ–º, –ø—É—Å—Ç—ã–Ω—è —ç—Ç–æ –∏—Ö —Å—Ç–∏—Ö–∏—è",
                lifespan: "350 –ª–µ—Ç",
                bonuses: { "–ú–∞–≥–∏—è –æ–≥–Ω—è": 2 },
                limitations: {}
            },
            knofi: {
                name: "üí¨ –ö–Ω–æ—Ñ—ã (–†–∏–º–ª—è–Ω–µ)", 
                description: "+1 –∫ –∫—Ä–∞—Å–Ω–æ—Ä–µ—á–∏—é, –∑–Ω–∞–Ω–∏–µ 3 —è–∑—ã–∫–æ–≤",
                lifespan: "400 –ª–µ—Ç",
                bonuses: { "–ö—Ä–∞—Å–Ω–æ—Ä–µ—á–∏–µ": 1 },
                limitations: {}
            },
            vorki: {
                name: "‚ùÑÔ∏è –í–æ—Ä–∫–∏ (–í–∏–∫–∏–Ω–≥–∏)",
                description: "50% –∑–∞—â–∏—Ç–∞ –æ—Ç –ª—å–¥—É, +100% –Ω–∞ –∞—Ç–∞–∫—É –ª—å–¥–æ–º",
                lifespan: "250 –ª–µ—Ç",
                bonuses: { "–ú–∞–≥–∏—è –≤–æ–¥—ã": 2 },
                limitations: {}
            },
            minci: {
                name: "üéØ –ú–∏–Ω—Ü—ã (–ê–∑–∏–∞—Ç—ã)",
                description: "+1 –∫ –¥—Ä–µ–≤–∫–æ–≤–æ–º—É, +1 –∫ –ª–æ–≤–∫–æ—Å—Ç–∏, +1 –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏",
                lifespan: "350 –ª–µ—Ç", 
                bonuses: { "–î—Ä–µ–≤–∫–æ–≤–æ–µ": 1, "–õ–æ–≤–∫–æ—Å—Ç—å": 1, "–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å": 1 },
                limitations: { "–î—Ä–µ–≤–∫–æ–≤–æ–µ": 19 }
            },
            kaei: {
                name: "‚öôÔ∏è –ö–∞—ç–π—Ü—ã",
                description: "–° —Ä–æ–∂–¥–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Å—Ç–∏—Ö–∏—è –º–µ—Ç–∞–ª–ª–∞",
                lifespan: "300 –ª–µ—Ç",
                bonuses: { "–ú–∞–≥–∏—è –º–µ—Ç–∞–ª–ª–∞": 2 },
                limitations: {}
            },
            forest_elf: {
                name: "üåø –õ–µ—Å–Ω—ã–µ —ç–ª—å—Ñ—ã", 
                description: "–° —Ä–æ–∂–¥–µ–Ω–∏—è –æ–±–ª–∞–¥–∞—é—Ç –º–∞–≥–∏–µ–π –ø—Ä–∏—Ä–æ–¥—ã",
                lifespan: "700 –ª–µ—Ç",
                bonuses: { "–ú–∞–≥–∏—è –ø—Ä–∏—Ä–æ–¥—ã": 2 },
                limitations: {}
            },
            high_elf: {
                name: "‚ú® –í—ã—Å—à–∏–µ —ç–ª—å—Ñ—ã",
                description: "–° —Ä–æ–∂–¥–µ–Ω–∏—è –æ–±–ª–∞–¥–∞—é—Ç –¥–≤—É–º—è —Å—Ç–∏—Ö–∏—è–º–∏",
                lifespan: "2000 –ª–µ—Ç", 
                bonuses: { "–ú–∞–≥–∏—è –≤–æ–∑–¥—É—Ö–∞": 2, "–ú–∞–≥–∏—è —Å–≤–µ—Ç–∞": 2 },
                limitations: { "–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å": 19 }
            },
            dark_elf: {
                name: "üåë –¢–µ–º–Ω—ã–µ —ç–ª—å—Ñ—ã",
                description: "–° —Ä–æ–∂–¥–µ–Ω–∏—è –≤–ª–∞–¥–µ—é—Ç –º–∞–≥–∏–µ–π —Ç—å–º—ã", 
                lifespan: "700 –ª–µ—Ç",
                bonuses: { "–ú–∞–≥–∏—è —Ç—å–º—ã": 2 },
                limitations: {}
            },
            dwarf: {
                name: "‚õèÔ∏è –î–≤–∞—Ä—Ñ—ã",
                description: "–ü—Ä–∏—Ä–æ–∂–¥–µ–Ω–Ω—ã–µ –∫—É–∑–Ω–µ—Ü—ã, –≤–æ–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–∞—Å–∞",
                lifespan: "600 –ª–µ—Ç",
                bonuses: { "–ö—É–∑–Ω–µ—á–Ω–æ–µ –¥–µ–ª–æ": 1 },
                limitations: { "–ö—É–∑–Ω–µ—á–Ω–æ–µ –¥–µ–ª–æ": 19, "–õ–æ–≤–∫–æ—Å—Ç—å": 19 }
            },
            gnome: {
                name: "üîß –ì–Ω–æ–º—ã", 
                description: "–ò–∑–æ–±—Ä–µ—Ç–∞—Ç–µ–ª—å–Ω—ã–µ –∏ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–µ",
                lifespan: "800 –ª–µ—Ç",
                bonuses: { "–†–µ–º–µ—Å–ª–æ": 1 },
                limitations: { "–õ–æ–≤–∫–æ—Å—Ç—å": 19, "–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å": 19, "–†–µ–º–µ—Å–ª–æ": 19 }
            },
            orc: {
                name: "üí™ –û—Ä–∫–∏",
                description: "–õ—É—á—à–∏–µ –±–æ–π—Ü—ã, –ø—Ä–µ–∑–∏—Ä–∞—é—Ç –º–∞–≥–∏—é",
                lifespan: "400 –ª–µ—Ç", 
                bonuses: { "–¢—è–∂—ë–ª–∞—è –±—Ä–æ–Ω—è": 1, "–î–≤—É—Ä—É—á–Ω–æ–µ –æ—Ä—É–∂–∏–µ": 1 },
                limitations: { "–¢—è–∂—ë–ª–∞—è –±—Ä–æ–Ω—è": 20, "–î–≤—É—Ä—É—á–Ω–æ–µ –æ—Ä—É–∂–∏–µ": 20 }
            },
            goblin: {
                name: "üé≠ –ì–æ–±–ª–∏–Ω—ã",
                description: "–•–∏—Ç—Ä—ã–µ –∏ –±—ã—Å—Ç—Ä–æ —É—á–∞—Ç—Å—è, –Ω–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–≥–∏—é",
                lifespan: "25 –ª–µ—Ç", 
                bonuses: {},
                limitations: { 
                    "–ú–∞–≥–∏—è –≤–æ–¥—ã": 0, "–ú–∞–≥–∏—è –∑–µ–º–ª–∏": 0, "–ú–∞–≥–∏—è –≤–æ–∑–¥—É—Ö–∞": 0, "–ú–∞–≥–∏—è –æ–≥–Ω—è": 0, 
                    "–ú–∞–≥–∏—è –∫—Ä–æ–≤–∏": 0, "–ú–∞–≥–∏—è –º–µ—Ç–∞–ª–ª–∞": 0, "–ú–∞–≥–∏—è –ø—Ä–∏—Ä–æ–¥—ã": 0, "–ú–∞–≥–∏—è —Å–≤–µ—Ç–∞": 0, 
                    "–ú–∞–≥–∏—è —Ç—å–º—ã": 0, "–ú–∞–≥–∏—è –∏–Ω—Ñ–µ—Ä–Ω–æ": 0, "–ú–∞–≥–∏—è —Ö–∞–æ—Å–∞": 0, "–ú–∞–≥–∏—è —Ä–∞–∑—É–º–∞": 0, 
                    "–ú–∞–≥–∏—è –ñ–∏–∑–Ω–∏": 0, "–ú–∞–≥–∏—è —Å–º–µ—Ä—Ç–∏": 0, "–ú–∞–≥–∏—è –ø—É—Å—Ç–æ—Ç—ã": 0, "–ú–∞–≥–∏—è –≠–Ω–µ—Ä–≥–∏–∏": 0, 
                    "–ê–ª—Ö–∏–º–∏—è": 0, "–ó–∞—á–∞—Ä–æ–≤–∞–Ω–∏–µ": 0 
                }
            }
        };

        // –î–∏–∞–ø–∞–∑–æ–Ω—ã —Ä–æ—Å—Ç–∞ –¥–ª—è —Ä–∞—Å
        const raceHeightRanges = {
            human: { min: 170, max: 190 },
            atski: { min: 140, max: 210 },
            knofi: { min: 135, max: 205 },
            vorki: { min: 150, max: 220 },
            minci: { min: 130, max: 200 },
            kaei: { min: 140, max: 225 },
            forest_elf: { min: 150, max: 210 },
            high_elf: { min: 170, max: 270 },
            dark_elf: { min: 160, max: 230 },
            dwarf: { min: 110, max: 160 },
            gnome: { min: 40, max: 80 },
            orc: { min: 200, max: 350 },
            goblin: { min: 90, max: 150 }
        };

        // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞–≤—ã–∫–æ–≤
        const skillsStructure = {
            "‚öîÔ∏è –ë–û–ï–í–´–ï –ù–ê–í–´–ö–ò": [
                "–¢—è–∂—ë–ª–∞—è –±—Ä–æ–Ω—è", "–õ—ë–≥–∫–∞—è –±—Ä–æ–Ω—è", "–î–≤—É—Ä—É—á–Ω–æ–µ –æ—Ä—É–∂–∏–µ", 
                "–û–¥–Ω–æ—Ä—É—á–Ω–æ–µ –æ—Ä—É–∂–∏–µ", "–°—Ç—Ä–µ–ª—å–±–∞", "–ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ", 
                "–î—Ä–µ–≤–∫–æ–≤–æ–µ", "–†—É–∫–æ–ø–∞—à–Ω—ã–π –±–æ–π", "–ú–µ—Ç–∞–Ω–∏–µ"
            ],
            "üé≠ –û–ë–©–ò–ï –ù–ê–í–´–ö–ò": [
                "–°–∫—Ä—ã—Ç–Ω–æ—Å—Ç—å", "–ö—Ä–∞—Å–Ω–æ—Ä–µ—á–∏–µ", "–õ–æ–≤–∫–æ—Å—Ç—å", "–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å",
                "–í–∑–ª–æ–º", "–í–æ—Å–ø—Ä–∏—è—Ç–∏–µ", "–£–¥–∞—á–∞", "–ö–∞—Ä–º–∞–Ω–Ω—ã–µ –∫—Ä–∞–∂–∏"
            ],
            "‚öóÔ∏è –†–ï–ú–ï–°–õ–ê": [
                "–ê–ª—Ö–∏–º–∏—è", "–ö—É–∑–Ω–µ—á–Ω–æ–µ –¥–µ–ª–æ", "–ó–∞—á–∞—Ä–æ–≤–∞–Ω–∏–µ", "–†–µ–º–µ—Å–ª–æ"
            ],
            "üîÆ –ú–ê–ì–ò–Ø": [
                "–ú–∞–≥–∏—è –≤–æ–¥—ã", "–ú–∞–≥–∏—è –∑–µ–º–ª–∏", "–ú–∞–≥–∏—è –≤–æ–∑–¥—É—Ö–∞", "–ú–∞–≥–∏—è –∫—Ä–æ–≤–∏",
                "–ú–∞–≥–∏—è –æ–≥–Ω—è", "–ú–∞–≥–∏—è –º–µ—Ç–∞–ª–ª–∞", "–ú–∞–≥–∏—è –ø—Ä–∏—Ä–æ–¥—ã", "–ú–∞–≥–∏—è —Å–≤–µ—Ç–∞",
                "–ú–∞–≥–∏—è —Ç—å–º—ã", "–ú–∞–≥–∏—è –∏–Ω—Ñ–µ—Ä–Ω–æ", "–ú–∞–≥–∏—è —Ö–∞–æ—Å–∞", "–ú–∞–≥–∏—è —Ä–∞–∑—É–º–∞",
                "–ú–∞–≥–∏—è –ñ–∏–∑–Ω–∏", "–ú–∞–≥–∏—è —Å–º–µ—Ä—Ç–∏", "–ú–∞–≥–∏—è –ø—É—Å—Ç–æ—Ç—ã", "–ú–∞–≥–∏—è –≠–Ω–µ—Ä–≥–∏–∏"
            ]
        };

        // –°–∏—Å—Ç–µ–º–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        let inventoryCategories = [
            { id: 'weapons', name: '‚öîÔ∏è –û—Ä—É–∂–∏–µ', icon: '‚öîÔ∏è', editable: true },
            { id: 'armor', name: 'üõ°Ô∏è –ë—Ä–æ–Ω—è', icon: 'üõ°Ô∏è', editable: true },
            { id: 'potions', name: 'üß™ –ó–µ–ª—å—è', icon: 'üß™', editable: true },
            { id: 'scrolls', name: 'üìú –°–≤–∏—Ç–∫–∏', icon: 'üìú', editable: true },
            { id: 'resources', name: 'üíé –†–µ—Å—É—Ä—Å—ã', icon: 'üíé', editable: true },
            { id: 'valuables', name: 'üí∞ –¶–µ–Ω–Ω–æ—Å—Ç–∏', icon: 'üí∞', editable: true },
            { id: 'tools', name: 'üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã', icon: 'üîß', editable: true },
            { id: 'other', name: 'üéí –ü—Ä–æ—á–µ–µ', icon: 'üéí', editable: true }
        ];

        let inventory = {
            weapons: [],
            armor: [],
            potions: [],
            scrolls: [],
            resources: [],
            valuables: [],
            tools: [],
            other: []
        };

        // –ò—Å—Ç–æ—Ä–∏—è –±—Ä–æ—Å–∫–æ–≤
        const rollHistory = {};

        // –°–∏—Å—Ç–µ–º–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–µ–π—Å—Ç–≤–∏–π
        let actionHistory = [];
        let currentHistoryIndex = -1;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            loadCharacterData();
            loadInventory();
            loadRollHistory();
            renderSkills();
            renderInventory();
            updateUI();
            updateLevelDisplay();
            updateHistoryButtons();
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
            setTimeout(saveStateToHistory, 1000);
        });

        // === –°–ò–°–¢–ï–ú–ê –†–ê–° ===
        function generateRandomHeight(raceId) {
            const range = raceHeightRanges[raceId];
            if (!range) return 170;
            
            const randomHeight = Math.floor(Math.random() * (range.max - range.min + 1)) + range.min;
            return randomHeight;
        }

        function onRaceChange() {
            const raceSelect = document.getElementById('characterRace');
            const raceId = raceSelect.value;
            
            if (raceId) {
                showRaceInfo(raceId);
                // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –∞–≤—Ç–æ-—Ä–æ—Å—Ç–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ä–∞—Å—ã
                document.getElementById('generateHeightBtn').disabled = false;
                document.getElementById('generateHeightBtn').style.background = '#3498db';
            }
        }

        function showRaceInfo(raceId) {
            if (!raceId) return;
            
            const race = races[raceId];
            const heightRange = raceHeightRanges[raceId];
            const popup = document.createElement('div');
            popup.className = 'result-popup';
            popup.innerHTML = `
                <div class="result-content" style="text-align: left; max-width: 600px;">
                    <h2>${race.name}</h2>
                    <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${race.description}</p>
                    <p><strong>–†–æ—Å—Ç:</strong> ${heightRange.min}-${heightRange.max} —Å–º</p>
                    <p><strong>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∂–∏–∑–Ω–∏:</strong> ${race.lifespan}</p>
                    
                    ${Object.keys(race.bonuses).length > 0 ? `
                        <p><strong>–ë–æ–Ω—É—Å—ã:</strong></p>
                        <ul>
                            ${Object.entries(race.bonuses).map(([skill, bonus]) => 
                                `<li>${skill}: +${bonus}</li>`
                            ).join('')}
                        </ul>
                    ` : ''}
                    
                    ${Object.keys(race.limitations).length > 0 ? `
                        <p><strong>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:</strong></p>
                        <ul>
                            ${Object.entries(race.limitations).map(([skill, limit]) => 
                                `<li>${skill}: –º–∞–∫—Å–∏–º—É–º ${limit === 0 ? '–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ' : limit}</li>`
                            ).join('')}
                        </ul>
                    ` : ''}
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn" onclick="setRace('${raceId}')" style="background: #27ae60; flex: 1;">‚úÖ –í—ã–±—Ä–∞—Ç—å —Ä–∞—Å—É</button>
                        <button class="btn" onclick="this.closest('.result-popup').remove()" style="background: #34495e; flex: 1;">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            `;
            document.body.appendChild(popup);
        }

        function setRace(raceId) {
            const race = races[raceId];
            if (!race) return;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞—Å—É
            document.getElementById('characterRace').value = raceId;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–æ—Å—Ç
            const randomHeight = generateRandomHeight(raceId);
            document.getElementById('characterHeight').value = randomHeight;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç (10% –æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∂–∏–∑–Ω–∏)
            const lifespan = parseInt(race.lifespan);
            document.getElementById('characterAge').value = Math.max(15, Math.floor(lifespan * 0.1));
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É —Ä–æ—Å—Ç–∞ (–º–æ–∂–Ω–æ –Ω–∞–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑)
            document.getElementById('generateHeightBtn').disabled = true;
            document.getElementById('generateHeightBtn').style.background = '#bdc3c7';
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –±–æ–Ω—É—Å—ã —Ä–∞—Å—ã
            applyRaceBonuses(raceId);
            
            saveCharacterData();
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–ø–∞–ø
            document.querySelector('.result-popup')?.remove();
            
            alert(`‚úÖ –†–∞—Å–∞ "${race.name}" –≤—ã–±—Ä–∞–Ω–∞!\nüìè –†–æ—Å—Ç: ${randomHeight} —Å–º`);
        }

        function applyRaceBonuses(raceId) {
            const race = races[raceId];
            if (!race || !race.bonuses) return;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –±–æ–Ω—É—Å—ã –∫ –Ω–∞–≤—ã–∫–∞–º
            Object.entries(race.bonuses).forEach(([skill, bonus]) => {
                const currentValue = getSkillValue(skill);
                setSkillValue(skill, currentValue + bonus);
            });
            
            updateUI();
        }

        function generateHeightForSelectedRace() {
            const selectedRace = document.getElementById('characterRace').value;
            if (!selectedRace) {
                alert('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å—É!');
                return;
            }
            
            const randomHeight = generateRandomHeight(selectedRace);
            document.getElementById('characterHeight').value = randomHeight;
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
            document.getElementById('generateHeightBtn').disabled = true;
            document.getElementById('generateHeightBtn').style.background = '#bdc3c7';
            
            saveCharacterData();
            
            alert(`üìè –ù–æ–≤—ã–π —Ä–æ—Å—Ç: ${randomHeight} —Å–º`);
        }

        function checkSkillLimit(skillName, newValue) {
            const selectedRaceId = document.getElementById('characterRace').value;
            if (!selectedRaceId) return true;
            
            const race = races[selectedRaceId];
            if (!race || !race.limitations) return true;
            
            const limitation = race.limitations[skillName];
            
            if (limitation === 0) {
                alert(`‚ùå –†–∞—Å–∞ "${race.name}" –Ω–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞–≤—ã–∫ "${skillName}"!`);
                return false;
            }
            
            if (limitation && newValue > limitation) {
                const confirmUpgrade = confirm(
                    `‚ö†Ô∏è –í—ã –ø—Ä–µ–≤—ã—à–∞–µ—Ç–µ –ª–∏–º–∏—Ç —Ä–∞—Å—ã –¥–ª—è –Ω–∞–≤—ã–∫–∞ "${skillName}"!\n\n` +
                    `–ú–∞–∫—Å–∏–º—É–º –¥–ª—è ${race.name}: ${limitation}\n` +
                    `–í—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å –ø–æ–≤—ã—Å–∏—Ç—å –¥–æ: ${newValue}\n\n` +
                    `–í—Å—ë —Ä–∞–≤–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å?`
                );
                
                return confirmUpgrade;
            }
            
            return true;
        }

        // –°–∏—Å—Ç–µ–º–∞ –≤–∫–ª–∞–¥–æ–∫
        function openTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName + '-tab').classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // === –°–ò–°–¢–ï–ú–ê –ò–ù–í–ï–ù–¢–ê–†–Ø ===
        function loadInventory() {
            const saved = localStorage.getItem('inventoryData');
            if (saved) {
                const data = JSON.parse(saved);
                inventory = data.inventory || inventory;
                inventoryCategories = data.categories || inventoryCategories;
            }
        }

        function saveInventory() {
            const data = {
                inventory: inventory,
                categories: inventoryCategories
            };
            localStorage.setItem('inventoryData', JSON.stringify(data));
        }

        function renderInventory() {
            const container = document.getElementById('inventory-tab');
            if (!container) return;

            container.innerHTML = `
                <div class="inventory-container">
                    <h2>üéí –ò–ù–í–ï–ù–¢–ê–†–¨</h2>
                    <div style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn" onclick="showCategoryManager()" style="background: #95a5a6;">‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏</button>
                        <button class="btn" onclick="addItem()" style="background: #27ae60;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç</button>
                    </div>
                    
                    <div id="inventory-categories">
                        ${inventoryCategories.map(category => `
                            <div class="category-section">
                                <div class="category-header">
                                    <h3>${category.name}</h3>
                                    <div class="item-actions">
                                        <button class="btn btn-small" onclick="addItemToCategory('${category.id}')" style="background: #27ae60;">‚ûï</button>
                                        ${category.editable ? `
                                            <button class="btn btn-small" onclick="editCategory('${category.id}')">‚úèÔ∏è</button>
                                            <button class="btn btn-small" onclick="deleteCategory('${category.id}')" style="background: #e74c3c;">‚ùå</button>
                                        ` : ''}
                                    </div>
                                </div>
                                <div class="category-items" id="items-${category.id}">
                                    ${renderCategoryItems(category.id)}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderCategoryItems(categoryId) {
            const items = inventory[categoryId] || [];
            if (items.length === 0) {
                return '<p style="color: #7f8c8d; text-align: center; padding: 20px;">–ü—É—Å—Ç–æ</p>';
            }
            
            return items.map((item, index) => `
                <div class="item-row">
                    <div class="item-info">
                        <div class="item-name">${item.name}</div>
                        <div class="item-details">${item.details || ''} ${item.quantity ? '√ó' + item.quantity : ''}</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-small" onclick="editInventoryItem('${categoryId}', ${index})">‚úèÔ∏è</button>
                        <button class="btn btn-small" onclick="deleteInventoryItem('${categoryId}', ${index})" style="background: #e74c3c;">‚ùå</button>
                    </div>
                </div>
            `).join('');
        }

        function showCategoryManager() {
            const popup = document.createElement('div');
            popup.className = 'inventory-popup';
            popup.innerHTML = `
                <div class="inventory-content">
                    <h2>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏</h2>
                    <div style="text-align: left; margin: 20px 0;">
                        ${inventoryCategories.map(category => `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #ecf0f1;">
                                <span>${category.name}</span>
                                ${category.editable ? `
                                    <div>
                                        <button class="btn btn-small" onclick="editCategory('${category.id}')">‚úèÔ∏è</button>
                                        <button class="btn btn-small" onclick="deleteCategory('${category.id}')" style="background: #e74c3c;">‚ùå</button>
                                    </div>
                                ` : '<span style="color: #7f8c8d;">–°–∏—Å—Ç–µ–º–Ω–∞—è</span>'}
                            </div>
                        `).join('')}
                    </div>
                    <button class="btn" onclick="addCategory()" style="background: #27ae60; margin-bottom: 10px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                    <button class="btn" onclick="this.closest('.inventory-popup').remove()" style="background: #34495e;">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            `;
            document.body.appendChild(popup);
        }

        function addCategory() {
            const categoryName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:');
            if (categoryName) {
                const categoryId = 'category_' + Date.now();
                const categoryIcon = 'üìÅ';
                
                inventoryCategories.push({
                    id: categoryId,
                    name: categoryIcon + ' ' + categoryName,
                    icon: categoryIcon,
                    editable: true
                });
                
                inventory[categoryId] = [];
                saveInventory();
                renderInventory();
                document.querySelector('.inventory-popup')?.remove();
            }
        }

        function editCategory(categoryId) {
            const category = inventoryCategories.find(cat => cat.id === categoryId);
            if (category && category.editable) {
                const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', category.name.replace(category.icon + ' ', ''));
                if (newName) {
                    category.name = category.icon + ' ' + newName;
                    saveInventory();
                    renderInventory();
                }
            }
        }

        function deleteCategory(categoryId) {
            const category = inventoryCategories.find(cat => cat.id === categoryId);
            if (category && category.editable) {
                if ((inventory[categoryId] || []).length === 0) {
                    if (confirm(`–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é "${category.name}"?`)) {
                        inventoryCategories = inventoryCategories.filter(cat => cat.id !== categoryId);
                        delete inventory[categoryId];
                        saveInventory();
                        renderInventory();
                        document.querySelector('.inventory-popup')?.remove();
                    }
                } else {
                    alert('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Å –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏!');
                }
            }
        }

        function addItem() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            let categoryOptions = '';
            inventoryCategories.forEach(category => {
                categoryOptions += `<option value="${category.id}">${category.name}</option>`;
            });
            
            const categoryId = prompt(`–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:\n\n${inventoryCategories.map((cat, index) => `${index + 1}. ${cat.name}`).join('\n')}\n\n–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:`);
            
            if (categoryId) {
                const categoryIndex = parseInt(categoryId) - 1;
                if (categoryIndex >= 0 && categoryIndex < inventoryCategories.length) {
                    const selectedCategory = inventoryCategories[categoryIndex];
                    addItemToCategory(selectedCategory.id);
                } else {
                    alert('–ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏!');
                }
            }
        }

        function addItemToCategory(categoryId) {
            const category = inventoryCategories.find(cat => cat.id === categoryId);
            if (!category) return;
            
            const name = prompt(`–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—é "${category.name}":\n\n–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞:`);
            if (name) {
                const details = prompt('–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):') || '';
                const quantity = prompt('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):') || '1';
                
                if (!inventory[categoryId]) {
                    inventory[categoryId] = [];
                }
                
                inventory[categoryId].push({
                    name: name,
                    details: details,
                    quantity: quantity,
                    added: new Date().toLocaleDateString()
                });
                
                saveInventory();
                renderInventory();
            }
        }

        function editInventoryItem(categoryId, index) {
            const item = inventory[categoryId][index];
            const newName = prompt('–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞:', item.name);
            if (newName) {
                const newDetails = prompt('–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞:', item.details);
                const newQuantity = prompt('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:', item.quantity);
                
                inventory[categoryId][index] = {
                    ...item,
                    name: newName,
                    details: newDetails || '',
                    quantity: newQuantity || ''
                };
                
                saveInventory();
                renderInventory();
            }
        }

        function deleteInventoryItem(categoryId, index) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç?')) {
                inventory[categoryId].splice(index, 1);
                saveInventory();
                renderInventory();
            }
        }

        // === –°–ò–°–¢–ï–ú–ê –ü–ï–†–°–û–ù–ê–ñ–ê ===
        function renderSkills() {
            const container = document.getElementById('skillsContainer');
            if (!container) return;
            
            container.innerHTML = '';

            for (const [groupName, skills] of Object.entries(skillsStructure)) {
                const section = document.createElement('div');
                section.className = 'skills-section';
                
                const title = document.createElement('div');
                title.className = 'section-title';
                title.innerHTML = groupName;
                section.appendChild(title);

                skills.forEach(skill => {
                    const skillRow = document.createElement('div');
                    skillRow.className = 'skill-row';
                    skillRow.innerHTML = `
                        <div class="skill-name"><span>üéØ</span><span>${skill}</span></div>
                        <div class="skill-controls">
                            <button class="btn btn-minus" onclick="decreaseSkill('${skill}')" disabled>-</button>
                            <span class="skill-value" id="skill-${skill}">5</span>
                            <button class="btn btn-plus" onclick="increaseSkill('${skill}')">+</button>
                            <button class="btn btn-roll" onclick="rollSkill('${skill}')">–ë—Ä–æ—Å–æ–∫</button>
                        </div>
                    `;
                    section.appendChild(skillRow);
                });
                container.appendChild(section);
            }
            updateUI();
        }

        // –°–∏—Å—Ç–µ–º–∞ –Ω–∞–≤—ã–∫–æ–≤
        function increaseSkill(skillName) {
            if (!checkSkillLimit(skillName, getSkillValue(skillName) + 1)) {
                return;
            }
            
            saveStateToHistory();
            const freePoints = getFreePoints();
            if (freePoints > 0) {
                const skillValue = getSkillValue(skillName);
                setSkillValue(skillName, skillValue + 1);
                setFreePoints(freePoints - 1);
                updateUI();
                saveCharacterData();
            }
        }

        function decreaseSkill(skillName) {
            saveStateToHistory();
            const skillValue = getSkillValue(skillName);
            if (skillValue > 5) {
                const freePoints = getFreePoints();
                setSkillValue(skillName, skillValue - 1);
                setFreePoints(freePoints + 1);
                updateUI();
                saveCharacterData();
            }
        }

        // –°–∏—Å—Ç–µ–º–∞ –±—Ä–æ—Å–∫–æ–≤
        function rollSkill(skillName) {
            const skillValue = getSkillValue(skillName);
            const roll1 = Math.floor(Math.random() * 6) + 1;
            const roll2 = Math.floor(Math.random() * 6) + 1;
            const roll3 = Math.floor(Math.random() * 6) + 1;
            const totalRoll = roll1 + roll2 + roll3;

            let resultType, resultText, resultClass;
            if (totalRoll === 3 || totalRoll === 4) {
                resultText = "üí´ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –£–°–ü–ï–•!";
                resultClass = "critical-success";
            } else if (totalRoll === 17 || totalRoll === 18) {
                resultText = "üí• –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ü–†–û–í–ê–õ!";
                resultClass = "critical-failure";
            } else if (totalRoll <= skillValue) {
                resultText = "‚úÖ –£–°–ü–ï–•!";
                resultClass = "success";
            } else {
                resultText = "‚ùå –ù–ï–£–î–ê–ß–ê!";
                resultClass = "failure";
            }

            addToRollHistory(skillName, [roll1, roll2, roll3], totalRoll, totalRoll <= skillValue);
            showRollResult(skillName, skillValue, [roll1, roll2, roll3], totalRoll, resultText, resultClass);
        }

        function showRollResult(skillName, skillValue, dice, total, resultText, resultClass) {
            const popup = document.createElement('div');
            popup.className = 'result-popup';
            popup.innerHTML = `
                <div class="result-content">
                    <h2>–ë—Ä–æ—Å–æ–∫ –Ω–∞ "${skillName}" (${skillValue})</h2>
                    <div class="dice-rolls">
                        <div class="dice">${dice[0]}</div>
                        <div class="dice">${dice[1]}</div>
                        <div class="dice">${dice[2]}</div>
                    </div>
                    <div style="font-size: 1.5em; margin: 15px 0;">${dice.join(' + ')} = ${total}</div>
                    <div class="${resultClass}">${resultText}</div>
                    <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <button class="btn" onclick="rollSkill('${skillName}'); this.closest('.result-popup').remove()" style="background: #3498db; color: white;">üé≤ –ë—Ä–æ—Å–∏—Ç—å –µ—â—ë</button>
                        <button class="btn" onclick="showRollHistory('${skillName}')" style="background: #9b59b6; color: white;">üìú –ò—Å—Ç–æ—Ä–∏—è</button>
                        <button class="btn" onclick="this.closest('.result-popup').remove()" style="background: #34495e; color: white;">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            `;
            document.body.appendChild(popup);
        }

        function loadRollHistory() {
            const saved = localStorage.getItem('rollHistory');
            if (saved) {
                Object.assign(rollHistory, JSON.parse(saved));
            }
        }

        function addToRollHistory(skillName, dice, total, success) {
            if (!rollHistory[skillName]) {
                rollHistory[skillName] = [];
            }
            
            rollHistory[skillName].unshift({
                dice: dice,
                total: total,
                success: success,
                timestamp: new Date().toLocaleTimeString()
            });
            
            if (rollHistory[skillName].length > 10) {
                rollHistory[skillName].pop();
            }
            
            localStorage.setItem('rollHistory', JSON.stringify(rollHistory));
        }

        function showRollHistory(skillName) {
            const history = rollHistory[skillName] || [];
            let historyHTML = '<h3>–ò—Å—Ç–æ—Ä–∏—è –±—Ä–æ—Å–∫–æ–≤ "' + skillName + '"</h3>';
            
            if (history.length === 0) {
                historyHTML += '<p>–ü–æ–∫–∞ –Ω–µ—Ç –±—Ä–æ—Å–∫–æ–≤</p>';
            } else {
                historyHTML += '<div style="text-align: left; max-height: 200px; overflow-y: auto;">';
                history.forEach((roll, index) => {
                    const resultIcon = roll.total === 3 || roll.total === 4 ? 'üí´' : 
                                     roll.total === 17 || roll.total === 18 ? 'üí•' :
                                     roll.success ? '‚úÖ' : '‚ùå';
                    historyHTML += `<p>${index + 1}. [${roll.dice.join(',')}] = ${roll.total} ${resultIcon}</p>`;
                });
                historyHTML += '</div>';
            }
            
            const popup = document.createElement('div');
            popup.className = 'result-popup';
            popup.innerHTML = `
                <div class="result-content">
                    ${historyHTML}
                    <button class="btn close-btn" onclick="this.closest('.result-popup').remove()" style="background: #34495e; color: white; padding: 10px 25px; margin-top: 15px;">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            `;
            document.body.appendChild(popup);
        }

        // –°–∏—Å—Ç–µ–º–∞ —É—Ä–æ–≤–Ω–µ–π
        function addExperience() {
            saveStateToHistory();
            const expToAdd = prompt('–°–∫–æ–ª—å–∫–æ –æ–ø—ã—Ç–∞ –¥–æ–±–∞–≤–∏—Ç—å?');
            if (expToAdd && !isNaN(expToAdd)) {
                let currentExp = getCurrentExp();
                const currentLevel = getCurrentLevel();
                
                currentExp += parseInt(expToAdd);
                setCurrentExp(currentExp);
                
                checkLevelUp();
                updateLevelDisplay();
                saveCharacterData();
            }
        }

        function checkLevelUp() {
            let currentLevel = getCurrentLevel();
            let currentExp = getCurrentExp();
            
            if (currentLevel >= 9) return;
            
            while (currentLevel < 9 && currentExp >= levelTable[currentLevel].expRequired) {
                currentLevel++;
                
                const health = getHealth() + levelTable[currentLevel].hp;
                const mana = getMana() + levelTable[currentLevel].mana;
                const stamina = getStamina() + levelTable[currentLevel].stamina;
                const freePoints = getFreePoints() + levelTable[currentLevel].points;
                
                setHealth(health);
                setMana(mana);
                setStamina(stamina);
                setFreePoints(freePoints);
                
                currentExp = currentExp - levelTable[currentLevel-1].expRequired;
                setCurrentExp(currentExp);
                
                setCurrentLevel(currentLevel);
                
                showMessage(`üéâ –£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω –¥–æ ${currentLevel}!`);
            }
        }

        function editLevel() {
            saveStateToHistory();
            const newLevel = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å (0-9):', getCurrentLevel());
            if (newLevel && !isNaN(newLevel) && newLevel >= 0 && newLevel <= 9) {
                setCurrentLevel(parseInt(newLevel));
                updateStatsForLevel();
                updateLevelDisplay();
                saveCharacterData();
            }
        }

        function updateStatsForLevel() {
            const currentLevel = getCurrentLevel();
            let totalHP = 100, totalMana = 100, totalStamina = 100;
            
            for (let i = 0; i <= currentLevel; i++) {
                totalHP += levelTable[i].hp;
                totalMana += levelTable[i].mana;
                totalStamina += levelTable[i].stamina;
            }
            
            setHealth(totalHP);
            setMana(totalMana);
            setStamina(totalStamina);
        }

        function convertExpToPoints() {
            saveStateToHistory();
            const currentExp = getCurrentExp();
            const availablePoints = Math.floor(currentExp / 1000);
            
            if (availablePoints > 0) {
                const expToConvert = availablePoints * 1000;
                setCurrentExp(currentExp - expToConvert);
                setFreePoints(getFreePoints() + availablePoints);
                
                showMessage(`üíé –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${availablePoints} –æ—á–∫–æ–≤ –Ω–∞–≤—ã–∫–æ–≤!`);
                updateLevelDisplay();
                updateUI();
                saveCharacterData();
            }
        }

        function updateLevelDisplay() {
            const currentLevel = getCurrentLevel();
            const currentExp = getCurrentExp();
            const convertBtn = document.getElementById('convertBtn');
            const convertInfo = document.getElementById('convertInfo');
            
            document.getElementById('currentLevel').textContent = currentLevel;
            document.getElementById('currentExp').value = currentExp;
            
            if (currentLevel < 9) {
                document.getElementById('requiredExp').textContent = levelTable[currentLevel].expRequired;
                convertBtn.style.display = 'none';
                convertInfo.style.display = 'none';
            } else {
                document.getElementById('requiredExp').textContent = 'MAX';
                convertBtn.style.display = 'block';
                convertInfo.style.display = 'block';
            }
        }

        function showLevelsTable() {
            const currentLevel = getCurrentLevel();
            const popup = document.createElement('div');
            popup.className = 'levels-popup';
            popup.innerHTML = `
                <div class="levels-content">
                    <h2>üìä –¢–∞–±–ª–∏—Ü–∞ —É—Ä–æ–≤–Ω–µ–π</h2>
                    <table class="levels-table">
                        <tr><th>–£—Ä.</th><th>–û–ø—ã—Ç</th><th>–•–ü</th><th>–ú–∞–Ω–∞</th><th>–°—Ç–∞–º–∏–Ω–∞</th><th>–û—á–∫–∏</th></tr>
                        ${Object.entries(levelTable).map(([level, data]) => `
                            <tr class="${level == currentLevel ? 'current-level' : ''}">
                                <td>${level}</td>
                                <td>${data.expRequired || 'MAX'}</td>
                                <td>+${data.hp}</td>
                                <td>+${data.mana}</td>
                                <td>+${data.stamina}</td>
                                <td>+${data.points}</td>
                            </tr>
                        `).join('')}
                    </table>
                    <button class="btn close-btn" onclick="this.closest('.levels-popup').remove()" style="background: #34495e; color: white; padding: 10px 25px; margin-top: 15px;">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            `;
            document.body.appendChild(popup);
        }

        // –°–∏—Å—Ç–µ–º–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
        function changeStat(stat, value) {
            saveStateToHistory();
            const input = document.getElementById(stat);
            let currentValue = parseInt(input.value) || 0;
            let newValue = currentValue + value;
            
            if (newValue < 0) newValue = 0;
            
            input.value = newValue;
            saveCharacterData();
        }

        function editFreePoints() {
            saveStateToHistory();
            const newPoints = prompt('–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –æ—á–∫–æ–≤:', getFreePoints());
            if (newPoints && !isNaN(newPoints)) {
                setFreePoints(parseInt(newPoints));
                updateUI();
                saveCharacterData();
            }
        }

        // –ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π
        function saveStateToHistory() {
            const state = {
                level: getCurrentLevel(),
                exp: getCurrentExp(),
                health: getHealth(),
                mana: getMana(),
                stamina: getStamina(),
                freePoints: getFreePoints(),
                skills: {}
            };

            for (const group of Object.values(skillsStructure)) {
                for (const skill of group) {
                    state.skills[skill] = getSkillValue(skill);
                }
            }

            actionHistory = actionHistory.slice(0, currentHistoryIndex + 1);
            actionHistory.push(state);
            currentHistoryIndex = actionHistory.length - 1;
            updateHistoryButtons();
        }

        function undo() {
            if (currentHistoryIndex > 0) {
                currentHistoryIndex--;
                loadStateFromHistory();
            }
        }

        function redo() {
            if (currentHistoryIndex < actionHistory.length - 1) {
                currentHistoryIndex++;
                loadStateFromHistory();
            }
        }

        function loadStateFromHistory() {
            const state = actionHistory[currentHistoryIndex];
            
            setCurrentLevel(state.level);
            setCurrentExp(state.exp);
            setHealth(state.health);
            setMana(state.mana);
            setStamina(state.stamina);
            setFreePoints(state.freePoints);
            
            for (const [skill, value] of Object.entries(state.skills)) {
                setSkillValue(skill, value);
            }
            
            updateLevelDisplay();
            updateUI();
            updateHistoryButtons();
        }

        function updateHistoryButtons() {
            const undoBtn = document.getElementById('undoBtn');
            const redoBtn = document.getElementById('redoBtn');
            if (undoBtn && redoBtn) {
                undoBtn.disabled = currentHistoryIndex <= 0;
                redoBtn.disabled = currentHistoryIndex >= actionHistory.length - 1;
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function updateUI() {
            const freePoints = getFreePoints();
            const warning = document.getElementById('pointsWarning');
            if (warning) {
                warning.style.display = freePoints === 0 ? 'block' : 'none';
            }
            
            document.querySelectorAll('.skill-row').forEach(row => {
                const skillName = row.querySelector('.skill-name span:nth-child(2)').textContent;
                const skillValue = getSkillValue(skillName);
                const minusBtn = row.querySelector('.btn-minus');
                const plusBtn = row.querySelector('.btn-plus');
                
                row.querySelector('.skill-value').textContent = skillValue;
                minusBtn.disabled = skillValue <= 5;
                plusBtn.disabled = freePoints <= 0;
            });
        }

        function showMessage(text) {
            alert(text);
        }

        // –ì–µ—Ç—Ç–µ—Ä—ã/—Å–µ—Ç—Ç–µ—Ä—ã
        function getFreePoints() { 
            const element = document.getElementById('freePoints');
            return element ? parseInt(element.value) || 0 : 0; 
        }

        function setFreePoints(value) { 
            const element = document.getElementById('freePoints');
            if (element) element.value = value; 
        }

        function getCurrentLevel() { return parseInt(localStorage.getItem('currentLevel')) || 0; }
        function setCurrentLevel(value) { localStorage.setItem('currentLevel', value); }

        function getCurrentExp() { return parseInt(localStorage.getItem('currentExp')) || 0; }
        function setCurrentExp(value) { localStorage.setItem('currentExp', value); }

        function getHealth() { 
            const element = document.getElementById('health');
            return element ? parseInt(element.value) || 100 : 100; 
        }

        function setHealth(value) { 
            const element = document.getElementById('health');
            if (element) element.value = value; 
        }

        function getMana() { 
            const element = document.getElementById('mana');
            return element ? parseInt(element.value) || 100 : 100; 
        }

        function setMana(value) { 
            const element = document.getElementById('mana');
            if (element) element.value = value; 
        }

        function getStamina() { 
            const element = document.getElementById('stamina');
            return element ? parseInt(element.value) || 100 : 100; 
        }

        function setStamina(value) { 
            const element = document.getElementById('stamina');
            if (element) element.value = value; 
        }

        function getSkillValue(skillName) { return parseInt(localStorage.getItem(`skill_${skillName}`)) || 5; }
        function setSkillValue(skillName, value) { localStorage.setItem(`skill_${skillName}`, value); }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞
        function saveCharacterData() {
            localStorage.setItem('characterName', document.getElementById('characterName').value);
            localStorage.setItem('characterSurname', document.getElementById('characterSurname').value);
            localStorage.setItem('characterTitle', document.getElementById('characterTitle').value);
            localStorage.setItem('characterRace', document.getElementById('characterRace').value);
            localStorage.setItem('characterHeritage', document.getElementById('characterHeritage').value);
            localStorage.setItem('characterHeight', document.getElementById('characterHeight').value);
            localStorage.setItem('characterWeight', document.getElementById('characterWeight').value);
            localStorage.setItem('characterAge', document.getElementById('characterAge').value);
        }

        function loadCharacterData() {
            document.getElementById('characterName').value = localStorage.getItem('characterName') || '';
            document.getElementById('characterSurname').value = localStorage.getItem('characterSurname') || '';
            document.getElementById('characterTitle').value = localStorage.getItem('characterTitle') || '';
            document.getElementById('characterRace').value = localStorage.getItem('characterRace') || '';
            document.getElementById('characterHeritage').value = localStorage.getItem('characterHeritage') || '';
            document.getElementById('characterHeight').value = localStorage.getItem('characterHeight') || '';
            document.getElementById('characterWeight').value = localStorage.getItem('characterWeight') || '';
            document.getElementById('characterAge').value = localStorage.getItem('characterAge') || '';
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É —Ä–æ—Å—Ç–∞ –µ—Å–ª–∏ —Ä–∞—Å–∞ —É–∂–µ –≤—ã–±—Ä–∞–Ω–∞
            if (localStorage.getItem('characterRace')) {
                document.getElementById('generateHeightBtn').disabled = true;
                document.getElementById('generateHeightBtn').style.background = '#bdc3c7';
            }
        }

        // –°–ª—É—à–∞—Ç–µ–ª–∏
        document.getElementById('characterName').addEventListener('input', saveCharacterData);
        document.getElementById('characterSurname').addEventListener('input', saveCharacterData);
        document.getElementById('characterTitle').addEventListener('input', saveCharacterData);
        document.getElementById('characterRace').addEventListener('change', saveCharacterData);
        document.getElementById('characterHeritage').addEventListener('input', saveCharacterData);
        document.getElementById('characterHeight').addEventListener('input', saveCharacterData);
        document.getElementById('characterWeight').addEventListener('input', saveCharacterData);
        document.getElementById('characterAge').addEventListener('input', saveCharacterData);
        document.getElementById('health').addEventListener('input', saveCharacterData);
        document.getElementById('mana').addEventListener('input', saveCharacterData);
        document.getElementById('stamina').addEventListener('input', saveCharacterData);
        document.getElementById('freePoints').addEventListener('input', function() {
            updateUI();
            saveCharacterData();
        });
        document.getElementById('currentExp').addEventListener('input', function() {
            setCurrentExp(parseInt(this.value) || 0);
            checkLevelUp();
            updateLevelDisplay();
            saveCharacterData();
        });
    </script>
</body>
</html>
