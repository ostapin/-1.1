<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D Character Sheet</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Times New Roman', serif; 
            background: #1a0f0b; 
            color: #e0d0c0; 
            padding: 20px; 
            min-height: 100vh; 
        }
        .container { 
            max-width: 900px; 
            margin: 0 auto; 
            background: #2c1810; 
            border: 3px solid #8b4513; 
            border-radius: 8px; 
            overflow: hidden; 
        }

        .tabs { 
            display: flex; 
            background: linear-gradient(to bottom, #5a3928, #3d2418); 
            border-bottom: 2px solid #8b4513; 
        }
        .tab-btn { 
            flex: 1; 
            padding: 15px; 
            border: none; 
            background: transparent; 
            color: #e0d0c0; 
            font-size: 16px; 
            cursor: pointer; 
            transition: all 0.3s; 
            border-right: 1px solid #8b4513;
            font-family: 'Times New Roman', serif;
        }
        .tab-btn:last-child { border-right: none; }
        .tab-btn.active { 
            background: #8b4513; 
            text-shadow: 0 0 5px #ffd700;
        }
        .tab-content { display: none; padding: 20px; }
        .tab-content.active { display: block; }
        
        .header { 
            background: linear-gradient(to bottom, #3d2418, #2c1810); 
            color: #e0d0c0; 
            padding: 25px; 
            text-align: center; 
            border-bottom: 3px solid #8b4513;
        }
        .character-info { 
            display: flex; 
            gap: 15px; 
            margin-bottom: 15px; 
            flex-wrap: wrap; 
            justify-content: center; 
        }
        .input-group { 
            flex: 1; 
            min-width: 200px; 
        }
        .input-group label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: bold; 
            color: #d4af37; 
            font-size: 0.9em;
        }
        .input-group input, .input-group select { 
            width: 100%; 
            padding: 12px; 
            border: 2px solid #8b4513; 
            border-radius: 4px; 
            font-size: 16px; 
            background: #1a0f0b; 
            color: #e0d0c0;
        }
        .input-row { 
            display: flex; 
            gap: 10px; 
            align-items: center; 
        }
        
        .level-system { 
            background: #3d2418; 
            padding: 20px; 
            border-bottom: 2px solid #8b4513; 
        }
        .level-display { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 15px; 
        }
        .level-info { 
            font-size: 1.3em; 
            font-weight: bold; 
            color: #d4af37; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        .exp-display { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        .exp-input { 
            width: 120px; 
            padding: 10px; 
            border: 2px solid #8b4513; 
            border-radius: 4px; 
            font-size: 16px; 
            text-align: center; 
            background: #1a0f0b;
            color: #e0d0c0;
        }
        
        .stats-panel { 
            padding: 20px; 
            background: #2c1810; 
            border-bottom: 2px solid #5a3928; 
        }
        .stat-row { 
            display: flex; 
            align-items: center; 
            padding: 12px 0; 
            gap: 15px; 
            border-bottom: 1px solid #3d2418;
        }
        .stat-row:last-child { border-bottom: none; }
        .stat-label { 
            flex: 1; 
            font-weight: bold; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            color: #d4af37;
        }
        .stat-input { 
            width: 100px; 
            padding: 10px; 
            border: 2px solid #8b4513; 
            border-radius: 4px; 
            text-align: center; 
            font-size: 16px; 
            background: #1a0f0b;
            color: #e0d0c0;
        }
        
        .points-panel { 
            padding: 20px; 
            background: #3d2418; 
            border-bottom: 2px solid #8b4513; 
        }
        .points-display { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 15px; 
        }
        
        .skills-section { 
            padding: 25px; 
            border-bottom: 2px solid #5a3928; 
        }
        .section-title { 
            font-size: 1.5em; 
            color: #d4af37; 
            margin-bottom: 20px; 
            padding-bottom: 12px; 
            border-bottom: 2px solid #8b4513; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        .skill-row { 
            display: flex; 
            align-items: center; 
            padding: 15px 0; 
            border-bottom: 1px solid #3d2418;
        }
        .skill-row:last-child { border-bottom: none; }
        .skill-name { 
            flex: 2; 
            font-weight: 500; 
            display: flex; 
            align-items: center; 
            gap: 12px; 
        }
        .skill-controls { 
            flex: 1; 
            display: flex; 
            align-items: center; 
            justify-content: flex-end; 
            gap: 12px; 
        }
        .skill-value { 
            font-size: 1.3em; 
            font-weight: bold; 
            color: #d4af37; 
            min-width: 40px; 
            text-align: center; 
        }
        
        .btn { 
            padding: 12px 16px; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 14px; 
            font-weight: bold; 
            transition: all 0.3s; 
            min-height: 44px;
        }
        .btn-plus { background: #27ae60; color: white; }
        .btn-minus { background: #c44536; color: white; }
        .btn-roll { background: #8b4513; color: white; }
        .btn-dice { background: #3498db; color: white; margin: 5px; }
        .btn-small { padding: 10px 14px; font-size: 12px; min-height: 40px; }
        .btn-lock { background: #95a5a6; color: white; padding: 10px 12px; }
        .btn-lock.locked { background: #e74c3c; }
        .btn:disabled { 
            background: #5a3928; 
            color: #8b7d6b; 
            cursor: not-allowed; 
        }

        .popup { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(26, 15, 11, 0.95); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            z-index: 1000; 
        }
        .popup-content { 
            background: #2c1810; 
            padding: 25px; 
            border-radius: 8px; 
            max-width: 95%; 
            width: 500px; 
            max-height: 90vh; 
            overflow-y: auto; 
            border: 3px solid #8b4513;
        }
        .spells-content { width: 95%; text-align: left; }

        .dice-rolls { 
            display: flex; 
            justify-content: center; 
            gap: 15px; 
            margin: 20px 0; 
            flex-wrap: wrap;
        }
        .dice { 
            width: 50px; 
            height: 50px; 
            background: #8b4513; 
            border-radius: 8px; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            font-size: 1.5em; 
            font-weight: bold; 
            color: #1a0f0b; 
        }
        
        .success { color: #27ae60; font-weight: bold; font-size: 1.3em; }
        .failure { color: #e74c3c; font-weight: bold; font-size: 1.3em; }
        
        .skill-disabled {
            opacity: 0.4;
            color: #8b7d6b !important;
        }
        .skill-disabled .skill-value {
            color: #8b7d6b !important;
        }

        .skill-locked {
            opacity: 0.6;
            color: #8b7d6b !important;
            background: #3d2418;
        }
        .skill-locked .skill-value {
            color: #8b7d6b !important;
        }

        .spell-icon {
            cursor: pointer;
            margin-left: 10px;
            font-size: 1.2em;
        }

        .spell-item {
            background: #3d2418;
            margin: 10px 0;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }
        .spell-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .spell-name {
            font-weight: bold;
            color: #d4af37;
            font-size: 1.1em;
        }
        .spell-order {
            background: #8b4513;
            color: #e0d0c0;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .spell-details {
            color: #b8a28a;
            font-size: 0.95em;
            line-height: 1.4;
        }
        .spell-learned {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }

        .dice-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
            align-items: center;
        }

        .dice-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .dice-count {
            width: 80px;
            padding: 12px;
            border: 2px solid #8b4513;
            border-radius: 4px;
            background: #1a0f0b;
            color: #e0d0c0;
            text-align: center;
            font-size: 16px;
        }

        .custom-dice-input {
            width: 80px;
            padding: 12px;
            border: 2px solid #8b4513;
            border-radius: 4px;
            background: #1a0f0b;
            color: #e0d0c0;
            text-align: center;
            font-size: 16px;
        }

        .notes-container {
            margin: 20px 0;
        }
        .note-item {
            background: #3d2418;
            margin: 10px 0;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #27ae60;
        }
        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .note-title {
            font-weight: bold;
            color: #d4af37;
            font-size: 1.1em;
        }
        .note-preview {
            color: #b8a28a;
            font-size: 0.95em;
            line-height: 1.4;
        }
        .note-actions {
            display: flex;
            gap: 10px;
        }

        .inventory-item {
            background: #3d2418;
            margin: 10px 0;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #d4af37;
        }
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .item-name {
            font-weight: bold;
            color: #d4af37;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .item-quantity {
            background: #8b4513;
            color: #e0d0c0;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .item-description {
            color: #b8a28a;
            font-size: 0.95em;
            line-height: 1.4;
            margin-top: 8px;
        }
        .item-actions {
            display: flex;
            gap: 8px;
        }

        .search-box {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #8b4513;
            border-radius: 4px;
            background: #1a0f0b;
            color: #e0d0c0;
            font-size: 16px;
        }

        .export-import {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .custom-categories {
            margin: 15px 0;
            padding: 15px;
            background: #3d2418;
            border-radius: 6px;
        }

        .category-management {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .character-info, .stat-row, .skill-row { flex-direction: column; gap: 12px; }
            .skill-controls { width: 100%; justify-content: space-between; }
            .exp-display, .level-display { flex-direction: column; gap: 15px; }
            .points-display { flex-direction: column; }
            .tabs { flex-direction: column; }
            .dice-container { flex-direction: column; }
            .btn { min-height: 48px; font-size: 16px; }
            .popup-content { padding: 20px; margin: 10px; }
            .skill-name { flex-direction: column; align-items: flex-start; gap: 8px; }
        }

        @media (max-width: 480px) {
            body { padding: 10px; }
            .container { border-width: 2px; }
            .tab-btn { padding: 12px 8px; font-size: 14px; }
            .header { padding: 15px; }
            .skills-section { padding: 15px; }
            .dice { width: 45px; height: 45px; font-size: 1.3em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="tabs">
    <button class="tab-btn active" onclick="openTab('character')">üßô –ü–µ—Ä—Å–æ–Ω–∞–∂</button>
    <button class="tab-btn" onclick="openTab('generator')">üé≤ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</button>
    <button class="tab-btn" onclick="openTab('inventory')">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
    <button class="tab-btn" onclick="openTab('dice')">üé≤ –ö—É–±–∏–∫–∏</button>
    <button class="tab-btn" onclick="openTab('notes')">‚úçÔ∏è –ó–∞–º–µ—Ç–∫–∏</button>
    <!-- üëá –î–û–ë–ê–í–õ–Ø–ï–ú –≠–¢–£ –°–¢–†–û–ö–£ üëá -->
    <button class="tab-btn" onclick="openTab('characters')">üë• –ü–µ—Ä—Å–æ–Ω–∞–∂–∏</button>
</div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ -->
        <div id="character-tab" class="tab-content active">
            <div class="header">
                <h1 style="font-size: 2.2em; color: #d4af37; margin-bottom: 20px;">‚öîÔ∏è D&D Character Sheet</h1>
                <div class="character-info">
                    <div class="input-group">
                        <label for="characterName">–ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:</label>
                        <input type="text" id="characterName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
                    </div>
                    <div class="input-group">
                        <label for="characterSurname">–§–∞–º–∏–ª–∏—è:</label>
                        <input type="text" id="characterSurname" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é">
                    </div>
                    <div class="input-group">
                        <label for="characterTitle">–¢–∏—Ç—É–ª:</label>
                        <input type="text" id="characterTitle" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–∏—Ç—É–ª">
                    </div>
                </div>

                <div class="character-info">
                    <div class="input-group">
                        <label for="characterRace">–†–∞—Å–∞:</label>
                        <select id="characterRace" onchange="onRaceChange()">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å—É</option>
                            <option value="atski">üî• –ê—Ü–∫–∏ (–ü–µ—Ä—Å—ã)</option>
                            <option value="knofi">üó£Ô∏è –ö–Ω–æ—Ñ—ã (–†–∏–º–ª—è–Ω–µ)</option>
                            <option value="vorki">‚ùÑÔ∏è –í–æ—Ä–∫–∏ (–í–∏–∫–∏–Ω–≥–∏)</option>
                            <option value="minci">üéØ –ú–∏–Ω—Ü—ã (–ê–∑–∏–∞—Ç—ã)</option>
                            <option value="kaei">‚öíÔ∏è –ö–∞—ç–π—Ü—ã (–ù–µ–≥—Ä—ã)</option>
                            <option value="forest_elf">üåø –õ–µ—Å–Ω—ã–µ —ç–ª—å—Ñ—ã</option>
                            <option value="high_elf">‚ú® –í—ã—Å—à–∏–µ —ç–ª—å—Ñ—ã</option>
                            <option value="dark_elf">üåë –¢–µ–º–Ω—ã–µ —ç–ª—å—Ñ—ã</option>
                            <option value="dwarf">‚õ∞Ô∏è –î–≤–∞—Ä—Ñ—ã</option>
                            <option value="gnome">üîÆ –ì–Ω–æ–º—ã</option>
                            <option value="orc">üíÄ –û—Ä–∫–∏</option>
                            <option value="goblin">üëπ –ì–æ–±–ª–∏–Ω—ã</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="characterHeritage">–ù–∞—Å–ª–µ–¥–∏–µ:</label>
                        <input type="text" id="characterHeritage" placeholder="–û—Å–æ–±–æ–µ –Ω–∞—Å–ª–µ–¥–∏–µ">
                    </div>
                </div>

                <div class="character-info">
                    <div class="input-group">
                        <label for="characterHeight">–†–æ—Å—Ç (—Å–º):</label>
                        <div class="input-row">
                            <input type="number" id="characterHeight" readonly>
                            <button class="btn" id="generateHeightBtn" onclick="generateHeightForSelectedRace()" style="background: #8b4513; color: white;">üé≤ –ê–≤—Ç–æ</button>
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="characterWeight">–í–µ—Å (–∫–≥):</label>
                        <input type="number" id="characterWeight" placeholder="–í–µ—Å">
                    </div>
                    <div class="input-group">
                        <label for="characterAge">–í–æ–∑—Ä–∞—Å—Ç (–ª–µ—Ç):</label>
                        <input type="number" id="characterAge" placeholder="–í–æ–∑—Ä–∞—Å—Ç">
                    </div>
                </div>
            </div>

            <div class="level-system">
                <div class="level-display">
                    <div class="level-info">
                        –£—Ä–æ–≤–µ–Ω—å: <span id="currentLevel">0</span>
                        <button class="btn btn-roll" onclick="editLevel()">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å</button>
                        <button class="btn btn-roll" onclick="showLevelsTable()">üìä –¢–∞–±–ª–∏—Ü–∞</button>
                    </div>
                    <div class="exp-display">
                        <input type="number" id="currentExp" class="exp-input" value="0" min="0">
                        <span style="color: #d4af37; font-weight: bold;">/ <span id="requiredExp">1000</span> XP</span>
                        <button class="btn btn-plus" onclick="addExperience()">‚ûï –û–ø—ã—Ç</button>
                        <button class="btn btn-roll" id="convertBtn" onclick="convertExpToPoints()" style="display: none;">üíé –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                </div>
            </div>

            <div class="stats-panel">
                <div class="stat-row">
                    <div class="stat-label">‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ:</div>
                    <input type="number" class="stat-input" id="health" value="100">
                    <button class="btn btn-minus" onclick="changeStat('health', -5)">-5</button>
                    <button class="btn btn-plus" onclick="changeStat('health', 5)">+5</button>
                </div>
                <div class="stat-row">
                    <div class="stat-label">üîÆ –ú–∞–Ω–∞:</div>
                    <input type="number" class="stat-input" id="mana" value="100">
                    <button class="btn btn-minus" onclick="changeStat('mana', -5)">-5</button>
                    <button class="btn btn-plus" onclick="changeStat('mana', 5)">+5</button>
                </div>
                <div class="stat-row">
                    <div class="stat-label">‚ö° –í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å:</div>
                    <input type="number" class="stat-input" id="stamina" value="100">
                    <button class="btn btn-minus" onclick="changeStat('stamina', -5)">-5</button>
                    <button class="btn btn-plus" onclick="changeStat('stamina', 5)">+5</button>
                </div>
            </div>

            <div class="points-panel">
                <div class="points-display">
                    <span style="font-size: 1.3em; font-weight: bold; color: #d4af37;">–°–≤–æ–±–æ–¥–Ω—ã–µ –æ—á–∫–∏ –Ω–∞–≤—ã–∫–æ–≤:</span>
                    <input type="number" id="freePoints" class="stat-input" value="0">
                    <button class="btn btn-roll" onclick="editFreePoints()">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å</button>
                </div>
            </div>

            <div id="skillsContainer"></div>

            <div class="export-import">
                <button class="btn btn-plus" onclick="exportCharacter()">üíæ –≠–∫—Å–ø–æ—Ä—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
                <button class="btn btn-roll" onclick="importCharacter()">üì• –ò–º–ø–æ—Ä—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
            </div>
        </div>

        <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ -->
        <div id="generator-tab" class="tab-content">
            <h2 style="color: #d4af37; text-align: center; margin-bottom: 25px;">üé≤ –ú–ê–°–¢–ï–†–°–ö–ê–Ø –ì–ï–ù–ï–†–ê–¶–ò–ò</h2>
            
            <div class="skills-section">
                <div class="section-title">üë§ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <select id="genRace" style="padding: 12px; border: 2px solid #8b4513; border-radius: 4px; background: #1a0f0b; color: #e0d0c0;">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å—É</option>
                        <option value="atski">–ê—Ü–∫–∏</option>
                        <option value="knofi">–ö–Ω–æ—Ñ—ã</option>
                        <option value="vorki">–í–æ—Ä–∫–∏</option>
                        <option value="minci">–ú–∏–Ω—Ü—ã</option>
                        <option value="kaei">–ö–∞—ç–π—Ü—ã</option>
                        <option value="forest_elf">–õ–µ—Å–Ω—ã–µ —ç–ª—å—Ñ—ã</option>
                        <option value="high_elf">–í—ã—Å—à–∏–µ —ç–ª—å—Ñ—ã</option>
                        <option value="dark_elf">–¢–µ–º–Ω—ã–µ —ç–ª—å—Ñ—ã</option>
                        <option value="dwarf">–î–≤–∞—Ä—Ñ—ã</option>
                        <option value="gnome">–ì–Ω–æ–º—ã</option>
                        <option value="orc">–û—Ä–∫–∏</option>
                        <option value="goblin">–ì–æ–±–ª–∏–Ω—ã</option>
                    </select>
                    <select id="genGender" style="padding: 12px; border: 2px solid #8b4513; border-radius: 4px; background: #1a0f0b; color: #e0d0c0;">
                        <option value="random">üé≤ –°–ª—É—á–∞–π–Ω—ã–π –ø–æ–ª</option>
                        <option value="male">üë® –ú—É–∂—Å–∫–æ–π</option>
                        <option value="female">üë© –ñ–µ–Ω—Å–∫–∏–π</option>
                    </select>
                </div>
                <button class="btn btn-roll" onclick="generateFullCharacter()" style="width: 100%;">üé≠ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
                <div id="characterResult" style="margin-top: 15px; padding: 15px; background: #3d2418; border-radius: 6px; display: none;"></div>
            </div>

            <div class="skills-section">
                <div class="section-title">üèõÔ∏è –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–∞–∑–≤–∞–Ω–∏–π</div>
                <select id="nameType" style="width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #8b4513; border-radius: 4px; background: #1a0f0b; color: #e0d0c0;">
                    <option value="tavern">üç∫ –¢–∞–≤–µ—Ä–Ω–∞</option>
                    <option value="inn">üèöÔ∏è –¢—Ä–∞–∫—Ç–∏—Ä</option>
                    <option value="shop">üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω</option>
                    <option value="blacksmith">‚öíÔ∏è –ö—É–∑–Ω–∏—Ü–∞</option>
                    <option value="temple">‚õ™ –•—Ä–∞–º</option>
                    <option value="city">üè∞ –ì–æ—Ä–æ–¥</option>
                    <option value="kingdom">üëë –ö–æ—Ä–æ–ª–µ–≤—Å—Ç–≤–æ</option>
                    <option value="ship">‚õµ –ö–æ—Ä–∞–±–ª—å</option>
                    <option value="gang">üíÄ –ë–∞–Ω–¥–∞</option>
                </select>
                <input type="text" id="nameTheme" placeholder="–¢–µ–º–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –º–æ—Ä–µ, –ª–µ—Å, –æ–≥–æ–Ω—å)" style="width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #8b4513; border-radius: 4px; background: #1a0f0b; color: #e0d0c0;">
                <button class="btn btn-roll" onclick="generateName()" style="width: 100%;">üé≤ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ</button>
                <div id="nameResult" style="margin-top: 15px; padding: 15px; background: #3d2418; border-radius: 6px; display: none;"></div>
            </div>

            <div class="skills-section">
                <div class="section-title">üé≠ –û—Ç–ª–∏—á–∏—Ç–µ–ª—å–Ω—ã–µ —á–µ—Ä—Ç—ã</div>
                <select id="traitType" style="width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #8b4513; border-radius: 4px; background: #1a0f0b; color: #e0d0c0;">
                    <option value="appearance">üë® –í–Ω–µ—à–Ω–æ—Å—Ç—å</option>
                    <option value="personality">üòä –•–∞—Ä–∞–∫—Ç–µ—Ä</option>
                    <option value="habit">üîÑ –ü—Ä–∏–≤—ã—á–∫–∞</option>
                    <option value="speech">üí¨ –†–µ—á—å</option>
                    <option value="clothing">üëï –û–¥–µ–∂–¥–∞</option>
                </select>
                <input type="text" id="traitTheme" placeholder="–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –º–æ—Ä–µ, –º–∞–≥–∏—è, –±–æ–µ—Ü)" style="width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #8b4513; border-radius: 4px; background: #1a0f0b; color: #e0d0c0;">
                <button class="btn btn-roll" onclick="generateTrait()" style="width: 100%;">üé≤ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä—Ç—É</button>
                <div id="traitResult" style="margin-top: 15px; padding: 15px; background: #3d2418; border-radius: 6px; display: none;"></div>
            </div>

            <div class="skills-section">
                <div class="section-title">üéØ –ü—Ä–æ–∑–≤–∏—â–∞ –∏ –∫–ª–∏—á–∫–∏</div>
                <select id="nicknameType" style="width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #8b4513; border-radius: 4px; background: #1a0f0b; color: #e0d0c0;">
                    <option value="heroic">ü¶∏ –ì–µ—Ä–æ–∏—á–µ—Å–∫–æ–µ</option>
                    <option value="fearful">üò® –ü—É–≥–∞—é—â–µ–µ</option>
                    <option value="funny">üòÑ –°–º–µ—à–Ω–æ–µ</option>
                    <option value="descriptive">üìù –û–ø–∏—Å–∞—Ç–µ–ª—å–Ω–æ–µ</option>
                    <option value="animal">üê∫ –ó–≤–µ—Ä–∏–Ω–æ–µ</option>
                </select>
                <button class="btn btn-roll" onclick="generateNickname()" style="width: 100%;">üé≤ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∑–≤–∏—â–µ</button>
                <div id="nicknameResult" style="margin-top: 15px; padding: 15px; background: #3d2418; border-radius: 6px; display: none;"></div>
            </div>
        </div>

        <div id="inventory-tab" class="tab-content">
            <h2 style="color: #d4af37; text-align: center; margin-bottom: 25px;">üéí –ò–ù–í–ï–ù–¢–ê–†–¨</h2>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <button class="btn btn-plus" onclick="showAddItemPopup()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç</button>
                <button class="btn btn-roll" onclick="showAddCategoryPopup()">üìÅ –°–æ–∑–¥–∞—Ç—å —Ä–∞–∑–¥–µ–ª</button>
            </div>

            <div class="custom-categories" id="customCategoriesSection" style="display: none;">
                <h3 style="color: #d4af37; margin-bottom: 15px;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ä–∞–∑–¥–µ–ª—ã</h3>
                <div class="category-management">
                    <input type="text" id="newCategoryName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞" style="flex: 1; padding: 10px; border: 2px solid #8b4513; border-radius: 4px; background: #1a0f0b; color: #e0d0c0;">
                    <button class="btn btn-plus" onclick="addCustomCategory()">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
                <div id="customCategoriesList"></div>
            </div>
            
            <input type="text" class="search-box" id="inventorySearch" placeholder="üîç –ü–æ–∏—Å–∫ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ...">
            <div id="inventoryContainer"></div>
        </div>

        <div id="dice-tab" class="tab-content">
            <h2 style="color: #d4af37; text-align: center; margin-bottom: 25px;">üé≤ –°–ò–°–¢–ï–ú–ê –ë–†–û–°–ö–û–í</h2>
            
            <div class="dice-controls">
                <span style="color: #d4af37;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—É–±–∏–∫–æ–≤:</span>
                <input type="number" id="diceCount" class="dice-count" value="1" min="1" max="10">
            </div>

            <div class="dice-container">
                <button class="btn btn-dice" onclick="rollDice('coin')">ü™ô –ú–æ–Ω–µ—Ç–∫–∞</button>
                <button class="btn btn-dice" onclick="rollDice(4)">D4</button>
                <button class="btn btn-dice" onclick="rollDice(6)">D6</button>
                <button class="btn btn-dice" onclick="rollDice(8)">D8</button>
                <button class="btn btn-dice" onclick="rollDice(10)">D10</button>
                <button class="btn btn-dice" onclick="rollDice(12)">D12</button>
                <button class="btn btn-dice" onclick="rollDice(20)">D20</button>
                <button class="btn btn-dice" onclick="rollDice(100)">D100</button>
                <div style="display: flex; gap: 5px; align-items: center;">
                    <button class="btn btn-dice" onclick="rollCustomDice()">‚ö´ D0</button>
                    <input type="number" id="customDiceSides" class="custom-dice-input" value="6" min="2" max="1000" placeholder="–ì—Ä–∞–Ω–∏">
                </div>
            </div>

            <div id="diceResults" style="margin-top: 30px; text-align: center;"></div>
            <div id="diceHistory" style="margin-top: 20px;"></div>
        </div>

        <div id="notes-tab" class="tab-content">
            <h2 style="color: #d4af37; text-align: center; margin-bottom: 25px;">‚úçÔ∏è –°–ò–°–¢–ï–ú–ê –ó–ê–ú–ï–¢–û–ö</h2>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <button class="btn btn-plus" onclick="showAddNotePopup()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</button>
            </div>
            
            <input type="text" class="search-box" id="notesSearch" placeholder="üîç –ü–æ–∏—Å–∫ –≤ –∑–∞–º–µ—Ç–∫–∞—Ö...">
            
            <div class="notes-container" id="notesContainer"></div>
        </div>
           <div id="notes-tab" class="tab-content">
            <!-- ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –∑–∞–º–µ—Ç–æ–∫ ... -->
        </div>

        <!-- üëá –î–û–ë–ê–í–õ–Ø–ï–ú –≠–¢–£ –ù–û–í–£–Æ –í–ö–õ–ê–î–ö–£ üëá -->
        <div id="characters-tab" class="tab-content">
            <h2 style="color: #d4af37; text-align: center; margin-bottom: 25px;">üë• –ú–ï–ù–ï–î–ñ–ï–† –ü–ï–†–°–û–ù–ê–ñ–ï–ô</h2>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <button class="btn btn-plus" onclick="showCreateCharacterPopup()">‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
                <button class="btn btn-roll" onclick="showImportCharacterPopup()">üì• –ò–º–ø–æ—Ä—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
            </div>

            <div class="skills-section">
                <div class="section-title">üìÇ –í–∞—à–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏</div>
                <div id="charactersList" style="min-height: 200px;">
                    <p style="color: #8b7d6b; text-align: center;">–ü–µ—Ä—Å–æ–Ω–∞–∂–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</p>
                </div>
            </div>

            <div class="skills-section">
                <div class="section-title">‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <button class="btn btn-roll" onclick="exportAllCharacters()">üíæ –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö</button>
                    <button class="btn btn-minus" onclick="showClearAllPopup()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ—Ö</button>
                </div>
            </div>
        </div>
    </div> <!-- –ó–∞–∫—Ä—ã–≤–∞—é—â–∏–π div –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ -->

    <script>
// ========== –í–°–ï –ö–û–ù–°–¢–ê–ù–¢–´ –ò –°–¢–†–£–ö–¢–£–†–´ ==========

// –¢–∞–±–ª–∏—Ü–∞ —É—Ä–æ–≤–Ω–µ–π
const levelTable = {
    0: { expRequired: 1000, hp: 100, mana: 100, stamina: 100, points: 20 },
    1: { expRequired: 3000, hp: 200, mana: 200, stamina: 200, points: 30 },
    2: { expRequired: 5000, hp: 300, mana: 300, stamina: 300, points: 40 },
    3: { expRequired: 8000, hp: 400, mana: 400, stamina: 400, points: 50 },
    4: { expRequired: 12000, hp: 500, mana: 500, stamina: 500, points: 60 },
    5: { expRequired: 16000, hp: 600, mana: 600, stamina: 600, points: 70 },
    6: { expRequired: 20000, hp: 700, mana: 700, stamina: 700, points: 80 },
    7: { expRequired: 25000, hp: 800, mana: 800, stamina: 800, points: 90 },
    8: { expRequired: 30000, hp: 900, mana: 900, stamina: 900, points: 100 },
    9: { expRequired: 100000, hp: 1000, mana: 1000, stamina: 1000, points: 200 }
};

// –°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å
const races = {
    atski: {
        name: "üî• –ê—Ü–∫–∏ (–ü–µ—Ä—Å—ã)",
        description: "50% –∑–∞—â–∏—Ç–∞ –æ—Ç –æ–≥–Ω—è, 100% –Ω–∞ –∞—Ç–∞–∫—É –æ–≥–Ω–µ–º, –ø—É—Å—Ç—ã–Ω—è —ç—Ç–æ –∏—Ö —Å—Ç–∏—Ö–∏—è",
        lifespan: "350 –ª–µ—Ç",
        bonuses: { "–ú–∞–≥–∏—è –æ–≥–Ω—è": 2 },
        limitations: {}
    },
    knofi: {
        name: "üó£Ô∏è –ö–Ω–æ—Ñ—ã (–†–∏–º–ª—è–Ω–µ)", 
        description: "+1 –∫ –∫—Ä–∞—Å–Ω–æ—Ä–µ—á–∏—é, –∑–Ω–∞–Ω–∏–µ 3 —è–∑—ã–∫–æ–≤",
        lifespan: "400 –ª–µ—Ç",
        bonuses: { "–ö—Ä–∞—Å–Ω–æ—Ä–µ—á–∏–µ": 1 },
        limitations: {}
    },
    vorki: {
        name: "‚ùÑÔ∏è –í–æ—Ä–∫–∏ (–í–∏–∫–∏–Ω–≥–∏)",
        description: "50% –∑–∞—â–∏—Ç–∞ –æ—Ç –ª—å–¥—É, +100% –Ω–∞ –∞—Ç–∞–∫—É –ª—å–¥–æ–º",
        lifespan: "250 –ª–µ—Ç",
        bonuses: { "–ú–∞–≥–∏—è –≤–æ–¥—ã": 2 },
        limitations: {}
    },
    minci: {
        name: "üéØ –ú–∏–Ω—Ü—ã (–ê–∑–∏–∞—Ç—ã)",
        description: "+1 –∫ –¥—Ä–µ–≤–∫–æ–≤–æ–º—É, +1 –∫ –ª–æ–≤–∫–æ—Å—Ç–∏, +1 –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏",
        lifespan: "350 –ª–µ—Ç", 
        bonuses: { "–î—Ä–µ–≤–∫–æ–≤–æ–µ": 1, "–õ–æ–≤–∫–æ—Å—Ç—å": 1, "–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å": 1 },
        limitations: { "–î—Ä–µ–≤–∫–æ–≤–æ–µ": 19 }
    },
    kaei: {
        name: "‚öíÔ∏è –ö–∞—ç–π—Ü—ã (–ù–µ–≥—Ä—ã)",
        description: "–° —Ä–æ–∂–¥–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Å—Ç–∏—Ö–∏—è –º–µ—Ç–∞–ª–ª–∞",
        lifespan: "300 –ª–µ—Ç",
        bonuses: { "–ú–∞–≥–∏—è –º–µ—Ç–∞–ª–ª–∞": 2 },
        limitations: {}
    },
    forest_elf: {
        name: "üåø –õ–µ—Å–Ω—ã–µ —ç–ª—å—Ñ—ã", 
        description: "–° —Ä–æ–∂–¥–µ–Ω–∏—è –æ–±–ª–∞–¥–∞—é—Ç –º–∞–≥–∏–µ–π –ø—Ä–∏—Ä–æ–¥—ã",
        lifespan: "700 –ª–µ—Ç",
        bonuses: { "–ú–∞–≥–∏—è –ø—Ä–∏—Ä–æ–¥—ã": 2 },
        limitations: {}
    },
    high_elf: {
        name: "‚ú® –í—ã—Å—à–∏–µ —ç–ª—å—Ñ—ã",
        description: "–° —Ä–æ–∂–¥–µ–Ω–∏—è –æ–±–ª–∞–¥–∞—é—Ç –¥–≤—É–º—è —Å—Ç–∏—Ö–∏—è–º–∏",
        lifespan: "2000 –ª–µ—Ç", 
        bonuses: { },
        limitations: { "–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å": 19 }
    },
    dark_elf: {
        name: "üåë –¢–µ–º–Ω—ã–µ —ç–ª—å—Ñ—ã",
        description: "–° —Ä–æ–∂–¥–µ–Ω–∏—è –≤–ª–∞–¥–µ—é—Ç –º–∞–≥–∏–µ–π —Ç—å–º—ã", 
        lifespan: "700 –ª–µ—Ç",
        bonuses: { "–ú–∞–≥–∏—è —Ç—å–º—ã": 2 },
        limitations: {}
    },
    dwarf: {
        name: "‚õ∞Ô∏è –î–≤–∞—Ä—Ñ—ã",
        description: "–ü—Ä–∏—Ä–æ–∂–¥–µ–Ω–Ω—ã–µ –∫—É–∑–Ω–µ—Ü—ã, –≤–æ–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–∞—Å–∞",
        lifespan: "600 –ª–µ—Ç",
        bonuses: { "–ö—É–∑–Ω–µ—á–Ω–æ–µ –¥–µ–ª–æ": 1 },
        limitations: { "–ö—É–∑–Ω–µ—á–Ω–æ–µ –¥–µ–ª–æ": 19, "–õ–æ–≤–∫–æ—Å—Ç—å": 19 }
    },
    gnome: {
        name: "üîÆ –ì–Ω–æ–º—ã", 
        description: "–ò–∑–æ–±—Ä–µ—Ç–∞—Ç–µ–ª—å–Ω—ã–µ –∏ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–µ",
        lifespan: "800 –ª–µ—Ç",
        bonuses: { "–†–µ–º–µ—Å–ª–æ": 1 },
        limitations: { "–õ–æ–≤–∫–æ—Å—Ç—å": 19, "–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å": 19, "–†–µ–º–µ—Å–ª–æ": 19 }
    },
    orc: {
        name: "üíÄ –û—Ä–∫–∏",
        description: "–õ—É—á—à–∏–µ –±–æ–π—Ü—ã, –ø—Ä–µ–∑–∏—Ä–∞—é—Ç –º–∞–≥–∏—é",
        lifespan: "400 –ª–µ—Ç", 
        bonuses: { "–¢—è–∂—ë–ª–∞—è –±—Ä–æ–Ω—è": 1, "–î–≤—É—Ä—É—á–Ω–æ–µ –æ—Ä—É–∂–∏–µ": 1 },
        limitations: { "–¢—è–∂—ë–ª–∞—è –±—Ä–æ–Ω—è": 20, "–î–≤—É—Ä—É—á–Ω–æ–µ –æ—Ä—É–∂–∏–µ": 20 }
    },
    goblin: {
        name: "üëπ –ì–æ–±–ª–∏–Ω—ã",
        description: "–•–∏—Ç—Ä—ã–µ –∏ –±—ã—Å—Ç—Ä–æ —É—á–∞—Ç—Å—è, –Ω–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–≥–∏—é",
        lifespan: "25 –ª–µ—Ç", 
        bonuses: {},
        limitations: { 
            "–ú–∞–≥–∏—è –≤–æ–¥—ã": 0, "–ú–∞–≥–∏—è –∑–µ–º–ª–∏": 0, "–ú–∞–≥–∏—è –≤–æ–∑–¥—É—Ö–∞": 0, "–ú–∞–≥–∏—è –æ–≥–Ω—è": 0, 
            "–ú–∞–≥–∏—è –∫—Ä–æ–≤–∏": 0, "–ú–∞–≥–∏—è –º–µ—Ç–∞–ª–ª–∞": 0, "–ú–∞–≥–∏—è –ø—Ä–∏—Ä–æ–¥—ã": 0, "–ú–∞–≥–∏—è —Å–≤–µ—Ç–∞": 0, 
            "–ú–∞–≥–∏—è —Ç—å–º—ã": 0, "–ú–∞–≥–∏—è –∏–Ω—Ñ–µ—Ä–Ω–æ": 0, "–ú–∞–≥–∏—è —Ö–∞–æ—Å–∞": 0, "–ú–∞–≥–∏—è —Ä–∞–∑—É–º–∞": 0, 
            "–ú–∞–≥–∏—è –ñ–∏–∑–Ω–∏": 0, "–ú–∞–≥–∏—è —Å–º–µ—Ä—Ç–∏": 0, "–ú–∞–≥–∏—è –ø—É—Å—Ç–æ—Ç—ã": 0, "–ú–∞–≥–∏—è –≠–Ω–µ—Ä–≥–∏–∏": 0, 
            "–ê–ª—Ö–∏–º–∏—è": 0, "–ó–∞—á–∞—Ä–æ–≤–∞–Ω–∏–µ": 0 
        }
    }
};

// –î–∏–∞–ø–∞–∑–æ–Ω—ã —Ä–æ—Å—Ç–∞ –¥–ª—è —Ä–∞—Å
const raceHeightRanges = {
    atski: { min: 140, max: 210 },
    knofi: { min: 135, max: 205 },
    vorki: { min: 150, max: 220 },
    minci: { min: 130, max: 200 },
    kaei: { min: 140, max: 225 },
    forest_elf: { min: 150, max: 210 },
    high_elf: { min: 170, max: 270 },
    dark_elf: { min: 160, max: 230 },
    dwarf: { min: 110, max: 160 },
    gnome: { min: 40, max: 80 },
    orc: { min: 200, max: 350 },
    goblin: { min: 90, max: 150 }
};

// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞–≤—ã–∫–æ–≤
const skillsStructure = {
    "‚öîÔ∏è –ë–û–ï–í–´–ï –ù–ê–í–´–ö–ò": [
        "–¢—è–∂—ë–ª–∞—è –±—Ä–æ–Ω—è", "–õ—ë–≥–∫–∞—è –±—Ä–æ–Ω—è", "–î–≤—É—Ä—É—á–Ω–æ–µ –æ—Ä—É–∂–∏–µ", 
        "–û–¥–Ω–æ—Ä—É—á–Ω–æ–µ –æ—Ä—É–∂–∏–µ", "–°—Ç—Ä–µ–ª—å–±–∞", "–ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ", 
        "–î—Ä–µ–≤–∫–æ–≤–æ–µ", "–†—É–∫–æ–ø–∞—à–Ω—ã–π –±–æ–π", "–ú–µ—Ç–∞–Ω–∏–µ"
    ],
    "üé≠ –û–ë–©–ò–ï –ù–ê–í–´–ö–ò": [
        "–°–∫—Ä—ã—Ç–Ω–æ—Å—Ç—å", "–ö—Ä–∞—Å–Ω–æ—Ä–µ—á–∏—é", "–õ–æ–≤–∫–æ—Å—Ç—å", "–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å",
        "–í–∑–ª–æ–º", "–í–æ—Å–ø—Ä–∏—è—Ç–∏–µ", "–£–¥–∞—á–∞", "–ö–∞—Ä–º–∞–Ω–Ω—ã–µ –∫—Ä–∞–∂–∏"
    ],
    "‚öóÔ∏è –†–ï–ú–ï–°–õ–ê": [
        "–ê–ª—Ö–∏–º–∏—è", "–ö—É–∑–Ω–µ—á–Ω–æ–µ –¥–µ–ª–æ", "–ó–∞—á–∞—Ä–æ–≤–∞–Ω–∏–µ", "–†–µ–º–µ—Å–ª–æ"
    ],
    "üîÆ –ú–ê–ì–ò–Ø": [
        "–ú–∞–≥–∏—è –≤–æ–¥—ã", "–ú–∞–≥–∏—è –∑–µ–º–ª–∏", "–ú–∞–≥–∏—è –≤–æ–∑–¥—É—Ö–∞", "–ú–∞–≥–∏—è –∫—Ä–æ–≤–∏",
        "–ú–∞–≥–∏—è –æ–≥–Ω—è", "–ú–∞–≥–∏—è –º–µ—Ç–∞–ª–ª–∞", "–ú–∞–≥–∏—è –ø—Ä–∏—Ä–æ–¥—ã", "–ú–∞–≥–∏—è —Å–≤–µ—Ç–∞",
        "–ú–∞–≥–∏—è —Ç—å–º—ã", "–ú–∞–≥–∏—è –∏–Ω—Ñ–µ—Ä–Ω–æ", "–ú–∞–≥–∏—è —Ö–∞–æ—Å–∞", "–ú–∞–≥–∏—è —Ä–∞–∑—É–º–∞",
        "–ú–∞–≥–∏—è –ñ–∏–∑–Ω–∏", "–ú–∞–≥–∏—è —Å–º–µ—Ä—Ç–∏", "–ú–∞–≥–∏—è –ø—É—Å—Ç–æ—Ç—ã", "–ú–∞–≥–∏—è –≠–Ω–µ—Ä–≥–∏–∏"
    ]
};

// –ó–∞–∫–ª–∏–Ω–∞–Ω–∏—è –º–∞–≥–∏–∏ –≤–æ–¥—ã
const allWaterSpells = [
    {
        name: "–†–æ—Å–∞",
        order: 10,
        effect: "–ó–∞–∫–ª–∏–Ω–∞–Ω–∏–µ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç —Ç–µ–ª–æ –∏ –æ–¥–µ–∂–¥—É –º–∞–≥–∞ —Ç–æ–Ω–∫–æ–π –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π –≤–æ–¥—è–Ω–æ–π –ø–ª—ë–Ω–∫–æ–π, –ø–æ–º–æ–≥–∞—é—â–µ–π –∏–∑–±–µ–∂–∞—Ç—å –∏—Å—Å—É—à–µ–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∑–º–∞ –≤ –ø—É—Å—Ç—ã–Ω–µ –∏–ª–∏ –æ–∫–µ–∞–Ω–µ. –ò–ª–∏ –∂–µ —Å–æ–∑–¥–∞–µ—Ç –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –Ω–∞ –∫–∞–∫–æ–π-–ª–∏–±–æ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ - –≤–ª–∞–≥—É –∏–∑ –Ω–∏—á–µ–≥–æ.",
        type: "–ó–∞–∫–ª—è—Ç–∏–µ, –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ–º–æ–µ –Ω–∞ –æ–±–ª–∞—Å—Ç—å, —Ç–æ—á–µ—á–Ω–æ–µ",
        conditions: "2 —Å–µ–∫—É–Ω–¥—ã –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏, 1 –≤–æ–ª—à–µ–±–Ω—ã–π –∂–µ—Å—Ç",
        duration: "–ú–æ–∂–µ—Ç –¥–µ—Ä–∂–∞—Ç—å—Å—è –æ–∫–æ–ª–æ –æ–¥–Ω–æ–≥–æ-–¥–≤—É—Ö —á–∞—Å–æ–≤, —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ä–∞—Å—Å–µ–∏–≤–∞–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω–æ –ø–æ—Å–ª–µ–¥—É—é—â–µ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ",
        cost: "30 –º–∞–Ω–Ω—ã",
        learned: false
    },
    {
        name: "–†–∂–∞–≤—á–∏–Ω–∞",
        order: 10,
        effect: "–ú–∞–≥–∏—á–µ—Å–∫–∏ —É—Å–∫–æ—Ä—è–µ—Ç –∫–æ—Ä—Ä–æ–∑–∏—é –º–µ—Ç–∞–ª–ª–∞. –ó–∞–∫–ª–∏–Ω–∞–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Å–ª–∞–±–ª—è—Ç—å –∏–ª–∏ —Ä–∞–∑—Ä—É—à–∞—Ç—å –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã, –≤ —Ç–æ–º —á–∏—Å–ª–µ –∏ –æ—Ä—É–∂–∏–µ.",
        type: "–ó–∞–∫–ª—è—Ç–∏–µ, –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ–º–æ–µ –Ω–∞ –æ–±–ª–∞—Å—Ç—å, —Ç–æ—á–µ—á–Ω–æ–µ",
        conditions: "1 —Å–µ–∫—É–Ω–¥–∞ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏, –ø—Ä–∏ –ø—Ä—è–º–æ–º –∫–æ–Ω—Ç–∞–∫—Ç–µ —Å –º–µ—Ç–∞–ª–ª–æ–º ‚Äì 1 –≤–æ–ª—à–µ–±–Ω—ã–π –∂–µ—Å—Ç. –ü—Ä–∏ –æ–¥–Ω–æ–º –ª–∏—à—å –∑—Ä–∏—Ç–µ–ª—å–Ω–æ–º –∫–æ–Ω—Ç–∞–∫—Ç–µ ‚Äì 2 —Å–µ–∫—É–Ω–¥—ã –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏, 3 –≤–æ–ª—à–µ–±–Ω—ã—Ö –∂–µ—Å—Ç–∞",
        duration: "–ú–µ—Ç–∞–ª–ª –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–∞–∫—Å–∏–º—É–º —Ä–∞–∑ –≤ 2 –º–∏–Ω—É—Ç—ã",
        cost: "30 –º–∞–Ω–Ω—ã",
        learned: false
    },
    {
        name: "–û—Ç–≤–µ—Ä–¥–µ–≤–∞–Ω–∏–µ",
        order: 10,
        effect: "–ü–æ–∑–≤–æ–ª—è–µ—Ç —É–ø–ª–æ—Ç–Ω–∏—Ç—å –≤–æ–¥—É, –≤—Ä–µ–º–µ–Ω–Ω–æ –¥–µ–ª–∞—è –µ—ë —Ç–≤—ë—Ä–¥—ã–º –æ–±—ä–µ–∫—Ç–æ–º. –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ª–∞–±—ã–µ —â–∏—Ç—ã –∏–∑ –≤–æ–¥—ã –ø–µ—Ä–µ–¥ —Å–æ–±–æ–π, —Å–ø–æ—Å–æ–±–Ω—ã–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç—Ä–∞–∑–∏—Ç—å –±—Ä–æ—à–µ–Ω–Ω—ã–π –≤ –º–∞–≥–∞ –∫–∞–º–µ–Ω—å. –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç–æ—è—â–∞—è (–ø—Ä–∏—Ä–æ–¥–Ω–∞—è –≤–æ–¥–∞), –Ω–∞ —Å–æ–∑–¥–∞–Ω–Ω—É—é –º–∞–≥–∏–µ–π –≤–æ–¥—É –Ω–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç.",
        type: "–ù–∞–∫–ª–∞–¥—ã–≤–∞–µ–º–æ–µ –Ω–∞ –æ–±–ª–∞—Å—Ç—å 10 –º–µ—Ç—Ä–æ–≤",
        conditions: "–ù–∞—Å—Ç–æ—è—â–∞—è –≤–æ–¥–∞, 2 —Å–µ–∫—É–Ω–¥—ã –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è, 1 –º–∞–≥–∏—á–µ—Å–∫–∏–π –∂–µ—Å—Ç",
        duration: "–î–µ–π—Å—Ç–≤—É–µ—Ç, –ø–æ–∫–∞ –º–∞–≥ –Ω–µ –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç —Å–æ—Å—Ä–µ–¥–æ—Ç–∞—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–∏ –∏–ª–∏ —Å–∞–º –Ω–µ –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç –µ–≥–æ, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚Äì —á–∞—Å, –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ —Å–æ—Ç–≤–æ—Ä–∏—Ç—å –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ —Å–Ω–æ–≤–∞ —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É",
        cost: "30 –º–∞–Ω–Ω—ã",
        learned: false
    },
    {
        name: "–ü–æ—Ç–æ–∫ –≤–æ–¥—ã",
        order: 9,
        effect: "–ò–∑ —Ä—É–∫ –º–∞–≥–∞ –≤—ã—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ—Ç–æ–∫ –≤–æ–¥—ã, —Å–ø–æ—Å–æ–±–Ω—ã–π –ø–æ—Ç—É—à–∏—Ç—å –ø–æ–∂–∞—Ä –∏–ª–∏ –æ–≥–Ω–µ–Ω–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–ª–∏ —Å–±–∏—Ç—å –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ —Å –Ω–æ–≥. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–∏—Å—Ç–∞–Ω—Ü–∏—è, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ –µ—â—ë –Ω–∞–Ω–æ—Å–∏—Ç –∫–∞–∫–∏–µ-—Ç–æ —ç—Ñ—Ñ–µ–∫—Ç—ã , 3-30 –º–µ—Ç—Ä–æ–≤. —Ç–æ–ª—â–∏–Ω–∞ 10 —Å–º - 1 –º–µ—Ç—Ä",
        type: "–ó–∞–∫–ª—è—Ç–∏–µ-–≤—ã—Å—Ç—Ä–µ–ª",
        conditions: "1 —Å–µ–∫—É–Ω–¥–∞ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏",
        duration: "2-11 —Å–µ–∫—É–Ω–¥, –º–æ–∂–µ—Ç –≤–Ω–æ–≤—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥",
        cost: "50 –º–∞–Ω–Ω—ã",
        learned: false
    },
    {
        name: "–û–±–ª–∞–∫–æ —Ç—É–º–∞–Ω–∞",
        order: 9,
        effect: "–í—ã–∑—ã–≤–∞–µ—Ç —Ç—É–º–∞–Ω, —Å–∏–ª—å–Ω–æ —É–º–µ–Ω—å—à–∞—é—â–∏–π —Ä–∞–¥–∏—É—Å –æ–±–∑–æ—Ä–∞. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–¥–∏—É—Å –æ–±–ª–∞–∫–∞ –º–µ—Ç—Ä–æ–≤ = 20-200 –º–µ—Ç—Ä–æ–≤ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è - 5",
        type: "–ó–∞–∫–ª—è—Ç–∏–µ, –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ–º–æ–µ –Ω–∞ –æ–±–ª–∞—Å—Ç—å –≤–æ–∫—Ä—É–≥ –º–∞–≥–∞",
        conditions: "4 —Å–µ–∫—É–Ω–¥—ã –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏, 4 –º–∞–≥–∏—á–µ—Å–∫–∏—Ö –∂–µ—Å—Ç–∞. –ù–∞–ª–∏—á–∏–µ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–æ–¥—ã —É–º–µ–Ω—å—à–∞–µ—Ç —Ç—Ä–µ–±—É–µ–º–æ–µ –≤—Ä–µ–º—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ —Å–µ–∫—É–Ω–¥—É, —É–º–µ–Ω—å—à–∞–µ—Ç –∑–∞—Ç—Ä–∞—Ç—ã —ç–Ω–µ—Ä–≥–∏–∏ –≤ 2 —Ä–∞–∑–∞",
        duration: "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 10-360 —Å–µ–∫—É–Ω–¥. –ü–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞ 40 –º–∏–Ω—É—Ç",
        cost: "70-270 –º–∞–Ω–Ω—ã",
        learned: false
    },
    {
        name: "–ì–µ–π–∑–µ—Ä",
        order: 9,
        effect: "–í—ã–∑—ã–≤–∞–µ—Ç –∏–∑-–ø–æ–¥ –∑–µ–º–ª–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ –±—å—é—â–∏–π –ø–æ—Ç–æ–∫ –≤–æ–¥—ã, —Å–ø–æ—Å–æ–±–Ω—ã–π –≤—ã–±–∏—Ç—å –æ—Ä—É–∂–∏–µ –∏–∑ —Ä—É–∫ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ –∏–ª–∏ –¥–∞–∂–µ –ø–æ–¥–±—Ä–æ—Å–∏—Ç—å –≤ –≤–æ–∑–¥—É—Ö –µ–≥–æ —Å–∞–º–æ–≥–æ. –í—ã—Å–æ—Ç–∞ –ø–æ—Ç–æ–∫–∞ –¥–æ 3-10 –º–µ—Ç—Ä–æ–≤. –¢–æ–ª—â–∏–Ω–∞ –≥–µ–π–∑–µ—Ä–∞: —Å–∞–Ω—Ç–∏–º–µ—Ç—Ä–æ–≤ = 30 —Å–∞–Ω—Ç–∏–º–µ—Ç—Ä–æ–≤ ‚Äì 3 –º–µ—Ç—Ä–∞",
        type: "—Ç–æ—á–µ—á–Ω–æ–µ",
        conditions: "2 —Å–µ–∫—É–Ω–¥—ã –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏, 2 —Å–ª–æ–≤–∞ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –≥—Ä—É–Ω—Ç–æ–≤—ã—Ö –≤–æ–¥, 1 —Å–µ–∫—É–Ω–¥–∞ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–∏ –∏—Ö –Ω–∞–ª–∏—á–∏–∏",
        duration: "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ—Ç–æ–∫–∞: 5 —Å–µ–∫—É–Ω–¥ -55 —Å–µ–∫—É–Ω–¥. –ü–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞ 1 –º–∏–Ω—É—Ç–∞",
        cost: "30 - 200 –º–∞–Ω–Ω—ã",
        learned: false
    },
    {
        name: "–õ–µ–¥—è–Ω–∞—è —Å—Ç—Ä–µ–ª–∞",
        order: 8,
        effect: "–ò—Å–ø–æ–ª—å–∑—É—é—â–∏–π –≤—ã–ø—É—Å–∫–∞–µ—Ç –ª–µ–¥—è–Ω—É—é —Å—Ç—Ä–µ–ª—É-—Å–æ—Å—É–ª—å–∫—É, –≤ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞. –ü—Ä–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–º —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω–∏–∏ –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Å—É–ª–µ–∫ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –æ–±–ª–∞—Å—Ç–∏ –ø–æ—Ä–∞–∂–µ–Ω–∏—è. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–µ–ª: 2-10 —Å—Ç—Ä–µ–ª. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –±–æ–ª–µ–µ 70 –º–µ—Ç—Ä–æ–≤",
        type: "–ó–∞–∫–ª—è—Ç–∏–µ-–≤—ã—Å—Ç—Ä–µ–ª",
        conditions: "–î–ª—è –æ–¥–Ω–æ–π —Å—Ç—Ä–µ–ª—ã 2 —Å–µ–∫—É–Ω–¥—ã –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏, 1 –≤–æ–ª—à–µ–±–Ω–æ–µ —Å–ª–æ–≤–æ, –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö —Å—Ç—Ä–µ–ª - 3 —Å–µ–∫—É–Ω–¥—ã –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏, 3 –≤–æ–ª—à–µ–±–Ω—ã—Ö —Å–ª–æ–≤–∞, 1 –≤–æ–ª—à–µ–±–Ω—ã–π –∂–µ—Å—Ç",
        duration: "–ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ —Ç—Ä–∏–¥—Ü–∞—Ç—å —Å–µ–∫—É–Ω–¥ –¥–ª—è –æ–¥–∏–Ω–æ—á–Ω–æ–π —Å—Ç—Ä–µ–ª—ã, —á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö —Å—Ç—Ä–µ–ª",
        cost: "–û–¥–Ω–∞ —Å—Ç—Ä–µ–ª–∞ - 40, –∑–∞ –∫–∞–∂–¥—É—é —Å–ª–µ–¥—É—é—â—É—é 20 –º–∞–Ω–Ω—ã",
        learned: false
    },
    {
        name: "–ö–ª–∏–Ω–æ–∫ –º–æ—Ä–æ–∑–∞",
        order: 8,
        effect: "–ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–∫–æ–ª–¥–æ–≤–∞—Ç—å –æ—Ä—É–∂–∏–µ –∏–ª–∏ —Å–Ω–∞—Ä—è–¥. –û—Ä—É–∂–∏–µ —Å —Å–∏–ª–æ–π –º–æ—Ä–æ–∑–∞ –Ω–µ —Ç–æ–ª—å–∫–æ —Ä–∞–Ω–∏—Ç –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞, –Ω–æ –∏ –æ—Ö–ª–∞–∂–¥–∞–µ—Ç –µ–≥–æ –∫—Ä–æ–≤—å, —Ç–µ–º —Å–∞–º—ã–º –∑–∞–º–µ–¥–ª—è—è –∏ –ø—Ä–∏—á–∏–Ω—è—è –Ω–µ—É–¥–æ–±—Å—Ç–≤–∞. –ú–∏–Ω—É—Å 1 –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏ —Å –æ–¥–Ω–æ–≥–æ —Ä–∞–Ω–µ–Ω–∏—è",
        type: "—Ç–æ—á–µ—á–Ω–æ–µ",
        conditions: "–ü—Ä—è–º–æ–π –∫–æ–Ω—Ç–∞–∫—Ç —Å –æ—Ä—É–∂–∏–µ–º, 3 —Å–µ–∫—É–Ω–¥—ã –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏, 2 –≤–æ–ª—à–µ–±–Ω—ã—Ö —Å–ª–æ–≤–∞",
        duration: "–û—Ä—É–∂–∏–µ –º–æ–∂–µ—Ç –æ–±–ª–∞–¥–∞—Ç—å —Å–∏–ª–æ–π –º–æ—Ä–æ–∑–∞ —Å–µ–∫—É–Ω–¥ = 5-25 —Å–µ–∫—É–Ω–¥. –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ –¥–≤–∞–¥—Ü–∞—Ç—å —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è",
        cost: "50-250 –º–∞–Ω–Ω—ã",
        learned: false
    },
    {
        name: "–°–Ω–µ–∂–Ω—ã–π –≤–∏—Ö—Ä—å",
        order: 8,
        effect: "–ú–∞–≥ –ø—Ä–∏–∑—ã–≤–∞–µ—Ç —Å–Ω–µ–∂–Ω—ã–π –≤–∏—Ö—Ä—å, –æ–∫—Ä—É–∂–∞—é—â–∏–π 1 —Ü–µ–ª—å –∏ —Å–Ω–∏–∂–∞—é—â–∏–π –µ–≥–æ –±–æ–µ–≤—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å. –û—Å—Ç—Ä—ã–µ —Å–Ω–µ–∂–∏–Ω–∫–∏ –∑–∞–±–∏–≤–∞—é—Ç—Å—è –≤ —â–µ–ª–∏ –≤ –¥–æ—Å–ø–µ—Ö–∞—Ö, –ø–æ–ø–∞–¥–∞—é—Ç –≤ –≥–ª–∞–∑–∞ –∏ –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –º–∞—Å—Å—É –Ω–µ—É–¥–æ–±—Å—Ç–≤. –ú–∏–Ω—É—Å - 1 –∫ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—é, –º–∏–Ω—É - 1 –∫ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –Ω–∞–≤—ã–∫–∞–º",
        type: "–¥–µ–±–∞—Ñ—Ñ",
        conditions: "4 —Å–µ–∫—É–Ω–¥—ã –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏, 3 –≤–æ–ª—à–µ–±–Ω—ã—Ö –∂–µ—Å—Ç–∞",
        duration: "–°–Ω–µ–∂–Ω—ã–π –≤–∏—Ö—Ä—å –º–µ—à–∞–µ—Ç –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫—É —Å–µ–∫—É–Ω–¥ = 15-45 —Å–µ–∫—É–Ω–¥. –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ –ø—è—Ç—å –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è",
        cost: "120 –º–∞–Ω–Ω—ã - 320 –º–∞–Ω–Ω—ã",
        learned: false
    },
    {
        name: "–í–ª–∞–∂–Ω—ã–π –±–∞—Ä—å–µ—Ä",
        order: 7,
        effect: "–°–æ–∑–¥–∞—ë—Ç –≤–æ–∫—Ä—É–≥ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –º–µ—Å—Ç–∞ —Ä–∞–¥–∏—É—Å–æ–º 2 –º–µ—Ç—Ä–∞ –±–∞—Ä—å–µ—Ä –∏–∑ –º–µ–ª—å—á–∞–π—à–∏—Ö —á–∞—Å—Ç–∏—á–µ–∫ –≤–æ–¥—ã. –û–Ω–∏ –ø–æ–≥–ª–æ—â–∞—é—Ç –≤—Ä–∞–∂–¥–µ–±–Ω—É—é –º–∞–≥–∏—é –¥–æ 7 –ø–æ—Ä—è–¥–∫–∞ –Ω–µ –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –∏ –º–µ–¥–ª–µ–Ω–Ω–æ –∏—Å—Ü–µ–ª—è—é—Ç —Ç–µ—Ö, –∫—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –Ω–µ–≥–æ. –ò–∑–Ω—É—Ç—Ä–∏ –∏ —Å–Ω–∞—Ä—É–∂–∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ª—é–±—ã–µ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è, –∫—Ä–æ–º–µ –æ–≥–Ω–µ–Ω–Ω—ã—Ö, –≤–æ—Å—Ç–æ–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 10 —Ö–ø –≤ –º–∏–Ω—É—Ç—É",
        type: "–ú–∞–≥–∏—á–µ—Å–∫–∏–π —â–∏—Ç",
        conditions: "5 —Å–µ–∫—É–Ω–¥ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏, 3 –≤–æ–ª—à–µ–±–Ω—ã—Ö —Å–ª–æ–≤–∞",
        duration: "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å 1 –º–∏–Ω—É—Ç–∞-20 –º–∏–Ω—É—Ç, –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞ - 10 –º–∏–Ω—É—Ç",
        cost: "100-300 –º–∞–Ω–Ω—ã",
        learned: false
    }
];

const spellsBySchool = {
    "–ú–∞–≥–∏—è –≤–æ–¥—ã": allWaterSpells
};

// –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã –∏–º–µ–Ω –¥–ª—è —Ä–∞—Å
const nameGenerators = {
    atski: {
        male: ["–ê—Ä–∞—à", "–î–∞—Ä–∏–π", "–ö–∏—Ä–∏–ª–ª", "–†–∞–º–∏–Ω", "–§–∞—Ä–∏–¥", "–ó–∞—Ö–∏—Ä", "–ö–∞–≤–µ", "–î–∂–∞–≤–∏–¥", "–ù–∞–¥–∏–º", "–¢–∏–º—É—Ä"],
        female: ["–õ–µ–π–ª–∞", "–ü–∞—Ä–≤–∏–Ω", "–®–∏—Ä–∏–Ω", "–Ø—Å–º–∏–Ω", "–ó–∞—Ö—Ä–∞", "–ù–∞—Ä–≥–∏–∑", "–§–∏—Ä–¥–∞—É—Å", "–ì—é–ª—å–Ω–∞–∑", "–ê–∏–¥–∞", "–°–∏–º–∞"],
        surnames: ["–∞–ª—å-–•–∞–∫–∏–º", "–∏–±–Ω-–ö–∞—Ä–∏–º", "–∞–ª—å-–§–∞—Ä–∏–¥", "–∏–±–Ω-–†–∞—à–∏–¥", "–∞–ª—å-–î–∂–∞—Ñ–∞—Ä"]
    },
    knofi: {
        male: ["–ú–∞—Ä–∫", "–ì–∞–π", "–õ—É—Ü–∏–π", "–¢–∏—Ç", "–°–µ–∫—Å—Ç", "–î–µ—Ü–∏–º", "–ö–≤–∏–Ω—Ç", "–ü—É–±–ª–∏–π", "–ì–Ω–µ–π", "–°–µ—Ä–≤–∏–π"],
        female: ["–Æ–ª–∏—è", "–ö–æ—Ä–Ω–µ–ª–∏—è", "–í–∞–ª–µ—Ä–∏—è", "–ö–ª–∞–≤–¥–∏—è", "–≠–º–∏–ª–∏—è", "–§–∞–±–∏—è", "–ü–æ–º–ø–µ—è", "–°–µ–º–ø—Ä–æ–Ω–∏—è", "–õ–∏–≤–∏—è", "–û–∫—Ç–∞–≤–∏—è"],
        surnames: ["–ê–≤–∏–¥–∏–π", "–í–∞–ª–µ—Ä–∏–π", "–ö–ª–∞–≤–¥–∏–π", "–§–ª–∞–≤–∏–π", "–Æ–ª–∏–π", "–ê–≤—Ä–µ–ª–∏–π", "–≠–º–∏–ª–∏–π", "–ö–æ—Ä–Ω–µ–ª–∏–π"]
    },
    vorki: {
        male: ["–†–∞–≥–Ω–∞—Ä", "–ë—å–æ—Ä–Ω", "–≠—Ä–∏–∫", "–•–∞—Ä–∞–ª—å–¥", "–£–ª—å—Ñ", "–°–≤–µ–Ω", "–ò–≤–∞—Ä", "–•–∞–ª—å–≤–¥–∞–Ω", "–ì—É–Ω–Ω–∞—Ä", "–°–∏–≥—É—Ä–¥"],
        female: ["–ê—Å—Ç—Ä–∏–¥", "–§—Ä–µ–π—è", "–°–∏–≥—Ä–∏–¥", "–ò–Ω–≥–µ–±–æ—Ä–≥", "–•–µ–ª—å–≥–∞", "–ì—É–¥—Ä—É–Ω", "–°–≤–∞–Ω—Ö–∏–ª—å–¥", "–ë—Ä–∏—Ç—Ç–∞", "–£–ª—å–≤–∏", "–†–∞–≥–Ω—Ö–∏–ª—å–¥"],
        surnames: ["—Å—ã–Ω –¢–æ—Ä–∞", "–ö—Ä–æ–≤–∞–≤—ã–π –¢–æ–ø–æ—Ä", "–ú–æ—Ä—Å–∫–æ–π –í–æ–ª–∫", "–ñ–µ–ª–µ–∑–Ω–∞—è –†—É–∫–∞", "–ë–µ—Ä—Å–µ—Ä–∫", "–í–æ–ª–∫ –°–µ–≤–µ—Ä–∞"]
    }
};

// –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã –Ω–∞–∑–≤–∞–Ω–∏–π
const nameTemplates = {
    tavern: {
        prefixes: ["–°—Ç–∞—Ä—ã–π", "–í–µ—Å–µ–ª—ã–π", "–ì–æ—Ä–¥—ã–π", "–°–ø—è—â–∏–π", "–¢–∞–Ω—Ü—É—é—â–∏–π", "–ü–æ—é—â–∏–π", "–ó–æ–ª–æ—Ç–æ–π", "–°–µ—Ä–µ–±—Ä—è–Ω—ã–π"],
        bases: ["–ì–Ω–æ–º", "–≠–ª—å—Ñ", "–ì–æ–±–ª–∏–Ω", "–î–≤–∞—Ä—Ñ", "–í–æ–ª–∫", "–ú–µ–¥–≤–µ–¥—å", "–û—Ä–µ–ª", "–î—Ä–∞–∫–æ–Ω"],
        suffixes: ["", " –∏ –†–æ–∑–∞", " –∏ –ú–µ—á", " –∏ –©–∏—Ç", " –∏ –ö—É–±–æ–∫"]
    },
    city: {
        prefixes: ["–°–µ–≤–µ—Ä–Ω—ã–π", "–Æ–∂–Ω—ã–π", "–í–æ—Å—Ç–æ—á–Ω—ã–π", "–ó–∞–ø–∞–¥–Ω—ã–π", "–ù–æ–≤—ã–π", "–°—Ç–∞—Ä—ã–π", "–í–µ–ª–∏–∫–∏–π", "–ë–µ–ª—ã–π"],
        bases: ["–≥—Ä–∞–¥", "–±—É—Ä–≥", "—Ö–æ–ª—å–º", "—Å–∏—Ç–∏", "–ø–æ—Ä—Ç", "–¥–∞—Ä", "—Å—Ç–∞–Ω", "–≤–∏–ª—å"],
        suffixes: ["", "-–Ω–∞-–í–æ–ª–≥–µ", "-—É-–ú–æ—Ä—è", "-–≤-–ì–æ—Ä–∞—Ö", "-–≤-–î–æ–ª–∏–Ω–µ"]
    }
};

// –û—Ç–ª–∏—á–∏—Ç–µ–ª—å–Ω—ã–µ —á–µ—Ä—Ç—ã
const traits = {
    appearance: {
        themes: {
            sea: ["—Å–æ–ª–µ–≤–∞—è –∫–æ—Ä–∫–∞ –Ω–∞ –∫–æ–∂–µ", "—Ç–∞—Ç—É–∏—Ä–æ–≤–∫–∞ –≤ –≤–∏–¥–µ —è–∫–æ—Ä—è", "–ø–µ—Ä–µ–ø–æ–Ω–∫–∏ –º–µ–∂–¥—É –ø–∞–ª—å—Ü–∞–º–∏"],
            magic: ["—Å–≤–µ—Ç—è—â–∏–µ—Å—è –≥–ª–∞–∑–∞", "–≤–æ–ª–æ—Å—ã –º–µ–Ω—è—é—Ç —Ü–≤–µ—Ç", "–∫–æ–∂–∞ –º–µ—Ä—Ü–∞–µ—Ç"],
            fighter: ["—à—Ä–∞–º —á–µ—Ä–µ–∑ –≥–ª–∞–∑", "—Å–ª–æ–º–∞–Ω–Ω—ã–π –Ω–æ—Å", "–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π –∑—É–±"]
        },
        general: ["–Ω–µ–æ–±—ã—á–Ω—ã–π —Ü–≤–µ—Ç –≥–ª–∞–∑", "—à—Ä–∞–º –Ω–∞ —â–µ–∫–µ", "—è—Ä–∫–∏–µ –≤–æ–ª–æ—Å—ã", "–ø–∏—Ä—Å–∏–Ω–≥", "—Ä–æ–¥–∏–º–æ–µ –ø—è—Ç–Ω–æ"]
    },
    personality: {
        themes: {
            sea: ["–≥–æ–≤–æ—Ä–∏—Ç –º–æ—Ä—Å–∫–∏–º–∏ —Ç–µ—Ä–º–∏–Ω–∞–º–∏", "–ª—é–±–∏—Ç —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å –æ –ø–ª–∞–≤–∞–Ω–∏—è—Ö", "–±–æ–∏—Ç—Å—è –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –±–µ–∑ –≤–æ–¥—ã"],
            magic: ["—Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞–µ—Ç —Å –Ω–µ–≤–∏–¥–∏–º—ã–º–∏ —Å—É—â–µ—Å—Ç–≤–∞–º–∏", "–≤—Å–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –º–∞–≥–∏–µ–π", "–±–æ–∏—Ç—Å—è –∞–Ω—Ç–∏–º–∞–≥–∏–∏"]
        },
        general: ["–≤–µ—á–Ω–æ –æ–ø–∞–∑–¥—ã–≤–∞–µ—Ç", "—Å–ª–∏—à–∫–æ–º –ø—É–Ω–∫—Ç—É–∞–ª–µ–Ω", "–ø–æ—Å—Ç–æ—è–Ω–Ω–æ —à—É—Ç–∏—Ç", "–≤—Å–µ–≥–¥–∞ —Å–µ—Ä—å–µ–∑–µ–Ω"]
    }
};

// –ü—Ä–æ–∑–≤–∏—â–∞
const nicknames = {
    heroic: ["–°–æ–∫—Ä—É—à–∏—Ç–µ–ª—å", "–ó–∞—â–∏—Ç–Ω–∏–∫", "–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–π", "–ù–µ–ø–æ–±–µ–¥–∏–º—ã–π", "–ë–µ—Å—Å–º–µ—Ä—Ç–Ω—ã–π"],
    fearful: ["–£–∂–∞—Å–Ω—ã–π", "–ö—Ä–æ–≤–∞–≤—ã–π", "–ñ–µ—Å—Ç–æ–∫–∏–π", "–ë–µ–∑–∂–∞–ª–æ—Å—Ç–Ω—ã–π", "–¢–µ–º–Ω—ã–π"],
    funny: ["–í–µ—Å–µ–ª—å—á–∞–∫", "–•–∏—Ç—Ä–µ—Ü", "–ü–ª—É—Ç", "–ë–∞–ª–∞–º—É—Ç", "–ü—É—Å—Ç–æ–º–µ–ª—è"],
    descriptive: ["–í—ã—Å–æ–∫–∏–π", "–ë—ã—Å—Ç—Ä—ã–π", "–°–∏–ª—å–Ω—ã–π", "–ú—É–¥—Ä—ã–π", "–õ–æ–≤–∫–∏–π"],
    animal: ["–í–æ–ª–∫", "–ú–µ–¥–≤–µ–¥—å", "–û—Ä–µ–ª", "–ó–º–µ–π", "–¢–∏–≥—Ä"]
};

// ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
let availableMagicSchools = {};
const baseMagicSchools = ["–ú–∞–≥–∏—è –≤–æ–¥—ã", "–ú–∞–≥–∏—è –∑–µ–º–ª–∏", "–ú–∞–≥–∏—è –≤–æ–∑–¥—É—Ö–∞", "–ú–∞–≥–∏—è –æ–≥–Ω—è"];
let notes = [];
let inventory = {
    weapons: [],
    armor: [],
    potions: [],
    scrolls: [],
    resources: [],
    valuables: [],
    tools: [],
    other: []
};
let diceHistory = [];
let lockedSkills = {};
let customCategories = [];
let skillRollHistory = {};
let characters = {};
let currentCharacterId = null;
// ========== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò ==========
function loadSkillRollHistory() {
    const saved = localStorage.getItem('skillRollHistory');
    if (saved) {
        skillRollHistory = JSON.parse(saved);
    }
}

function saveSkillRollHistory() {
    localStorage.setItem('skillRollHistory', JSON.stringify(skillRollHistory));
}

function loadLockedSkills() {
    const saved = localStorage.getItem('lockedSkills');
    if (saved) {
        lockedSkills = JSON.parse(saved);
    }
}

function saveLockedSkills() {
    localStorage.setItem('lockedSkills', JSON.stringify(lockedSkills));
}

function loadCustomCategories() {
    const saved = localStorage.getItem('customCategories');
    if (saved) {
        customCategories = JSON.parse(saved);
        updateCategoryManagement();
    }
}

function saveCustomCategories() {
    localStorage.setItem('customCategories', JSON.stringify(customCategories));
}

function loadSpells() {
    const saved = localStorage.getItem('characterSpells');
    if (saved) {
        const data = JSON.parse(saved);
        Object.keys(spellsBySchool).forEach(school => {
            if (data[school]) {
                spellsBySchool[school] = data[school];
            }
        });
    }
}

function saveSpells() {
    localStorage.setItem('characterSpells', JSON.stringify(spellsBySchool));
}

function loadNotes() {
    const saved = localStorage.getItem('characterNotes');
    if (saved) {
        notes = JSON.parse(saved);
    }
}

function saveNotes() {
    localStorage.setItem('characterNotes', JSON.stringify(notes));
}

function loadInventory() {
    const saved = localStorage.getItem('inventoryData');
    if (saved) {
        inventory = JSON.parse(saved);
    }
}

function saveInventory() {
    localStorage.setItem('inventoryData', JSON.stringify(inventory));
}

// ========== –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –í–ö–õ–ê–î–ö–ê–ú–ò ==========
function openTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.getElementById(tabName + '-tab').classList.add('active');
    event.currentTarget.classList.add('active');
}

// ========== –°–ò–°–¢–ï–ú–ê –†–ê–° ==========
function generateRandomHeight(raceId) {
    const range = raceHeightRanges[raceId];
    return range ? Math.floor(Math.random() * (range.max - range.min + 1)) + range.min : 170;
}

function onRaceChange() {
    const raceId = document.getElementById('characterRace').value;
    if (raceId) {
        showRaceInfo(raceId);
    }
}

function showRaceInfo(raceId) {
    const race = races[raceId];
    if (!race) return;

    const popup = document.createElement('div');
    popup.className = 'popup';
    popup.innerHTML = `
        <div class="popup-content">
            <h2 style="color: #d4af37; margin-bottom: 15px;">${race.name}</h2>
            <p style="margin-bottom: 10px;"><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${race.description}</p>
            <p style="margin-bottom: 10px;"><strong>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∂–∏–∑–Ω–∏:</strong> ${race.lifespan}</p>
            
            ${Object.keys(race.bonuses).length > 0 ? `
                <p style="margin-bottom: 5px;"><strong>–ë–æ–Ω—É—Å—ã:</strong></p>
                <ul style="margin-bottom: 15px; margin-left: 20px;">
                    ${Object.entries(race.bonuses).map(([skill, bonus]) => 
                        `<li>${skill}: +${bonus}</li>`
                    ).join('')}
                </ul>
            ` : ''}
            
            ${Object.keys(race.limitations).length > 0 ? `
                <p style="margin-bottom: 5px;"><strong>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:</strong></p>
                <ul style="margin-bottom: 15px; margin-left: 20px;">
                    ${Object.entries(race.limitations).map(([skill, limit]) => 
                        `<li>${skill}: –º–∞–∫—Å–∏–º—É–º ${limit === 0 ? '–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ' : limit}</li>`
                    ).join('')}
                </ul>
            ` : ''}
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-plus" onclick="setRace('${raceId}')">‚úÖ –í—ã–±—Ä–∞—Ç—å —Ä–∞—Å—É</button>
                <button class="btn btn-roll" onclick="this.closest('.popup').remove()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    `;
    document.body.appendChild(popup);
}

function setRace(raceId) {
    const race = races[raceId];
    if (!race) return;
    
    availableMagicSchools = {};
    document.getElementById('characterRace').value = raceId;
    
    const randomHeight = generateRandomHeight(raceId);
    document.getElementById('characterHeight').value = randomHeight;
    
    const lifespan = parseInt(race.lifespan);
    document.getElementById('characterAge').value = Math.max(15, Math.floor(lifespan * 0.1));
    
    document.getElementById('generateHeightBtn').disabled = true;
    
    determineAvailableMagicSchools(raceId);
    applyRaceBonuses(raceId);
    
    saveCharacterData();
    document.querySelector('.popup').remove();
    alert(`‚úÖ –†–∞—Å–∞ "${race.name}" –≤—ã–±—Ä–∞–Ω–∞!\nüìè –†–æ—Å—Ç: ${randomHeight} —Å–º`);
}

function determineAvailableMagicSchools(raceId) {
    availableMagicSchools = {};
    
    switch(raceId) {
        case 'forest_elf':
            availableMagicSchools["–ú–∞–≥–∏—è –ø—Ä–∏—Ä–æ–¥—ã"] = true;
            break;
        case 'dark_elf':
            availableMagicSchools["–ú–∞–≥–∏—è —Ç—å–º—ã"] = true;
            break;
        case 'high_elf':
            const shuffled = [...baseMagicSchools].sort(() => 0.5 - Math.random());
            availableMagicSchools[shuffled[0]] = true;
            availableMagicSchools[shuffled[1]] = true;
            break;
        case 'goblin':
            break;
        default:
            const randomSchool = baseMagicSchools[Math.floor(Math.random() * baseMagicSchools.length)];
            availableMagicSchools[randomSchool] = true;
    }
    
    const race = races[raceId];
    if (race && race.limitations) {
        Object.keys(race.limitations).forEach(school => {
            if (race.limitations[school] === 0) {
                availableMagicSchools[school] = false;
            }
        });
    }
    
    updateMagicSkillsDisplay();
}

function applyRaceBonuses(raceId) {
    const race = races[raceId];
    if (!race || !race.bonuses) return;
    
    Object.entries(race.bonuses).forEach(([skill, bonus]) => {
        const currentValue = getSkillValue(skill);
        setSkillValue(skill, currentValue + bonus);
    });
    
    updateUI();
}

function generateHeightForSelectedRace() {
    const selectedRace = document.getElementById('characterRace').value;
    if (!selectedRace) {
        alert('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å—É!');
        return;
    }
    
    const randomHeight = generateRandomHeight(selectedRace);
    document.getElementById('characterHeight').value = randomHeight;
    document.getElementById('generateHeightBtn').disabled = true;
    saveCharacterData();
    alert(`üìè –ù–æ–≤—ã–π —Ä–æ—Å—Ç: ${randomHeight} —Å–º`);
}
</script> 
    <script>
// ========== –°–ò–°–¢–ï–ú–ê –ù–ê–í–´–ö–û–í –ò –ú–ê–ì–ò–ò ==========

function updateMagicSkillsDisplay() {
    const magicSkills = skillsStructure["üîÆ –ú–ê–ì–ò–Ø"];
    magicSkills.forEach(skill => {
        const skillElement = document.getElementById(`skill-${skill}`);
        if (skillElement) {
            const skillRow = skillElement.closest('.skill-row');
            const isAvailable = availableMagicSchools[skill] || getSkillValue(skill) > 5;
            if (skillRow) {
                skillRow.classList.toggle('skill-disabled', !isAvailable);
            }
        }
    });
}

function renderSkills() {
    const container = document.getElementById('skillsContainer');
    if (!container) return;
    
    container.innerHTML = '';

    for (const [groupName, skills] of Object.entries(skillsStructure)) {
        const section = document.createElement('div');
        section.className = 'skills-section';
        
        const title = document.createElement('div');
        title.className = 'section-title';
        title.innerHTML = groupName;
        section.appendChild(title);

        skills.forEach(skill => {
            const skillRow = document.createElement('div');
            skillRow.className = 'skill-row';
            const isLocked = isSkillLocked(skill);
            if (isLocked) {
                skillRow.classList.add('skill-locked');
            }
            
            const spellIcon = groupName === "üîÆ –ú–ê–ì–ò–Ø" ? 
                `<span class="spell-icon" onclick="showSpells('${skill}')" title="–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è">üîÆ</span>` : '';
            
            const lockBtnText = isLocked ? 'üîì' : 'üîí';
            const lockBtnClass = isLocked ? 'btn-lock locked' : 'btn-lock';
            
            skillRow.innerHTML = `
                <div class="skill-name">
                    <span>üéØ</span>
                    <span>${skill}</span>
                    ${spellIcon}
                </div>
                <div class="skill-controls">
                    <button class="btn btn-minus" onclick="decreaseSkill('${skill}')" ${isLocked ? 'disabled' : (getSkillValue(skill) <= 5 ? 'disabled' : '')}>-</button>
                    <span class="skill-value" id="skill-${skill}">${getSkillValue(skill)}</span>
                    <button class="btn btn-plus" onclick="increaseSkill('${skill}')" ${isLocked ? 'disabled' : (getFreePoints() <= 0 ? 'disabled' : '')}>+</button>
                    <button class="${lockBtnClass}" onclick="toggleSkillLock('${skill}')" title="${isLocked ? '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' : '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å'}">${lockBtnText}</button>
                    <button class="btn btn-roll" onclick="rollSkill('${skill}')" ${isLocked ? 'disabled' : ''}>–ë—Ä–æ—Å–æ–∫</button>
                </div>
            `;
            section.appendChild(skillRow);
        });
        container.appendChild(section);
    }
    updateUI();
}

function isSkillLocked(skillName) {
    return lockedSkills[skillName] || false;
}

function toggleSkillLock(skillName) {
    const currentlyLocked = isSkillLocked(skillName);
    
    if (currentlyLocked) {
        const unlock = confirm(`üîì –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≤—ã–∫ "${skillName}"?\n\n–ù–∞–≤—ã–∫ —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –ø—Ä–æ–∫–∞—á–∫–∏.`);
        if (unlock) {
            lockedSkills[skillName] = false;
            saveLockedSkills();
            renderSkills();
            updateUI();
            alert(`‚úÖ –ù–∞–≤—ã–∫ "${skillName}" —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!`);
        }
    } else {
        const lock = confirm(`üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≤—ã–∫ "${skillName}"?\n\n–ù–∞–≤—ã–∫ —Å—Ç–∞–Ω–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –ø—Ä–æ–∫–∞—á–∫–∏.`);
        if (lock) {
            lockedSkills[skillName] = true;
            saveLockedSkills();
            renderSkills();
            updateUI();
            alert(`‚úÖ –ù–∞–≤—ã–∫ "${skillName}" –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!`);
        }
    }
}

function increaseSkill(skillName) {
    if (isSkillLocked(skillName)) {
        alert('‚ùå –≠—Ç–æ—Ç –Ω–∞–≤—ã–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!');
        return;
    }
    
    const isMagicSkill = skillsStructure["üîÆ –ú–ê–ì–ò–Ø"].includes(skillName);
    if (isMagicSkill && !availableMagicSchools[skillName] && getSkillValue(skillName) <= 5) {
        const masterPermission = confirm(
            `üîÆ –í—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å –∏–∑—É—á–∏—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—É—é –º–∞–≥–∏—é!\n\n` +
            `–ù–∞–≤—ã–∫ "${skillName}" –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –≤–∞—à–µ–π —Ä–∞—Å—ã.\n` +
            `–í—ã –ø–æ–ª—É—á–∏–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ú–∞—Å—Ç–µ—Ä–∞ –Ω–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫—É —ç—Ç–æ–π –º–∞–≥–∏–∏?\n\n` +
            `–ù–∞–∂–º–∏—Ç–µ "–û–ö" –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–Ω–∞–≤—ã–∫ —Å—Ç–∞–Ω–µ—Ç 5 —É—Ä–æ–≤–Ω—è) –∏–ª–∏ "–û—Ç–º–µ–Ω–∞" –¥–ª—è –æ—Ç–º–µ–Ω—ã.`
        );
        
        if (masterPermission) {
            availableMagicSchools[skillName] = true;
            setSkillValue(skillName, 5);
            updateMagicSkillsDisplay();
            updateUI();
            saveCharacterData();
        }
        return;
    }
    
    const freePoints = getFreePoints();
    if (freePoints > 0) {
        const skillValue = getSkillValue(skillName);
        setSkillValue(skillName, skillValue + 1);
        setFreePoints(freePoints - 1);
        updateUI();
        saveCharacterData();
    }
}

function decreaseSkill(skillName) {
    if (isSkillLocked(skillName)) {
        alert('‚ùå –≠—Ç–æ—Ç –Ω–∞–≤—ã–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!');
        return;
    }
    
    const skillValue = getSkillValue(skillName);
    if (skillValue > 5) {
        const freePoints = getFreePoints();
        setSkillValue(skillName, skillValue - 1);
        setFreePoints(freePoints + 1);
        updateUI();
        saveCharacterData();
    }
}

function addToSkillHistory(skillName, rollData) {
    if (!skillRollHistory[skillName]) {
        skillRollHistory[skillName] = [];
    }
    
    skillRollHistory[skillName].unshift({
        timestamp: new Date().toLocaleTimeString(),
        ...rollData
    });
    
    if (skillRollHistory[skillName].length > 10) {
        skillRollHistory[skillName].pop();
    }
    
    saveSkillRollHistory();
}

function getSkillHistory(skillName) {
    return skillRollHistory[skillName] || [];
}

function rollSkill(skillName) {
    if (isSkillLocked(skillName)) {
        alert('‚ùå –≠—Ç–æ—Ç –Ω–∞–≤—ã–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è!');
        return;
    }
    
    const skillValue = getSkillValue(skillName);
    const roll1 = Math.floor(Math.random() * 6) + 1;
    const roll2 = Math.floor(Math.random() * 6) + 1;
    const roll3 = Math.floor(Math.random() * 6) + 1;
    const totalRoll = roll1 + roll2 + roll3;

    let resultText, resultClass;
    if (totalRoll === 3 || totalRoll === 4) {
        resultText = "üí´ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –£–°–ü–ï–•!";
        resultClass = "success";
    } else if (totalRoll === 17 || totalRoll === 18) {
        resultText = "üí• –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ü–†–û–í–ê–õ!";
        resultClass = "failure";
    } else if (totalRoll <= skillValue) {
        resultText = "‚úÖ –£–°–ü–ï–•!";
        resultClass = "success";
    } else {
        resultText = "‚ùå –ù–ï–£–î–ê–ß–ê!";
        resultClass = "failure";
    }

    showRollResult(skillName, skillValue, [roll1, roll2, roll3], totalRoll, resultText, resultClass);
}

function showRollResult(skillName, skillValue, dice, total, resultText, resultClass) {
    addToSkillHistory(skillName, {
        skillValue: skillValue,
        dice: dice,
        total: total,
        result: resultText,
        success: resultClass === "success"
    });
    
    const history = getSkillHistory(skillName);
    let historyHTML = '';
    
    if (history.length > 0) {
        historyHTML = `
            <div style="margin-top: 20px; border-top: 2px solid #5a3928; padding-top: 15px;">
                <h4 style="color: #d4af37; margin-bottom: 10px;">üìä –ò—Å—Ç–æ—Ä–∏—è –±—Ä–æ—Å–∫–æ–≤ (${history.length}/10):</h4>
                <div style="max-height: 150px; overflow-y: auto;">
        `;
        
        history.forEach((roll, index) => {
            const successIcon = roll.success ? '‚úÖ' : '‚ùå';
            historyHTML += `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 5px 0; border-bottom: 1px solid #3d2418;">
                    <span style="font-size: 0.9em;">${roll.timestamp}</span>
                    <span style="font-size: 0.9em;">${roll.dice.join('+')}=${roll.total}</span>
                    <span>${successIcon}</span>
                </div>
            `;
        });
        
        historyHTML += `</div></div>`;
    }
    
    const popup = document.createElement('div');
    popup.className = 'popup';
    popup.innerHTML = `
        <div class="popup-content">
            <h2 style="color: #d4af37;">–ë—Ä–æ—Å–æ–∫ –Ω–∞ "${skillName}" (${skillValue})</h2>
            <div class="dice-rolls">
                <div class="dice">${dice[0]}</div>
                <div class="dice">${dice[1]}</div>
                <div class="dice">${dice[2]}</div>
            </div>
            <div style="font-size: 1.5em; margin: 20px 0; color: #e0d0c0;">${dice.join(' + ')} = ${total}</div>
            <div class="${resultClass}">${resultText}</div>
            
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                <button class="btn btn-roll" onclick="rollSkill('${skillName}'); this.closest('.popup').remove();">üé≤ –ö–∏–Ω—É—Ç—å –µ—â–µ</button>
                <button class="btn btn-roll" onclick="this.closest('.popup').remove()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
            
            ${historyHTML}
        </div>
    `;
    document.body.appendChild(popup);
}

// ========== –°–ò–°–¢–ï–ú–ê –ó–ê–ö–õ–ò–ù–ê–ù–ò–ô ==========
function showSpells(schoolName) {
    if (!availableMagicSchools[schoolName] && getSkillValue(schoolName) <= 5) {
        alert('‚ùå –≠—Ç–∞ —à–∫–æ–ª–∞ –º–∞–≥–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –≤–∞—à–µ–π —Ä–∞—Å—ã!');
        return;
    }
    
    const spells = spellsBySchool[schoolName] || [];
    const popup = document.createElement('div');
    popup.className = 'popup';
    
    let spellsHTML = '';
    spells.forEach((spell, index) => {
        spellsHTML += `
            <div class="spell-item">
                <div class="spell-header">
                    <span class="spell-name">${spell.name}</span>
                    <span class="spell-order">–ü–æ—Ä—è–¥–æ–∫ ${spell.order}</span>
                </div>
                <div class="spell-details">
                    <p><strong>–≠—Ñ—Ñ–µ–∫—Ç:</strong> ${spell.effect}</p>
                    <p><strong>–¢–∏–ø:</strong> ${spell.type}</p>
                    <p><strong>–£—Å–ª–æ–≤–∏—è:</strong> ${spell.conditions}</p>
                    <p><strong>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> ${spell.duration}</p>
                    <p><strong>–ó–∞—Ç—Ä–∞—Ç—ã:</strong> ${spell.cost}</p>
                </div>
                <div class="spell-learned">
                    <input type="checkbox" id="spell-${schoolName}-${index}" 
                           ${spell.learned ? 'checked' : ''} 
                           onchange="toggleSpellLearned('${schoolName}', ${index})">
                    <label for="spell-${schoolName}-${index}" style="color: #e0d0c0;">–ò–∑—É—á–µ–Ω–æ</label>
                </div>
            </div>
        `;
    });
    
    popup.innerHTML = `
        <div class="popup-content spells-content">
            <h2 style="color: #d4af37; text-align: center; margin-bottom: 20px;">üîÆ ${schoolName}</h2>
            <div style="max-height: 60vh; overflow-y: auto;">
                ${spellsHTML || '<p style="text-align: center; color: #8b7d6b;">–ó–∞–∫–ª–∏–Ω–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>'}
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-roll" onclick="this.closest('.popup').remove()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    `;
    
    document.body.appendChild(popup);
}

function toggleSpellLearned(schoolName, spellIndex) {
    if (spellsBySchool[schoolName] && spellsBySchool[schoolName][spellIndex]) {
        spellsBySchool[schoolName][spellIndex].learned = 
            !spellsBySchool[schoolName][spellIndex].learned;
        saveSpells();
    }
}

// ========== –°–ò–°–¢–ï–ú–ê –£–†–û–í–ù–ï–ô –ò –•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö ==========
function addExperience() {
    const expToAdd = prompt('–°–∫–æ–ª—å–∫–æ –æ–ø—ã—Ç–∞ –¥–æ–±–∞–≤–∏—Ç—å?');
    if (expToAdd && !isNaN(expToAdd)) {
        let currentExp = getCurrentExp();
        currentExp += parseInt(expToAdd);
        setCurrentExp(currentExp);
        checkLevelUp();
        updateLevelDisplay();
        saveCharacterData();
    }
}

function checkLevelUp() {
    let currentLevel = getCurrentLevel();
    let currentExp = getCurrentExp();
    
    if (currentLevel >= 9) return;
    
    while (currentLevel < 9 && currentExp >= levelTable[currentLevel].expRequired) {
        currentLevel++;
        
        const health = getHealth() + levelTable[currentLevel].hp;
        const mana = getMana() + levelTable[currentLevel].mana;
        const stamina = getStamina() + levelTable[currentLevel].stamina;
        const freePoints = getFreePoints() + levelTable[currentLevel].points;
        
        setHealth(health);
        setMana(mana);
        setStamina(stamina);
        setFreePoints(freePoints);
        
        currentExp = currentExp - levelTable[currentLevel-1].expRequired;
        setCurrentExp(currentExp);
        setCurrentLevel(currentLevel);
        
        alert(`üéâ –£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω –¥–æ ${currentLevel}!`);
    }
}

function editLevel() {
    const newLevel = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å (0-9):', getCurrentLevel());
    if (newLevel && !isNaN(newLevel) && newLevel >= 0 && newLevel <= 9) {
        setCurrentLevel(parseInt(newLevel));
        updateStatsForLevel();
        updateLevelDisplay();
        saveCharacterData();
    }
}

function updateStatsForLevel() {
    const currentLevel = getCurrentLevel();
    let totalHP = 100, totalMana = 100, totalStamina = 100;
    
    for (let i = 0; i <= currentLevel; i++) {
        totalHP += levelTable[i].hp;
        totalMana += levelTable[i].mana;
        totalStamina += levelTable[i].stamina;
    }
    
    setHealth(totalHP);
    setMana(totalMana);
    setStamina(totalStamina);
}

function convertExpToPoints() {
    const currentExp = getCurrentExp();
    const availablePoints = Math.floor(currentExp / 1000);
    
    if (availablePoints > 0) {
        const expToConvert = availablePoints * 1000;
        setCurrentExp(currentExp - expToConvert);
        setFreePoints(getFreePoints() + availablePoints);
        
        alert(`üíé –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${availablePoints} –æ—á–∫–æ–≤ –Ω–∞–≤—ã–∫–æ–≤!`);
        updateLevelDisplay();
        updateUI();
        saveCharacterData();
    }
}

function updateLevelDisplay() {
    const currentLevel = getCurrentLevel();
    const currentExp = getCurrentExp();
    const convertBtn = document.getElementById('convertBtn');
    
    document.getElementById('currentLevel').textContent = currentLevel;
    document.getElementById('currentExp').value = currentExp;
    
    if (currentLevel < 9) {
        document.getElementById('requiredExp').textContent = levelTable[currentLevel].expRequired;
        convertBtn.style.display = 'none';
    } else {
        document.getElementById('requiredExp').textContent = 'MAX';
        convertBtn.style.display = 'block';
    }
}

function showLevelsTable() {
    const currentLevel = getCurrentLevel();
    const popup = document.createElement('div');
    popup.className = 'popup';
    popup.innerHTML = `
        <div class="popup-content">
            <h2 style="color: #d4af37; margin-bottom: 20px;">üìä –¢–∞–±–ª–∏—Ü–∞ —É—Ä–æ–≤–Ω–µ–π</h2>
            <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                <tr><th style="padding: 8px; border: 1px solid #5a3928; background: #3d2418; color: #d4af37;">–£—Ä.</th><th style="padding: 8px; border: 1px solid #5a3928; background: #3d2418; color: #d4af37;">–û–ø—ã—Ç</th><th style="padding: 8px; border: 1px solid #5a3928; background: #3d2418; color: #d4af37;">–•–ü</th><th style="padding: 8px; border: 1px solid #5a3928; background: #3d2418; color: #d4af37;">–ú–∞–Ω–∞</th><th style="padding: 8px; border: 1px solid #5a3928; background: #3d2418; color: #d4af37;">–°—Ç–∞–º–∏–Ω–∞</th><th style="padding: 8px; border: 1px solid #5a3928; background: #3d2418; color: #d4af37;">–û—á–∫–∏</th></tr>
                ${Object.entries(levelTable).map(([level, data]) => `
                    <tr style="${level == currentLevel ? 'background: #8b4513; font-weight: bold;' : ''}">
                        <td style="padding: 8px; border: 1px solid #5a3928; text-align: center;">${level}</td>
                        <td style="padding: 8px; border: 1px solid #5a3928; text-align: center;">${data.expRequired || 'MAX'}</td>
                        <td style="padding: 8px; border: 1px solid #5a3928; text-align: center;">+${data.hp}</td>
                        <td style="padding: 8px; border: 1px solid #5a3928; text-align: center;">+${data.mana}</td>
                        <td style="padding: 8px; border: 1px solid #5a3928; text-align: center;">+${data.stamina}</td>
                        <td style="padding: 8px; border: 1px solid #5a3928; text-align: center;">+${data.points}</td>
                    </tr>
                `).join('')}
            </table>
            <button class="btn btn-roll" onclick="this.closest('.popup').remove()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    `;
    document.body.appendChild(popup);
}

function changeStat(stat, value) {
    const input = document.getElementById(stat);
    let currentValue = parseInt(input.value) || 0;
    let newValue = currentValue + value;
    if (newValue < 0) newValue = 0;
    input.value = newValue;
    saveCharacterData();
}

function editFreePoints() {
    const newPoints = prompt('–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –æ—á–∫–æ–≤:', getFreePoints());
    if (newPoints && !isNaN(newPoints)) {
        setFreePoints(parseInt(newPoints));
        updateUI();
        saveCharacterData();
    }
}

function updateUI() {
    const freePoints = getFreePoints();
    
    document.querySelectorAll('.skill-row').forEach(row => {
        const skillName = row.querySelector('.skill-name span:nth-child(2)').textContent;
        const skillValue = getSkillValue(skillName);
        const isLocked = isSkillLocked(skillName);
        const minusBtn = row.querySelector('.btn-minus');
        const plusBtn = row.querySelector('.btn-plus');
        const rollBtn = row.querySelector('.btn-roll');
        
        row.querySelector('.skill-value').textContent = skillValue;
        
        if (isLocked) {
            minusBtn.disabled = true;
            plusBtn.disabled = false;
            rollBtn.disabled = true;
            row.classList.add('skill-locked');
        } else {
            minusBtn.disabled = skillValue <= 5;
            plusBtn.disabled = freePoints <= 0;
            rollBtn.disabled = false;
            row.classList.remove('skill-locked');
        }
    });
    
    updateMagicSkillsDisplay();
}
</script>
<script>
// ========== –°–ò–°–¢–ï–ú–ê –ò–ù–í–ï–ù–¢–ê–†–Ø ==========

function showAddItemPopup() {
    const popup = document.createElement('div');
    popup.className = 'popup';
    
    let categoryOptions = '';
    
    const standardCategories = [
        { id: 'weapons', name: '‚öîÔ∏è –û—Ä—É–∂–∏–µ' },
        { id: 'armor', name: 'üõ°Ô∏è –ë—Ä–æ–Ω—è' },
        { id: 'potions', name: 'üß™ –ó–µ–ª—å—è' },
        { id: 'scrolls', name: 'üìú –°–≤–∏—Ç–∫–∏' },
        { id: 'resources', name: 'üíé –†–µ—Å—É—Ä—Å—ã' },
        { id: 'valuables', name: 'üí∞ –¶–µ–Ω–Ω–æ—Å—Ç–∏' },
        { id: 'tools', name: 'üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã' },
        { id: 'other', name: 'üéí –ü—Ä–æ—á–µ–µ' }
    ];
    
    standardCategories.forEach(cat => {
        categoryOptions += `<option value="${cat.id}">${cat.name}</option>`;
    });
    
    customCategories.forEach(catId => {
        const catName = getCategoryName(catId);
        categoryOptions += `<option value="${catId}">${catName}</option>`;
    });
    
    popup.innerHTML = `
        <div class="popup-content">
            <h2 style="color: #d4af37;">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç</h2>
            <input type="text" id="itemName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞" style="width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #8b4513; border-radius: 4px; background: #1a0f0b; color: #e0d0c0; font-size: 16px;">
            
            <select id="itemCategory" style="width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #8b4513; border-radius: 4px; background: #1a0f0b; color: #e0d0c0; font-size: 16px;">
                ${categoryOptions}
            </select>
            
            <input type="number" id="itemQuantity" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" value="1" min="1" style="width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #8b4513; border-radius: 4px; background: #1a0f0b; color: #e0d0c0; font-size: 16px;">
            
            <textarea id="itemDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)" style="width: 100%; height: 120px; padding: 12px; margin: 10px 0; border: 2px solid #8b4513; border-radius: 4px; background: #1a0f0b; color: #e0d0c0; resize: vertical; font-size: 16px;"></textarea>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-plus" onclick="addItem()">–î–æ–±–∞–≤–∏—Ç—å</button>
                <button class="btn btn-roll" onclick="this.closest('.popup').remove()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    `;
    document.body.appendChild(popup);
}

function addItem() {
    const name = document.getElementById('itemName').value.trim();
    const category = document.getElementById('itemCategory').value;
    const quantity = parseInt(document.getElementById('itemQuantity').value) || 1;
    const description = document.getElementById('itemDescription').value.trim();
    
    if (!name) {
        alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞!');
        return;
    }
    
    if (!inventory[category]) {
        inventory[category] = [];
    }
    
    inventory[category].push({
        id: Date.now(),
        name,
        quantity,
        description,
        expanded: false
    });
    
    saveInventory();
    renderInventory();
    document.querySelector('.popup').remove();
    alert('‚úÖ –ü—Ä–µ–¥–º–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å!');
}

function renderInventory() {
    const container = document.getElementById('inventoryContainer');
    const searchTerm = document.getElementById('inventorySearch').value.toLowerCase();
    
    let inventoryHTML = '';
    
    const standardCategories = ['weapons', 'armor', 'potions', 'scrolls', 'resources', 'valuables', 'tools', 'other'];
    standardCategories.forEach(category => {
        if (inventory[category] && inventory[category].length > 0) {
            let filteredItems = inventory[category];
            if (searchTerm) {
                filteredItems = inventory[category].filter(item => 
                    item.name.toLowerCase().includes(searchTerm) ||
                    (item.description && item.description.toLowerCase().includes(searchTerm)) ||
                    (item.quantity && item.quantity.toString().includes(searchTerm))
                );
            }
            
            if (filteredItems.length > 0) {
                inventoryHTML += createCategoryHTML(category, filteredItems);
            }
        }
    });
    
    customCategories.forEach(categoryId => {
        if (inventory[categoryId] && inventory[categoryId].length > 0) {
            let filteredItems = inventory[categoryId];
            if (searchTerm) {
                filteredItems = inventory[categoryId].filter(item => 
                    item.name.toLowerCase().includes(searchTerm) ||
                    (item.description && item.description.toLowerCase().includes(searchTerm)) ||
                    (item.quantity && item.quantity.toString().includes(searchTerm))
                );
            }
            
            if (filteredItems.length > 0) {
                inventoryHTML += createCategoryHTML(categoryId, filteredItems);
            }
        }
    });
    
    container.innerHTML = inventoryHTML || '<p style="color: #8b7d6b; text-align: center;">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</p>';
}

function createCategoryHTML(category, items) {
    return `
        <div class="skills-section">
            <div class="section-title">${getCategoryName(category)}</div>
            ${items.map((item, index) => `
                <div class="inventory-item">
                    <div class="item-header">
                        <div class="item-name">
                            ${getCategoryIcon(category)}
                            ${item.name}
                            ${item.quantity > 1 ? `<span class="item-quantity">√ó${item.quantity}</span>` : ''}
                        </div>
                        <div class="item-actions">
                            <button class="btn btn-small" onclick="editItem('${category}', ${index})" style="background: #3498db;">‚úèÔ∏è</button>
                            <button class="btn btn-small" onclick="deleteItem('${category}', ${index})" style="background: #c44536;">‚ùå</button>
                            ${item.description ? `
                                <button class="btn btn-small" onclick="toggleItemExpand('${category}', ${index})" style="background: #8b4513;">
                                    ${item.expanded ? '‚ñº' : '‚ñ∂'}
                                </button>
                            ` : ''}
                        </div>
                    </div>
                    ${item.description && item.expanded ? `
                        <div class="item-description">
                            ${item.description}
                        </div>
                    ` : ''}
                </div>
            `).join('')}
        </div>
    `;
}

function getCategoryName(category) {
    const customName = localStorage.getItem(`category_name_${category}`);
    if (customName) return customName;
    
    const names = {
        weapons: '‚öîÔ∏è –û—Ä—É–∂–∏–µ',
        armor: 'üõ°Ô∏è –ë—Ä–æ–Ω—è',
        potions: 'üß™ –ó–µ–ª—å—è',
        scrolls: 'üìú –°–≤–∏—Ç–∫–∏',
        resources: 'üíé –†–µ—Å—É—Ä—Å—ã',
        valuables: 'üí∞ –¶–µ–Ω–Ω–æ—Å—Ç–∏',
        tools: 'üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã',
        other: 'üéí –ü—Ä–æ—á–µ–µ'
    };
    return names[category] || category;
}

function getCategoryIcon(category) {
    const icons = {
        weapons: '‚öîÔ∏è',
        armor: 'üõ°Ô∏è',
        potions: 'üß™',
        scrolls: 'üìú',
        resources: 'üíé',
        valuables: 'üí∞',
        tools: 'üîß',
        other: 'üéí'
    };
    return icons[category] || 'üìÅ';
}

function editItem(category, index) {
    const item = inventory[category][index];
    const popup = document.createElement('div');
    popup.className = 'popup';
    popup.innerHTML = `
        <div class="popup-content">
            <h2 style="color: #d4af37;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç</h2>
            <input type="text" id="editItemName" value="${item.name}" style="width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #8b4513; border-radius: 4px; background: #1a0f0b; color: #e0d0c0; font-size: 16px;">
            
            <select id="editItemCategory" style="width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #8b4513; border-radius: 4px; background: #1a0f0b; color: #e0d0c0; font-size: 16px;">
                <option value="weapons" ${category === 'weapons' ? 'selected' : ''}>‚öîÔ∏è –û—Ä—É–∂–∏–µ</option>
                <option value="armor" ${category === 'armor' ? 'selected' : ''}>üõ°Ô∏è –ë—Ä–æ–Ω—è</option>
                <option value="potions" ${category === 'potions' ? 'selected' : ''}>üß™ –ó–µ–ª—å—è</option>
                <option value="scrolls" ${category === 'scrolls' ? 'selected' : ''}>üìú –°–≤–∏—Ç–∫–∏</option>
                <option value="resources" ${category === 'resources' ? 'selected' : ''}>üíé –†–µ—Å—É—Ä—Å—ã</option>
                <option value="valuables" ${category === 'valuables' ? 'selected' : ''}>üí∞ –¶–µ–Ω–Ω–æ—Å—Ç–∏</option>
                <option value="tools" ${category === 'tools' ? 'selected' : ''}>üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</option>
                <option value="other" ${category === 'other' ? 'selected' : ''}>üéí –ü—Ä–æ—á–µ–µ</option>
                ${customCategories.map(catId => `
                    <option value="${catId}" ${category === catId ? 'selected' : ''}>${getCategoryName(catId)}</option>
                `).join('')}
            </select>
            
            <input type="number" id="editItemQuantity" value="${item.quantity}" min="1" style="width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #8b4513; border-radius: 4px; background: #1a0f0b; color: #e0d0c0; font-size: 16px;">
            
            <textarea id="editItemDescription" style="width: 100%; height: 120px; padding: 12px; margin: 10px 0; border: 2px solid #8b4513; border-radius: 4px; background: #1a0f0b; color: #e0d0c0; resize: vertical; font-size: 16px;">${item.description}</textarea>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-plus" onclick="saveEditedItem('${category}', ${index})">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn btn-roll" onclick="this.closest('.popup').remove()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    `;
    document.body.appendChild(popup);
}

function saveEditedItem(oldCategory, index) {
    const name = document.getElementById('editItemName').value.trim();
    const newCategory = document.getElementById('editItemCategory').value;
    const quantity = parseInt(document.getElementById('editItemQuantity').value) || 1;
    const description = document.getElementById('editItemDescription').value.trim();
    
    if (!name) {
        alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞!');
        return;
    }
    
    const item = inventory[oldCategory].splice(index, 1)[0];
    
    item.name = name;
    item.quantity = quantity;
    item.description = description;
    
    if (!inventory[newCategory]) {
        inventory[newCategory] = [];
    }
    inventory[newCategory].push(item);
    
    saveInventory();
    renderInventory();
    document.querySelector('.popup').remove();
}

function deleteItem(category, index) {
    if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç?')) {
        inventory[category].splice(index, 1);
        saveInventory();
        renderInventory();
    }
}

function toggleItemExpand(category, index) {
    inventory[category][index].expanded = !inventory[category][index].expanded;
    saveInventory();
    renderInventory();
}

// ========== –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–ò–ï –ö–ê–¢–ï–ì–û–†–ò–ò ==========
function showAddCategoryPopup() {
    document.getElementById('customCategoriesSection').style.display = 'block';
}

function addCustomCategory() {
    const categoryName = document.getElementById('newCategoryName').value.trim();
    if (!categoryName) {
        alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞!');
        return;
    }

    const categoryId = categoryName.toLowerCase().replace(/[^a-z0-9–∞-—è]/g, '_');
    
    if (inventory.hasOwnProperty(categoryId) || customCategories.includes(categoryId)) {
        alert('–†–∞–∑–¥–µ–ª —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!');
        return;
    }

    customCategories.push(categoryId);
    inventory[categoryId] = [];
    saveCustomCategories();
    saveInventory();
    
    document.getElementById('newCategoryName').value = '';
    updateCategoryManagement();
    renderInventory();
    
    alert(`‚úÖ –†–∞–∑–¥–µ–ª "${categoryName}" —Å–æ–∑–¥–∞–Ω!`);
}

function updateCategoryManagement() {
    const container = document.getElementById('customCategoriesList');
    if (customCategories.length === 0) {
        container.innerHTML = '<p style="color: #8b7d6b; text-align: center;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ –Ω–µ—Ç</p>';
        return;
    }

    let html = '';
    customCategories.forEach(categoryId => {
        const categoryName = getCategoryName(categoryId);
        const itemCount = inventory[categoryId] ? inventory[categoryId].length : 0;
        
        html += `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #2c1810; margin: 5px 0; border-radius: 4px;">
                <span>${categoryName} (${itemCount} –ø—Ä–µ–¥–º–µ—Ç–æ–≤)</span>
                <div>
                    <button class="btn btn-small" onclick="editCustomCategory('${categoryId}')" style="background: #3498db;">‚úèÔ∏è</button>
                    <button class="btn btn-small" onclick="deleteCustomCategory('${categoryId}')" style="background: #c44536;">‚ùå</button>
                </div>
            </div>
        `;
    });
    
    container.innerHTML = html;
}

function editCustomCategory(categoryId) {
    const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞:', getCategoryName(categoryId));
    if (newName && newName.trim()) {
        localStorage.setItem(`category_name_${categoryId}`, newName.trim());
        updateCategoryManagement();
        renderInventory();
    }
}

function deleteCustomCategory(categoryId) {
    if (inventory[categoryId] && inventory[categoryId].length > 0) {
        if (!confirm(`–í —Ä–∞–∑–¥–µ–ª–µ –µ—Å—Ç—å –ø—Ä–µ–¥–º–µ—Ç—ã! –£–¥–∞–ª–∏—Ç—å —Ä–∞–∑–¥–µ–ª "${getCategoryName(categoryId)}" –∏ –≤—Å–µ –µ–≥–æ –ø—Ä–µ–¥–º–µ—Ç—ã?`)) {
            return;
        }
    } else {
        if (!confirm(`–£–¥–∞–ª–∏—Ç—å —Ä–∞–∑–¥–µ–ª "${getCategoryName(categoryId)}"?`)) {
            return;
        }
    }

    customCategories = customCategories.filter(id => id !== categoryId);
    delete inventory[categoryId];
    localStorage.removeItem(`category_name_${categoryId}`);
    
    saveCustomCategories();
    saveInventory();
    updateCategoryManagement();
    renderInventory();
}

// ========== –°–ò–°–¢–ï–ú–ê –ó–ê–ú–ï–¢–û–ö ==========
function showAddNotePopup() {
    const popup = document.createElement('div');
    popup.className = 'popup';
    popup.innerHTML = `
        <div class="popup-content">
            <h2 style="color: #d4af37;">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</h2>
            <input type="text" id="noteTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏" style="width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #8b4513; border-radius: 4px; background: #1a0f0b; color: #e0d0c0; font-size: 16px;">
            <textarea id="noteContent" placeholder="–¢–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏" style="width: 100%; height: 200px; padding: 12px; margin: 10px 0; border: 2px solid #8b4513; border-radius: 4px; background: #1a0f0b; color: #e0d0c0; resize: vertical; font-size: 16px;"></textarea>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-plus" onclick="addNote()">–î–æ–±–∞–≤–∏—Ç—å</button>
                <button class="btn btn-roll" onclick="this.closest('.popup').remove()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    `;
    document.body.appendChild(popup);
}

function addNote() {
    const title = document.getElementById('noteTitle').value.trim();
    const content = document.getElementById('noteContent').value.trim();
    
    if (!title) {
        alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏!');
        return;
    }
    
    notes.push({
        id: Date.now(),
        title,
        content,
        expanded: false
    });
    
    saveNotes();
    renderNotes();
    document.querySelector('.popup').remove();
}

function renderNotes() {
    const container = document.getElementById('notesContainer');
    const searchTerm = document.getElementById('notesSearch').value.toLowerCase();
    
    let filteredNotes = notes;
    if (searchTerm) {
        filteredNotes = notes.filter(note => 
            note.title.toLowerCase().includes(searchTerm) || 
            note.content.toLowerCase().includes(searchTerm)
        );
    }
    
    if (filteredNotes.length === 0) {
        container.innerHTML = '<p style="color: #8b7d6b; text-align: center;">–ó–∞–º–µ—Ç–æ–∫ –Ω–µ—Ç</p>';
        return;
    }
    
    let notesHTML = '';
    filteredNotes.forEach((note, index) => {
        const preview = note.content.length > 100 ? note.content.substring(0, 100) + '...' : note.content;
        notesHTML += `
            <div class="note-item">
                <div class="note-header">
                    <span class="note-title">${note.title}</span>
                    <div class="note-actions">
                        <button class="btn btn-small" onclick="editNote(${index})" style="background: #3498db;">‚úèÔ∏è</button>
                        <button class="btn btn-small" onclick="deleteNote(${index})" style="background: #c44536;">‚ùå</button>
                        <button class="btn btn-small" onclick="toggleNoteExpand(${index})" style="background: #8b4513;">
                            ${note.expanded ? '‚ñº' : '‚ñ∂'}
                        </button>
                    </div>
                </div>
                <div class="note-preview">
                    ${note.expanded ? note.content : preview}
                </div>
            </div>
        `;
    });
    
    container.innerHTML = notesHTML;
}

function editNote(index) {
    const note = notes[index];
    const popup = document.createElement('div');
    popup.className = 'popup';
    popup.innerHTML = `
        <div class="popup-content">
            <h2 style="color: #d4af37;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–º–µ—Ç–∫—É</h2>
            <input type="text" id="editNoteTitle" value="${note.title}" style="width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #8b4513; border-radius: 4px; background: #1a0f0b; color: #e0d0c0; font-size: 16px;">
            <textarea id="editNoteContent" style="width: 100%; height: 200px; padding: 12px; margin: 10px 0; border: 2px solid #8b4513; border-radius: 4px; background: #1a0f0b; color: #e0d0c0; resize: vertical; font-size: 16px;">${note.content}</textarea>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-plus" onclick="saveEditedNote(${index})">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn btn-roll" onclick="this.closest('.popup').remove()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    `;
    document.body.appendChild(popup);
}

function saveEditedNote(index) {
    const title = document.getElementById('editNoteTitle').value.trim();
    const content = document.getElementById('editNoteContent').value.trim();
    
    if (!title) {
        alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏!');
        return;
    }
    
    notes[index].title = title;
    notes[index].content = content;
    
    saveNotes();
    renderNotes();
    document.querySelector('.popup').remove();
}

function deleteNote(index) {
    if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–º–µ—Ç–∫—É?')) {
        notes.splice(index, 1);
        saveNotes();
        renderNotes();
    }
}

function toggleNoteExpand(index) {
    notes[index].expanded = !notes[index].expanded;
    saveNotes();
    renderNotes();
}
</script>
<script>
// ========== –°–ò–°–¢–ï–ú–ê –ö–£–ë–ò–ö–û–í ==========

function rollDice(diceType) {
    const count = parseInt(document.getElementById('diceCount').value) || 1;
    let results = [];
    let total = 0;
    
    if (diceType === 'coin') {
        for (let i = 0; i < count; i++) {
            const result = Math.random() > 0.5 ? '–û—Ä—ë–ª' : '–†–µ—à–∫–∞';
            results.push(result);
        }
    } else {
        for (let i = 0; i < count; i++) {
            const result = Math.floor(Math.random() * diceType) + 1;
            results.push(result);
            total += result;
        }
    }
    
    displayDiceResults(diceType, count, results, total);
    addToDiceHistory(diceType, count, results, total);
}

function rollCustomDice() {
    const sides = parseInt(document.getElementById('customDiceSides').value) || 6;
    if (sides < 2) {
        alert('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä–∞–Ω–µ–π –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω—å—à–µ 2!');
        return;
    }
    rollDice(sides);
}

function displayDiceResults(diceType, count, results, total) {
    const container = document.getElementById('diceResults');
    let resultHTML = '';
    
    if (diceType === 'coin') {
        resultHTML = `<h3 style="color: #d4af37;">–ú–æ–Ω–µ—Ç–∫–∞ (${count} —Ä–∞–∑):</h3>`;
        resultHTML += `<div style="font-size: 1.2em; margin: 10px 0;">${results.join(', ')}</div>`;
    } else {
        const diceName = diceType === 0 ? '–ö–∞—Å—Ç–æ–º–Ω—ã–π' : `D${diceType}`;
        resultHTML = `<h3 style="color: #d4af37;">–ë—Ä–æ—Å–æ–∫ ${count}d${diceType}:</h3>`;
        resultHTML += `<div style="font-size: 1.2em; margin: 10px 0;">${results.join(' + ')}`;
        if (count > 1) {
            resultHTML += ` = <strong>${total}</strong>`;
        }
        resultHTML += `</div>`;
    }
    
    container.innerHTML = resultHTML;
}

function addToDiceHistory(diceType, count, results, total) {
    const timestamp = new Date().toLocaleTimeString();
    let entry = {
        timestamp,
        diceType: diceType === 'coin' ? '–ú–æ–Ω–µ—Ç–∫–∞' : `D${diceType}`,
        count,
        results: [...results],
        total
    };
    
    diceHistory.unshift(entry);
    if (diceHistory.length > 10) diceHistory.pop();
    renderDiceHistory();
}

function renderDiceHistory() {
    const container = document.getElementById('diceHistory');
    if (diceHistory.length === 0) {
        container.innerHTML = '<p style="color: #8b7d6b; text-align: center;">–ò—Å—Ç–æ—Ä–∏—è –±—Ä–æ—Å–∫–æ–≤ –ø—É—Å—Ç–∞</p>';
        return;
    }
    
    let historyHTML = '<h4 style="color: #d4af37; margin-bottom: 10px;">–ò—Å—Ç–æ—Ä–∏—è –±—Ä–æ—Å–∫–æ–≤:</h4>';
    diceHistory.forEach(entry => {
        if (entry.diceType === '–ú–æ–Ω–µ—Ç–∫–∞') {
            historyHTML += `<p style="margin: 5px 0;">${entry.timestamp} - ${entry.diceType}: ${entry.results.join(', ')}</p>`;
        } else {
            historyHTML += `<p style="margin: 5px 0;">${entry.timestamp} - ${entry.count}${entry.diceType}: [${entry.results.join(', ')}]`;
            if (entry.count > 1) {
                historyHTML += ` = ${entry.total}`;
            }
            historyHTML += `</p>`;
        }
    });
    
    container.innerHTML = historyHTML;
}

// ========== –ì–ï–ù–ï–†–ê–¢–û–†–´ ==========

function generateNameForRace(raceId, gender = null) {
    if (!nameGenerators[raceId]) return null;
    
    const generator = nameGenerators[raceId];
    
    if (!gender) {
        gender = Math.random() > 0.5 ? 'male' : 'female';
    }
    
    const firstNames = generator[gender];
    const surnames = generator.surnames;
    
    if (!firstNames || !surnames) return null;
    
    const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
    const surname = surnames[Math.floor(Math.random() * surnames.length)];
    
    return {
        firstName,
        surname,
        gender: gender === 'male' ? '–ú—É–∂—Å–∫–æ–µ' : '–ñ–µ–Ω—Å–∫–æ–µ'
    };
}

function generateRandomAge(raceId) {
    const race = races[raceId];
    const lifespan = parseInt(race.lifespan) || 300;
    return Math.max(15, Math.floor(Math.random() * lifespan * 0.3) + 15);
}

function generateRandomTrait() {
    const types = Object.keys(traits);
    const randomType = types[Math.floor(Math.random() * types.length)];
    const randomTrait = traits[randomType].general[Math.floor(Math.random() * traits[randomType].general.length)];
    return randomTrait;
}

function generateRandomNickname() {
    const types = Object.keys(nicknames);
    const randomType = types[Math.floor(Math.random() * types.length)];
    const randomNickname = nicknames[randomType][Math.floor(Math.random() * nicknames[randomType].length)];
    return randomNickname;
}

function generateFullCharacter() {
    const race = document.getElementById('genRace').value;
    const gender = document.getElementById('genGender').value;
    
    if (!race) {
        alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å—É!');
        return;
    }
    
    const finalGender = gender === 'random' ? (Math.random() > 0.5 ? 'male' : 'female') : gender;
    const nameData = generateNameForRace(race, finalGender);
    const height = generateRandomHeight(race);
    const age = generateRandomAge(race);
    const trait = generateRandomTrait();
    const nickname = generateRandomNickname();
    
    const resultDiv = document.getElementById('characterResult');
    resultDiv.style.display = 'block';
    resultDiv.innerHTML = `
        <h3 style="color: #d4af37; margin-bottom: 15px;">üé≠ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div><strong>–ò–º—è:</strong> ${nameData.firstName}</div>
            <div><strong>–§–∞–º–∏–ª–∏—è:</strong> ${nameData.surname}</div>
            <div><strong>–†–∞—Å–∞:</strong> ${races[race].name}</div>
            <div><strong>–ü–æ–ª:</strong> ${nameData.gender}</div>
            <div><strong>–†–æ—Å—Ç:</strong> ${height} —Å–º</div>
            <div><strong>–í–æ–∑—Ä–∞—Å—Ç:</strong> ${age} –ª–µ—Ç</div>
        </div>
        <div style="margin-top: 15px;">
            <strong>–û—Ç–ª–∏—á–∏—Ç–µ–ª—å–Ω–∞—è —á–µ—Ä—Ç–∞:</strong> ${trait}<br>
            <strong>–ü—Ä–æ–∑–≤–∏—â–µ:</strong> "${nickname}"
        </div>
        <button class="btn btn-plus" onclick="applyGeneratedCharacter('${nameData.firstName}', '${nameData.surname}', ${height}, ${age})" style="margin-top: 15px; width: 100%;">
            ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ –ø–µ—Ä—Å–æ–Ω–∞–∂—É
        </button>
    `;
}

function generateName() {
    const nameType = document.getElementById('nameType').value;
    const theme = document.getElementById('nameTheme').value.toLowerCase();
    
    let name = '';
    
    if (nameTemplates[nameType]) {
        const template = nameTemplates[nameType];
        const prefix = template.prefixes[Math.floor(Math.random() * template.prefixes.length)];
        const base = template.bases[Math.floor(Math.random() * template.bases.length)];
        const suffix = template.suffixes[Math.floor(Math.random() * template.suffixes.length)];
        
        name = `${prefix} ${base}${suffix}`;
        
        if (theme) {
            const themedSuffixes = {
                sea: [" —É –ü—Ä–∏—á–∞–ª–∞", " –ú–æ—Ä—è–∫–∞", " –í–æ–ª–Ω—ã", " –ü—Ä–∏–ª–∏–≤–∞", " –û–∫–µ–∞–Ω–∞"],
                forest: [" —É –õ–µ—Å–∞", " –û—Ö–æ—Ç–Ω–∏–∫–∞", " –¢—Ä–æ–ø—ã", " –†–æ—â–∏", " –î–µ—Ä–µ–≤–∞"],
                mountain: [" –≤ –ì–æ—Ä–∞—Ö", " –°–∫–∞–ª—ã", " –£—Ç–µ—Å–∞", " –í–µ—Ä—à–∏–Ω—ã", " –£—â–µ–ª—å—è"],
                fire: [" –û–≥–Ω—è", " –ü–ª–∞–º–µ–Ω–∏", " –í—É–ª–∫–∞–Ω–∞", " –ñ–∞—Ä–∞", " –ü–µ–ø–ª–∞"],
                river: [" —É –†–µ–∫–∏", " –†—É—á—å—è", " –ë—Ä–æ–¥–∞", " –í–æ–¥–æ–ø–∞–¥–∞", " –ò—Å—Ç–æ–∫–∞"]
            };
            
            if (themedSuffixes[theme]) {
                const themedSuffix = themedSuffixes[theme][Math.floor(Math.random() * themedSuffixes[theme].length)];
                name += themedSuffix;
            }
        }
    }
    
    const resultDiv = document.getElementById('nameResult');
    resultDiv.style.display = 'block';
    resultDiv.innerHTML = `
        <h4 style="color: #d4af37; margin-bottom: 10px;">${getIconForNameType(nameType)} ${name}</h4>
        <button class="btn btn-small" onclick="copyToClipboard('${name}')" style="background: #27ae60;">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
    `;
}

function generateTrait() {
    const traitType = document.getElementById('traitType').value;
    const theme = document.getElementById('traitTheme').value.toLowerCase();
    
    let trait = '';
    
    if (theme && traits[traitType].themes[theme]) {
        const themedTraits = traits[traitType].themes[theme];
        trait = themedTraits[Math.floor(Math.random() * themedTraits.length)];
    } else {
        const generalTraits = traits[traitType].general;
        trait = generalTraits[Math.floor(Math.random() * generalTraits.length)];
    }
    
    const resultDiv = document.getElementById('traitResult');
    resultDiv.style.display = 'block';
    resultDiv.innerHTML = `
        <h4 style="color: #d4af37; margin-bottom: 10px;">üé≠ ${trait}</h4>
        <button class="btn btn-small" onclick="copyToClipboard('${trait}')" style="background: #27ae60;">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
    `;
}

function generateNickname() {
    const nicknameType = document.getElementById('nicknameType').value;
    const nicknameList = nicknames[nicknameType];
    const nickname = nicknameList[Math.floor(Math.random() * nicknameList.length)];
    
    const resultDiv = document.getElementById('nicknameResult');
    resultDiv.style.display = 'block';
    resultDiv.innerHTML = `
        <h4 style="color: #d4af37; margin-bottom: 10px;">üéØ "${nickname}"</h4>
        <button class="btn btn-small" onclick="copyToClipboard('${nickname}')" style="background: #27ae60;">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
    `;
}

function getIconForNameType(type) {
    const icons = {
        tavern: "üç∫", inn: "üèöÔ∏è", shop: "üõçÔ∏è", blacksmith: "‚öíÔ∏è",
        temple: "‚õ™", city: "üè∞", kingdom: "üëë", ship: "‚õµ", gang: "üíÄ"
    };
    return icons[type] || "üèõÔ∏è";
}

function applyGeneratedCharacter(firstName, surname, height, age) {
    document.getElementById('characterName').value = firstName;
    document.getElementById('characterSurname').value = surname;
    document.getElementById('characterHeight').value = height;
    document.getElementById('characterAge').value = age;
    saveCharacterData();
    
    alert(`‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–∂ "${firstName} ${surname}" –ø—Ä–∏–º–µ–Ω–µ–Ω!`);
    openTab('character');
}

function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        alert('‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
    });
}

// ========== –≠–ö–°–ü–û–†–¢/–ò–ú–ü–û–†–¢ ==========

function exportCharacter() {
    const characterData = {
        info: {
            name: document.getElementById('characterName').value,
            surname: document.getElementById('characterSurname').value,
            title: document.getElementById('characterTitle').value,
            race: document.getElementById('characterRace').value,
            heritage: document.getElementById('characterHeritage').value,
            height: document.getElementById('characterHeight').value,
            weight: document.getElementById('characterWeight').value,
            age: document.getElementById('characterAge').value
        },
        level: {
            current: getCurrentLevel(),
            exp: getCurrentExp()
        },
        stats: {
            health: getHealth(),
            mana: getMana(),
            stamina: getStamina(),
            freePoints: getFreePoints()
        },
        skills: getAllSkills(),
        lockedSkills: lockedSkills,
        magic: {
            availableSchools: availableMagicSchools,
            spells: spellsBySchool
        },
        inventory: inventory,
        customCategories: customCategories,
        notes: notes
    };

    const dataStr = JSON.stringify(characterData, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    
    const link = document.createElement('a');
    link.href = URL.createObjectURL(dataBlob);
    link.download = `character_${characterData.info.name || 'unknown'}.json`;
    link.click();
    
    alert('‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–∂ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω!');
}

function importCharacter() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    
    input.onchange = function(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const characterData = JSON.parse(e.target.result);
                loadCharacterFromData(characterData);
                alert('‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–∂ –∑–∞–≥—Ä—É–∂–µ–Ω!');
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞!');
                console.error(error);
            }
        };
        reader.readAsText(file);
    };
    
    input.click();
}

function loadCharacterFromData(data) {
    if (data.info) {
        document.getElementById('characterName').value = data.info.name || '';
        document.getElementById('characterSurname').value = data.info.surname || '';
        document.getElementById('characterTitle').value = data.info.title || '';
        document.getElementById('characterRace').value = data.info.race || '';
        document.getElementById('characterHeritage').value = data.info.heritage || '';
        document.getElementById('characterHeight').value = data.info.height || '';
        document.getElementById('characterWeight').value = data.info.weight || '';
        document.getElementById('characterAge').value = data.info.age || '';
    }

    if (data.level) {
        setCurrentLevel(data.level.current || 0);
        setCurrentExp(data.level.exp || 0);
    }

    if (data.stats) {
        setHealth(data.stats.health || 100);
        setMana(data.stats.mana || 100);
        setStamina(data.stats.stamina || 100);
        setFreePoints(data.stats.freePoints || 0);
    }

    if (data.skills) {
        Object.entries(data.skills).forEach(([skill, value]) => {
            setSkillValue(skill, value);
        });
    }

    if (data.lockedSkills) {
        lockedSkills = data.lockedSkills;
        saveLockedSkills();
    }

    if (data.magic) {
        availableMagicSchools = data.magic.availableSchools || {};
        if (data.magic.spells) {
            Object.assign(spellsBySchool, data.magic.spells);
            saveSpells();
        }
    }

    if (data.inventory) {
        inventory = data.inventory;
        saveInventory();
    }

    if (data.customCategories) {
        customCategories = data.customCategories;
        saveCustomCategories();
    }

    if (data.notes) {
        notes = data.notes;
        saveNotes();
    }

    updateLevelDisplay();
    updateUI();
    renderSkills();
    renderInventory();
    renderNotes();
    updateCategoryManagement();
}

function getAllSkills() {
    const skills = {};
    Object.values(skillsStructure).forEach(skillGroup => {
        skillGroup.forEach(skill => {
            skills[skill] = getSkillValue(skill);
        });
    });
    return skills;
}
</script>
<script>
// ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========

// –ì–µ—Ç—Ç–µ—Ä—ã/—Å–µ—Ç—Ç–µ—Ä—ã –¥–ª—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
function getFreePoints() { 
    const element = document.getElementById('freePoints');
    return element ? parseInt(element.value) || 0 : 0; 
}

function setFreePoints(value) { 
    const element = document.getElementById('freePoints');
    if (element) element.value = value; 
}

function getCurrentLevel() { 
    return parseInt(localStorage.getItem('currentLevel')) || 0; 
}

function setCurrentLevel(value) { 
    localStorage.setItem('currentLevel', value); 
}

function getCurrentExp() { 
    return parseInt(localStorage.getItem('currentExp')) || 0; 
}

function setCurrentExp(value) { 
    localStorage.setItem('currentExp', value); 
}

function getHealth() { 
    const element = document.getElementById('health');
    return element ? parseInt(element.value) || 100 : 100; 
}

function setHealth(value) { 
    const element = document.getElementById('health');
    if (element) element.value = value; 
}

function getMana() { 
    const element = document.getElementById('mana');
    return element ? parseInt(element.value) || 100 : 100; 
}

function setMana(value) { 
    const element = document.getElementById('mana');
    if (element) element.value = value; 
}

function getStamina() { 
    const element = document.getElementById('stamina');
    return element ? parseInt(element.value) || 100 : 100; 
}

function setStamina(value) { 
    const element = document.getElementById('stamina');
    if (element) element.value = value; 
}

function getSkillValue(skillName) { 
    return parseInt(localStorage.getItem(`skill_${skillName}`)) || 5; 
}

function setSkillValue(skillName, value) { 
    localStorage.setItem(`skill_${skillName}`, value); 
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
function saveCharacterData() {
    localStorage.setItem('characterName', document.getElementById('characterName').value);
    localStorage.setItem('characterSurname', document.getElementById('characterSurname').value);
    localStorage.setItem('characterTitle', document.getElementById('characterTitle').value);
    localStorage.setItem('characterRace', document.getElementById('characterRace').value);
    localStorage.setItem('characterHeritage', document.getElementById('characterHeritage').value);
    localStorage.setItem('characterHeight', document.getElementById('characterHeight').value);
    localStorage.setItem('characterWeight', document.getElementById('characterWeight').value);
    localStorage.setItem('characterAge', document.getElementById('characterAge').value);
    localStorage.setItem('availableMagicSchools', JSON.stringify(availableMagicSchools));
}

function loadCharacterData() {
    document.getElementById('characterName').value = localStorage.getItem('characterName') || '';
    document.getElementById('characterSurname').value = localStorage.getItem('characterSurname') || '';
    document.getElementById('characterTitle').value = localStorage.getItem('characterTitle') || '';
    document.getElementById('characterRace').value = localStorage.getItem('characterRace') || '';
    document.getElementById('characterHeritage').value = localStorage.getItem('characterHeritage') || '';
    document.getElementById('characterHeight').value = localStorage.getItem('characterHeight') || '';
    document.getElementById('characterWeight').value = localStorage.getItem('characterWeight') || '';
    document.getElementById('characterAge').value = localStorage.getItem('characterAge') || '';
    
    const savedMagicSchools = localStorage.getItem('availableMagicSchools');
    if (savedMagicSchools) {
        availableMagicSchools = JSON.parse(savedMagicSchools);
    }
    
    if (localStorage.getItem('characterRace')) {
        document.getElementById('generateHeightBtn').disabled = true;
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –Ω–∞–≤—ã–∫–æ–≤ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
function initializeSkills() {
    Object.values(skillsStructure).forEach(skillGroup => {
        skillGroup.forEach(skill => {
            if (localStorage.getItem(`skill_${skill}`) === null) {
                setSkillValue(skill, 5);
            }
        });
    });
}

// ========== –û–°–ù–û–í–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========

// ========== –û–°–ù–û–í–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========

document.addEventListener('DOMContentLoaded', function() {
    // üëá –ó–ê–ú–ï–ù–Ø–ï–ú –í–ï–°–¨ –≠–¢–û–¢ –ë–õ–û–ö üëá
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–∏—Å—Ç–µ–º—É –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
    loadCharacters();
    setupAutoSave();
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
    loadCurrentCharacter();
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    loadNotes();
    loadInventory();
    loadSpells();
    loadLockedSkills();
    loadCustomCategories();
    loadSkillRollHistory();
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–∞–≤—ã–∫–∏
    initializeSkills();
    
    // –†–µ–Ω–¥–µ—Ä –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
    renderSkills();
    renderInventory();
    renderNotes();
    updateUI();
    updateLevelDisplay();
    updateMagicSkillsDisplay();
    renderCharactersList();
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª–µ–π —Å–æ–±—ã—Ç–∏–π
    document.getElementById('characterName').addEventListener('input', saveCharacterData);
    document.getElementById('characterSurname').addEventListener('input', saveCharacterData);
    document.getElementById('characterTitle').addEventListener('input', saveCharacterData);
    document.getElementById('characterRace').addEventListener('change', saveCharacterData);
    document.getElementById('characterHeritage').addEventListener('input', saveCharacterData);
    document.getElementById('characterHeight').addEventListener('input', saveCharacterData);
    document.getElementById('characterWeight').addEventListener('input', saveCharacterData);
    document.getElementById('characterAge').addEventListener('input', saveCharacterData);
    document.getElementById('health').addEventListener('input', saveCharacterData);
    document.getElementById('mana').addEventListener('input', saveCharacterData);
    document.getElementById('stamina').addEventListener('input', saveCharacterData);
    
    document.getElementById('freePoints').addEventListener('input', function() {
        updateUI();
        saveCharacterData();
    });
    
    document.getElementById('currentExp').addEventListener('input', function() {
        setCurrentExp(parseInt(this.value) || 0);
        checkLevelUp();
        updateLevelDisplay();
        saveCharacterData();
    });
    
    // –°–ª—É—à–∞—Ç–µ–ª–∏ –ø–æ–∏—Å–∫–∞
    const inventorySearch = document.getElementById('inventorySearch');
    const notesSearch = document.getElementById('notesSearch');
    
    if (inventorySearch) {
        inventorySearch.addEventListener('input', renderInventory);
    }
    
    if (notesSearch) {
        notesSearch.addEventListener('input', renderNotes);
    }
    
    console.log('‚úÖ D&D Character Sheet –∑–∞–≥—Ä—É–∂–µ–Ω!');
    console.log(`üë• –ó–∞–≥—Ä—É–∂–µ–Ω–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π: ${Object.keys(characters).length}`);
    if (currentCharacterId) {
        console.log(`üéØ –¢–µ–∫—É—â–∏–π –ø–µ—Ä—Å–æ–Ω–∞–∂: ${characters[currentCharacterId].info.name}`);
    }
});
    
    document.getElementById('currentExp').addEventListener('input', function() {
        setCurrentExp(parseInt(this.value) || 0);
        checkLevelUp();
        updateLevelDisplay();
        saveCharacterData();
    });
    
    // –°–ª—É—à–∞—Ç–µ–ª–∏ –ø–æ–∏—Å–∫–∞
    const inventorySearch = document.getElementById('inventorySearch');
    const notesSearch = document.getElementById('notesSearch');
    
    if (inventorySearch) {
        inventorySearch.addEventListener('input', renderInventory);
    }
    
    if (notesSearch) {
        notesSearch.addEventListener('input', renderNotes);
    }
    
    console.log('‚úÖ D&D Character Sheet –∑–∞–≥—Ä—É–∂–µ–Ω!');
});

// ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–û–°–¢–£–ü–ù–´–ï –í –ö–û–ù–°–û–õ–ò ==========

// –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ - —Å–±—Ä–æ—Å –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
function resetAllData() {
    if (confirm('‚ùå –í–´ –£–í–ï–†–ï–ù–´? –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞!')) {
        localStorage.clear();
        location.reload();
    }
}

// –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ - –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
function showAllData() {
    console.log('=== –í–°–ï –î–ê–ù–ù–´–ï –ü–ï–†–°–û–ù–ê–ñ–ê ===');
    console.log('–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:', {
        name: document.getElementById('characterName').value,
        race: document.getElementById('characterRace').value,
        level: getCurrentLevel(),
        exp: getCurrentExp()
    });
    console.log('–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:', {
        health: getHealth(),
        mana: getMana(),
        stamina: getStamina(),
        freePoints: getFreePoints()
    });
    console.log('–ù–∞–≤—ã–∫–∏:', getAllSkills());
    console.log('–ú–∞–≥–∏—è:', availableMagicSchools);
    console.log('–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å:', inventory);
    console.log('–ó–∞–º–µ—Ç–∫–∏:', notes);
}

// –≠–∫—Å–ø–æ—Ä—Ç –≤ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
function exportToConsole() {
    const characterData = {
        info: {
            name: document.getElementById('characterName').value,
            surname: document.getElementById('characterSurname').value,
            title: document.getElementById('characterTitle').value,
            race: document.getElementById('characterRace').value,
            heritage: document.getElementById('characterHeritage').value,
            height: document.getElementById('characterHeight').value,
            weight: document.getElementById('characterWeight').value,
            age: document.getElementById('characterAge').value
        },
        level: {
            current: getCurrentLevel(),
            exp: getCurrentExp()
        },
        stats: {
            health: getHealth(),
            mana: getMana(),
            stamina: getStamina(),
            freePoints: getFreePoints()
        },
        skills: getAllSkills(),
        magic: {
            availableSchools: availableMagicSchools
        }
    };
    
    console.log('üíæ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:', characterData);
    return characterData;
}

// –ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø—ã—Ç–∞ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
function quickExp(amount = 1000) {
    let currentExp = getCurrentExp();
    currentExp += amount;
    setCurrentExp(currentExp);
    checkLevelUp();
    updateLevelDisplay();
    saveCharacterData();
    alert(`‚ûï –î–æ–±–∞–≤–ª–µ–Ω–æ ${amount} –æ–ø—ã—Ç–∞!`);
}

// –ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—á–∫–æ–≤ –Ω–∞–≤—ã–∫–æ–≤ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
function quickPoints(amount = 10) {
    const freePoints = getFreePoints();
    setFreePoints(freePoints + amount);
    updateUI();
    saveCharacterData();
    alert(`üéØ –î–æ–±–∞–≤–ª–µ–Ω–æ ${amount} –æ—á–∫–æ–≤ –Ω–∞–≤—ã–∫–æ–≤!`);
}
// üëá –î–û–ë–ê–í–õ–Ø–ï–ú –í–ï–°–¨ –≠–¢–û–¢ –ë–õ–û–ö –ü–ï–†–ï–î –ó–ê–ö–†–´–í–ê–Æ–©–ò–ú </script> üëá

// ========== –°–ò–°–¢–ï–ú–ê –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–ï–†–°–û–ù–ê–ñ–ê–ú–ò ==========

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
function loadCharacters() {
    const saved = localStorage.getItem('dnd_characters');
    if (saved) {
        characters = JSON.parse(saved);
    }
    
    const savedCurrent = localStorage.getItem('current_character_id');
    if (savedCurrent) {
        currentCharacterId = savedCurrent;
    }
    
    renderCharactersList();
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
function saveCharacters() {
    localStorage.setItem('dnd_characters', JSON.stringify(characters));
    localStorage.setItem('current_character_id', currentCharacterId);
}

// –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
function showCreateCharacterPopup() {
    const popup = document.createElement('div');
    popup.className = 'popup';
    popup.innerHTML = `
        <div class="popup-content">
            <h2 style="color: #d4af37;">–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</h2>
            <input type="text" id="newCharacterName" placeholder="–ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞" style="width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #8b4513; border-radius: 4px; background: #1a0f0b; color: #e0d0c0; font-size: 16px;">
            
            <select id="newCharacterRace" style="width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #8b4513; border-radius: 4px; background: #1a0f0b; color: #e0d0c0; font-size: 16px;">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å—É</option>
                <option value="atski">üî• –ê—Ü–∫–∏ (–ü–µ—Ä—Å—ã)</option>
                <option value="knofi">üó£Ô∏è –ö–Ω–æ—Ñ—ã (–†–∏–º–ª—è–Ω–µ)</option>
                <option value="vorki">‚ùÑÔ∏è –í–æ—Ä–∫–∏ (–í–∏–∫–∏–Ω–≥–∏)</option>
                <option value="minci">üéØ –ú–∏–Ω—Ü—ã (–ê–∑–∏–∞—Ç—ã)</option>
                <option value="kaei">‚öíÔ∏è –ö–∞—ç–π—Ü—ã (–ù–µ–≥—Ä—ã)</option>
                <option value="forest_elf">üåø –õ–µ—Å–Ω—ã–µ —ç–ª—å—Ñ—ã</option>
                <option value="high_elf">‚ú® –í—ã—Å—à–∏–µ —ç–ª—å—Ñ—ã</option>
                <option value="dark_elf">üåë –¢–µ–º–Ω—ã–µ —ç–ª—å—Ñ—ã</option>
                <option value="dwarf">‚õ∞Ô∏è –î–≤–∞—Ä—Ñ—ã</option>
                <option value="gnome">üîÆ –ì–Ω–æ–º—ã</option>
                <option value="orc">üíÄ –û—Ä–∫–∏</option>
                <option value="goblin">üëπ –ì–æ–±–ª–∏–Ω—ã</option>
            </select>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-plus" onclick="createNewCharacter()">–°–æ–∑–¥–∞—Ç—å</button>
                <button class="btn btn-roll" onclick="this.closest('.popup').remove()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    `;
    document.body.appendChild(popup);
}

function createNewCharacter() {
    const name = document.getElementById('newCharacterName').value.trim();
    const race = document.getElementById('newCharacterRace').value;
    
    if (!name) {
        alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞!');
        return;
    }
    
    if (!race) {
        alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å—É –ø–µ—Ä—Å–æ–Ω–∞–∂–∞!');
        return;
    }
    
    const characterId = 'char_' + Date.now();
    const randomHeight = generateRandomHeight(race);
    
    // –°–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
    const newCharacter = {
        id: characterId,
        name: name,
        info: {
            name: name,
            surname: "",
            title: "",
            race: race,
            heritage: "",
            height: randomHeight,
            weight: "",
            age: Math.max(15, Math.floor(parseInt(races[race].lifespan) * 0.1))
        },
        level: {
            current: 0,
            exp: 0
        },
        stats: {
            health: 100,
            mana: 100,
            stamina: 100,
            freePoints: 0
        },
        skills: {},
        lockedSkills: {},
        magic: {
            availableSchools: {},
            spells: JSON.parse(JSON.stringify(spellsBySchool))
        },
        inventory: {
            weapons: [], armor: [], potions: [], scrolls: [],
            resources: [], valuables: [], tools: [], other: []
        },
        customCategories: [],
        notes: [],
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    };
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–∞–≤—ã–∫–∏
    Object.values(skillsStructure).forEach(skillGroup => {
        skillGroup.forEach(skill => {
            newCharacter.skills[skill] = 5;
        });
    });
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —à–∫–æ–ª—ã –º–∞–≥–∏–∏
    determineAvailableMagicSchoolsForCharacter(newCharacter, race);
    
    characters[characterId] = newCharacter;
    saveCharacters();
    
    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –Ω–æ–≤–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
    switchCharacter(characterId);
    
    document.querySelector('.popup').remove();
    alert(`‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–∂ "${name}" —Å–æ–∑–¥–∞–Ω!`);
}

function determineAvailableMagicSchoolsForCharacter(character, raceId) {
    character.magic.availableSchools = {};
    
    switch(raceId) {
        case 'forest_elf':
            character.magic.availableSchools["–ú–∞–≥–∏—è –ø—Ä–∏—Ä–æ–¥—ã"] = true;
            break;
        case 'dark_elf':
            character.magic.availableSchools["–ú–∞–≥–∏—è —Ç—å–º—ã"] = true;
            break;
        case 'high_elf':
            const shuffled = [...baseMagicSchools].sort(() => 0.5 - Math.random());
            character.magic.availableSchools[shuffled[0]] = true;
            character.magic.availableSchools[shuffled[1]] = true;
            break;
        case 'goblin':
            break;
        default:
            const randomSchool = baseMagicSchools[Math.floor(Math.random() * baseMagicSchools.length)];
            character.magic.availableSchools[randomSchool] = true;
    }
    
    const race = races[raceId];
    if (race && race.limitations) {
        Object.keys(race.limitations).forEach(school => {
            if (race.limitations[school] === 0) {
                character.magic.availableSchools[school] = false;
            }
        });
    }
}

// –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
function renderCharactersList() {
    const container = document.getElementById('charactersList');
    
    if (Object.keys(characters).length === 0) {
        container.innerHTML = '<p style="color: #8b7d6b; text-align: center;">–ü–µ—Ä—Å–æ–Ω–∞–∂–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</p>';
        return;
    }
    
    let html = '';
    Object.values(characters).forEach(character => {
        const isCurrent = currentCharacterId === character.id;
        const raceInfo = races[character.info.race] || { name: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ' };
        
        html += `
            <div class="character-card" style="background: ${isCurrent ? '#8b4513' : '#3d2418'}; padding: 15px; margin: 10px 0; border-radius: 6px; border-left: 4px solid #d4af37;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h3 style="color: #d4af37; margin: 0 0 5px 0;">${character.info.name}</h3>
                        <p style="color: #b8a28a; margin: 0; font-size: 0.9em;">
                            ${raceInfo.name} | –£—Ä. ${character.level.current} | –û–ø—ã—Ç: ${character.level.exp}
                        </p>
                        <p style="color: #8b7d6b; margin: 5px 0 0 0; font-size: 0.8em;">
                            –°–æ–∑–¥–∞–Ω: ${new Date(character.createdAt).toLocaleDateString()}
                        </p>
                    </div>
                    <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                        ${!isCurrent ? `
                            <button class="btn btn-small" onclick="switchCharacter('${character.id}')" style="background: #27ae60;">üéØ –í—ã–±—Ä–∞—Ç—å</button>
                        ` : `
                            <button class="btn btn-small" style="background: #d4af37; color: #1a0f0b;" disabled>‚úÖ –ê–∫—Ç–∏–≤–µ–Ω</button>
                        `}
                        <button class="btn btn-small" onclick="exportSingleCharacter('${character.id}')" style="background: #3498db;">üíæ –≠–∫—Å–ø–æ—Ä—Ç</button>
                        <button class="btn btn-small" onclick="showRenameCharacterPopup('${character.id}')" style="background: #f39c12;">‚úèÔ∏è –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å</button>
                        <button class="btn btn-small" onclick="showDeleteCharacterPopup('${character.id}')" style="background: #c44536;">‚ùå –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            </div>
        `;
    });
    
    container.innerHTML = html;
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏
function switchCharacter(characterId) {
    if (!characters[characterId]) {
        alert('–ü–µ—Ä—Å–æ–Ω–∞–∂ –Ω–µ –Ω–∞–π–¥–µ–Ω!');
        return;
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
    if (currentCharacterId && characters[currentCharacterId]) {
        saveCurrentCharacter();
    }
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
    currentCharacterId = characterId;
    loadCurrentCharacter();
    saveCharacters();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    renderCharactersList();
    updateUI();
    updateLevelDisplay();
    
    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
    openTab('character');
    
    alert(`‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω –Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞: ${characters[characterId].info.name}`);
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
function saveCurrentCharacter() {
    if (!currentCharacterId) return;
    
    const character = characters[currentCharacterId];
    if (!character) return;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
    character.info = {
        name: document.getElementById('characterName').value,
        surname: document.getElementById('characterSurname').value,
        title: document.getElementById('characterTitle').value,
        race: document.getElementById('characterRace').value,
        heritage: document.getElementById('characterHeritage').value,
        height: document.getElementById('characterHeight').value,
        weight: document.getElementById('characterWeight').value,
        age: document.getElementById('characterAge').value
    };
    
    character.level = {
        current: getCurrentLevel(),
        exp: getCurrentExp()
    };
    
    character.stats = {
        health: getHealth(),
        mana: getMana(),
        stamina: getStamina(),
        freePoints: getFreePoints()
    };
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞–≤—ã–∫–∏
    character.skills = {};
    Object.values(skillsStructure).forEach(skillGroup => {
        skillGroup.forEach(skill => {
            character.skills[skill] = getSkillValue(skill);
        });
    });
    
    character.lockedSkills = lockedSkills;
    character.magic.availableSchools = availableMagicSchools;
    character.inventory = inventory;
    character.customCategories = customCategories;
    character.notes = notes;
    character.updatedAt = new Date().toISOString();
    
    saveCharacters();
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
function loadCurrentCharacter() {
    if (!currentCharacterId || !characters[currentCharacterId]) {
        // –ï—Å–ª–∏ –Ω–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π, —Å–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ
        if (Object.keys(characters).length === 0) {
            showCreateCharacterPopup();
            return;
        }
        // –ò–ª–∏ –≤—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤–æ–≥–æ
        currentCharacterId = Object.keys(characters)[0];
    }
    
    const character = characters[currentCharacterId];
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    document.getElementById('characterName').value = character.info.name || '';
    document.getElementById('characterSurname').value = character.info.surname || '';
    document.getElementById('characterTitle').value = character.info.title || '';
    document.getElementById('characterRace').value = character.info.race || '';
    document.getElementById('characterHeritage').value = character.info.heritage || '';
    document.getElementById('characterHeight').value = character.info.height || '';
    document.getElementById('characterWeight').value = character.info.weight || '';
    document.getElementById('characterAge').value = character.info.age || '';
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —É—Ä–æ–≤–Ω–∏
    setCurrentLevel(character.level.current || 0);
    setCurrentExp(character.level.exp || 0);
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
    setHealth(character.stats.health || 100);
    setMana(character.stats.mana || 100);
    setStamina(character.stats.stamina || 100);
    setFreePoints(character.stats.freePoints || 0);
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞–≤—ã–∫–∏
    Object.entries(character.skills || {}).forEach(([skill, value]) => {
        setSkillValue(skill, value);
    });
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    lockedSkills = character.lockedSkills || {};
    availableMagicSchools = character.magic.availableSchools || {};
    inventory = character.inventory || {
        weapons: [], armor: [], potions: [], scrolls: [],
        resources: [], valuables: [], tools: [], other: []
    };
    customCategories = character.customCategories || [];
    notes = character.notes || [];
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    renderSkills();
    renderInventory();
    renderNotes();
    updateCategoryManagement();
}

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏
function showRenameCharacterPopup(characterId) {
    const character = characters[characterId];
    const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:', character.info.name);
    
    if (newName && newName.trim()) {
        character.info.name = newName.trim();
        character.updatedAt = new Date().toISOString();
        saveCharacters();
        renderCharactersList();
        alert('‚úÖ –ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –∏–∑–º–µ–Ω–µ–Ω–æ!');
    }
}

function showDeleteCharacterPopup(characterId) {
    const character = characters[characterId];
    
    if (Object.keys(characters).length <= 1) {
        alert('‚ùå –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞!');
        return;
    }
    
    if (confirm(`–£–¥–∞–ª–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ "${character.info.name}"? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!`)) {
        delete characters[characterId];
        
        // –ï—Å–ª–∏ —É–¥–∞–ª—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –¥—Ä—É–≥–æ–≥–æ
        if (currentCharacterId === characterId) {
            const remainingIds = Object.keys(characters);
            if (remainingIds.length > 0) {
                switchCharacter(remainingIds[0]);
            } else {
                currentCharacterId = null;
            }
        }
        
        saveCharacters();
        renderCharactersList();
        alert('‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–∂ —É–¥–∞–ª–µ–Ω!');
    }
}

function showClearAllPopup() {
    if (Object.keys(characters).length === 0) {
        alert('–ù–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è!');
        return;
    }
    
    if (confirm(`‚ùå –í–´ –£–í–ï–†–ï–ù–´?\n\n–≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï–• –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π (${Object.keys(characters).length} —à—Ç.)!\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!`)) {
        characters = {};
        currentCharacterId = null;
        saveCharacters();
        location.reload();
    }
}

// –≠–∫—Å–ø–æ—Ä—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
function exportSingleCharacter(characterId) {
    const character = characters[characterId];
    const dataStr = JSON.stringify(character, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    
    const link = document.createElement('a');
    link.href = URL.createObjectURL(dataBlob);
    link.download = `character_${character.info.name || 'unknown'}.json`;
    link.click();
    
    alert(`‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–∂ "${character.info.name}" —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω!`);
}

function exportAllCharacters() {
    if (Object.keys(characters).length === 0) {
        alert('–ù–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞!');
        return;
    }
    
    const dataStr = JSON.stringify(characters, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    
    const link = document.createElement('a');
    link.href = URL.createObjectURL(dataBlob);
    link.download = `dnd_characters_backup_${new Date().toISOString().split('T')[0]}.json`;
    link.click();
    
    alert(`‚úÖ –í—Å–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏ (${Object.keys(characters).length} —à—Ç.) —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!`);
}

function showImportCharacterPopup() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    
    input.onchange = function(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const characterData = JSON.parse(e.target.result);
                importCharacterData(characterData);
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞!');
                console.error(error);
            }
        };
        reader.readAsText(file);
    };
    
    input.click();
}

function importCharacterData(characterData) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–∞
    if (!characterData.info || !characterData.info.name) {
        // –ï—Å–ª–∏ —ç—Ç–æ —Ñ–∞–π–ª —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏
        if (characterData.info === undefined && Object.keys(characterData).length > 0) {
            let importedCount = 0;
            Object.values(characterData).forEach(char => {
                if (char.info && char.info.name) {
                    const newId = 'char_import_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    characters[newId] = char;
                    characters[newId].id = newId;
                    characters[newId].updatedAt = new Date().toISOString();
                    importedCount++;
                }
            });
            saveCharacters();
            renderCharactersList();
            alert(`‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${importedCount} –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π!`);
            return;
        }
        alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞!');
        return;
    }
    
    // –ï—Å–ª–∏ —ç—Ç–æ –æ–¥–∏–Ω–æ—á–Ω—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂
    const newId = 'char_import_' + Date.now();
    characters[newId] = characterData;
    characters[newId].id = newId;
    characters[newId].updatedAt = new Date().toISOString();
    
    saveCharacters();
    renderCharactersList();
    alert(`‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–∂ "${characterData.info.name}" –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω!`);
}

// –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
function setupAutoSave() {
    // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º saveCharacterData –¥–ª—è –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    const originalSaveCharacterData = saveCharacterData;
    saveCharacterData = function() {
        originalSaveCharacterData();
        if (currentCharacterId) {
            saveCurrentCharacter();
        }
    };
    
    // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
    const originalSaveInventory = saveInventory;
    saveInventory = function() {
        originalSaveInventory();
        if (currentCharacterId) {
            saveCurrentCharacter();
        }
    };
    
    // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–º–µ—Ç–æ–∫
    const originalSaveNotes = saveNotes;
    saveNotes = function() {
        originalSaveNotes();
        if (currentCharacterId) {
            saveCurrentCharacter();
        }
    };
}

// üëÜ –ö–û–ù–ï–¶ –ë–õ–û–ö–ê –° –§–£–ù–ö–¶–ò–Ø–ú–ò üëÜ
</script>
</script>
</body>
</html>

